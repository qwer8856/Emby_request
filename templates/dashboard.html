<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{{ site_config.site_title or 'Embyç®¡ç†ç³»ç»Ÿ' }}</title>
    <!-- PWA æ”¯æŒ -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ç®¡ç†ç³»ç»Ÿ">
    {% if site_config.site_logo %}
    <link rel="apple-touch-icon" href="{{ site_config.site_logo }}">
    <link rel="icon" href="{{ site_config.site_logo }}" type="image/png">
    {% endif %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}?v=23">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}?v=53">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/checkin.css') }}?v=3">
    {% if site_config.custom_css %}
    <style>{{ site_config.custom_css | safe }}</style>
    {% endif %}
    <!-- é˜²æ­¢åˆ·æ–°é¡µé¢æ—¶é—ªå± -->
    <style id="preload-style">
        /* å¦‚æœURLæœ‰hashä¸”ä¸æ˜¯homeï¼Œéšè—é»˜è®¤çš„home section */
        .content-section { display: none !important; }
    </style>
    <script>
    (function() {
        var hash = window.location.hash.slice(1);
        var validSections = ['home','subscription','purchase','search','trending','requests','invite','playback','profile','activity-logs'];
        // å¦‚æœæ²¡æœ‰hashæˆ–hashæ˜¯homeï¼Œç§»é™¤é¢„åŠ è½½æ ·å¼è®©é»˜è®¤çš„activeç”Ÿæ•ˆ
        if (!hash || hash === 'home' || validSections.indexOf(hash) === -1) {
            var style = document.getElementById('preload-style');
            if (style) style.remove();
        }
    })();
    </script>
</head>
<body class="page-dashboard">
    <!-- å·¦ä¾§è¾¹æ  -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                {% if site_config.site_logo %}
                <img src="{{ site_config.site_logo }}" alt="Logo">
                {% endif %}
                <div class="logo-text">
                    <div class="logo-title">{{ site_config.site_name or 'Emby' }}</div>
                    <div class="logo-subtitle">{{ site_config.site_subtitle or 'ç®¡ç†ç³»ç»Ÿ' }}</div>
                </div>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#home" class="nav-item active" data-section="home" onclick="switchSection('home', event)">
                <svg viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"/></svg>
                <span>ä»ªè¡¨ç›˜</span>
            </a>
            <a href="#subscription" class="nav-item" data-section="subscription" onclick="switchSection('subscription', event)">
                <svg viewBox="0 0 24 24"><path d="M20,8H4V6H20M20,18H4V12H20M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"/></svg>
                <span>æˆ‘çš„è®¢é˜…</span>
            </a>
            <a href="#purchase" class="nav-item" data-section="purchase" onclick="switchSection('purchase', event)">
                <svg viewBox="0 0 24 24"><path d="M17,18A2,2 0 0,1 19,20A2,2 0 0,1 17,22C15.89,22 15,21.1 15,20C15,18.89 15.89,18 17,18M1,2H4.27L5.21,4H20A1,1 0 0,1 21,5C21,5.17 20.95,5.34 20.88,5.5L17.3,11.97C16.96,12.58 16.3,13 15.55,13H8.1L7.2,14.63L7.17,14.75A0.25,0.25 0 0,0 7.42,15H19V17H7C5.89,17 5,16.1 5,15C5,14.65 5.09,14.32 5.24,14.04L6.6,11.59L3,4H1V2M7,18A2,2 0 0,1 9,20A2,2 0 0,1 7,22C5.89,22 5,21.1 5,20C5,18.89 5.89,18 7,18M16,11L18.78,6H6.14L8.5,11H16Z"/></svg>
                <span>è´­ä¹°å¥—é¤</span>
            </a>
            <a href="#search" class="nav-item" data-section="search" onclick="switchSection('search', event)">
                <svg viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg>
                <span>æœç´¢æ±‚ç‰‡</span>
            </a>
            <a href="#trending" class="nav-item" data-section="trending" onclick="switchSection('trending', event)">
                <svg viewBox="0 0 24 24"><path d="M16,6L18.29,8.29L13.41,13.17L9.41,9.17L2,16.59L3.41,18L9.41,12L13.41,16L19.71,9.71L22,12V6H16Z"/></svg>
                <span>çƒ­é—¨æ¨è</span>
            </a>
            <a href="#requests" class="nav-item" data-section="requests" onclick="switchSection('requests', event)">
                <svg viewBox="0 0 24 24"><path d="M19,3H14.82C14.4,1.84 13.3,1 12,1C10.7,1 9.6,1.84 9.18,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M12,3A1,1 0 0,1 13,4A1,1 0 0,1 12,5A1,1 0 0,1 11,4A1,1 0 0,1 12,3Z"/></svg>
                <span>æ±‚ç‰‡ç®¡ç†</span>
            </a>
            <a href="#invite" class="nav-item" data-section="invite" onclick="switchSection('invite', event)">
                <svg viewBox="0 0 24 24"><path d="M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12M6,10V7H4V10H1V12H4V15H6V12H9V10H6Z"/></svg>
                <span>é‚€è¯·è¿”åˆ©</span>
            </a>
            <a href="#playback" class="nav-item" data-section="playback" onclick="switchSection('playback', event)">
                <svg viewBox="0 0 24 24"><path d="M21,3H3C1.89,3 1,3.89 1,5V17A2,2 0 0,0 3,19H8V21H16V19H21A2,2 0 0,0 23,17V5C23,3.89 22.1,3 21,3M21,17H3V5H21M16,11L9,15V7"/></svg>
                <span>æ’­æ”¾ç›‘æ§</span>
            </a>
            <a href="#profile" class="nav-item" data-section="profile" onclick="switchSection('profile', event)">
                <svg viewBox="0 0 24 24"><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"/></svg>
                <span>æˆ‘çš„ä¿¡æ¯</span>
            </a>
            <a href="#activity-logs" class="nav-item" data-section="activity-logs" onclick="switchSection('activity-logs', event)">
                <svg viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M9,13V19H7V13H9M15,15V19H13V15H15M11,11V19H9V11H11M17,13V19H15V13H17Z"/></svg>
                <span>æ“ä½œæ—¥å¿—</span>
            </a>
            <!-- ä½¿ç”¨æ–‡æ¡£ã€å¸¸è§é—®é¢˜ã€æŠ€æœ¯æ”¯æŒ é€šè¿‡é¦–é¡µå¿«æ·å…¥å£è®¿é—® -->
        </nav>
        
        <div class="sidebar-footer">
            {% if user.is_admin %}
            <a href="/admin" class="admin-panel-btn">
                <svg viewBox="0 0 24 24"><path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/></svg>
                <span>ç®¡ç†å‘˜åå°</span>
            </a>
            {% endif %}
            {% if site_config.telegram_group %}
            <a href="https://t.me/{{ site_config.telegram_group }}" target="_blank" class="telegram-sidebar-btn" title="Telegram ç¾¤ç»„">
                <svg viewBox="0 0 24 24"><path d="M9.78 18.65L10.06 14.42L17.74 7.5C18.08 7.19 17.67 7.04 17.22 7.31L7.74 13.3L3.64 12C2.76 11.75 2.75 11.14 3.84 10.7L19.81 4.54C20.54 4.21 21.24 4.72 20.96 5.84L18.24 18.65C18.05 19.56 17.5 19.78 16.74 19.36L12.6 16.3L10.61 18.23C10.38 18.46 10.19 18.65 9.78 18.65Z"/></svg>
                <span>Telegram ç¾¤ç»„</span>
            </a>
            {% endif %}
            <!-- Telegram ç»‘å®šæŒ‰é’® -->
            <div class="telegram-bind-sidebar" id="telegramBindSidebar" onclick="showTelegramBindDialog()">
                <svg viewBox="0 0 24 24"><path d="M9.78 18.65L10.06 14.42L17.74 7.5C18.08 7.19 17.67 7.04 17.22 7.31L7.74 13.3L3.64 12C2.76 11.75 2.75 11.14 3.84 10.7L19.81 4.54C20.54 4.21 21.24 4.72 20.96 5.84L18.24 18.65C18.05 19.56 17.5 19.78 16.74 19.36L12.6 16.3L10.61 18.23C10.38 18.46 10.19 18.65 9.78 18.65Z"/></svg>
                <span id="telegramBindText">ç»‘å®š Telegram</span>
                <span class="bind-badge" id="telegramBindBadge"></span>
            </div>
            <div class="user-card">
                <div class="user-avatar">{{ (user.name or 'U')[0].upper() }}</div>
                <div class="user-info-sidebar">
                    <div class="user-name">{{ user.name or 'ç”¨æˆ·' }}</div>
                    <div class="user-level">{{ level_name }}</div>
                </div>
            </div>
            <a href="/logout" class="logout-btn">
                <svg viewBox="0 0 24 24"><path d="M16,17V14H9V10H16V7L21,12L16,17M14,2A2,2 0 0,1 16,4V6H14V4H5V20H14V18H16V20A2,2 0 0,1 14,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H14Z"/></svg>
                <span>é€€å‡ºç™»å½•</span>
            </a>
            <div class="app-version">v{{ app_version }}</div>
        </div>
    </aside>
    
    <!-- ç§»åŠ¨ç«¯é¡¶éƒ¨æ  -->
    <header class="mobile-header">
        <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileSidebar()">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <div class="mobile-logo">
            {% if site_config.site_logo %}
            <img src="{{ site_config.site_logo }}" alt="Logo">
            {% endif %}
            <span>{{ site_config.site_name or 'Emby' }}</span>
        </div>
        <div class="mobile-user-avatar">{{ (user.name or 'U')[0].upper() }}</div>
    </header>
    
    <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ é®ç½© -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>
    
    <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
    <main class="main-content">
        
        <!-- ä¸»é¡µ Dashboard -->
        <section class="content-section active" id="section-home">
            {% if is_banned %}
            <!-- å°ç¦è­¦å‘Šæ¨ªå¹… -->
            <div class="banned-alert">
                <div class="banned-alert-icon">ğŸš«</div>
                <div class="banned-alert-content">
                    <h3>æ‚¨çš„è´¦å·å·²è¢«å°ç¦</h3>
                    <p>æ‚¨çš„è´¦å·å› è¿åä½¿ç”¨è§„åˆ™å·²è¢«ç¦ç”¨ï¼Œæ— æ³•ä½¿ç”¨ Emby æ’­æ”¾åŠŸèƒ½ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚</p>
                </div>
            </div>
            {% endif %}
            
            <!-- ç³»ç»Ÿå…¬å‘ŠåŒºåŸŸ - ç½®é¡¶æ˜¾ç¤º -->
            <div class="announcements-container announcements-top" id="announcementsContainer" style="display: none;">
                <div class="announcements-header">
                    <span class="announcements-title">ğŸ“¢ ç³»ç»Ÿå…¬å‘Š</span>
                    <div class="announcements-controls">
                        <button class="announcement-nav-btn" onclick="prevAnnouncement()" title="ä¸Šä¸€æ¡">
                            <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"/></svg>
                        </button>
                        <span class="announcement-indicator" id="announcementIndicator">1/1</span>
                        <button class="announcement-nav-btn" onclick="nextAnnouncement()" title="ä¸‹ä¸€æ¡">
                            <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"/></svg>
                        </button>
                    </div>
                    <button class="announcements-toggle" onclick="toggleAnnouncementsCollapse()" id="announcementsToggleBtn">æ”¶èµ·</button>
                </div>
                <div class="announcements-list" id="announcementsList">
                    <!-- å…¬å‘Šåˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
                </div>
            </div>
            
            <!-- å¿«æ·å…¥å£å¡ç‰‡ -->
            <div class="quick-actions-modern">
                <a href="#docs" class="quick-action-item" onclick="switchSection('docs')">
                    <div class="action-icon-wrapper docs">
                        <span>ğŸ“–</span>
                    </div>
                    <span class="action-title">ä½¿ç”¨æ–‡æ¡£</span>
                </a>
                <a href="#faq" class="quick-action-item" onclick="switchSection('faq')">
                    <div class="action-icon-wrapper faq">
                        <span>â“</span>
                    </div>
                    <span class="action-title">å¸¸è§é—®é¢˜</span>
                </a>
                <a href="#support" class="quick-action-item" onclick="switchSection('support')" id="supportQuickAction">
                    <div class="action-icon-wrapper support">
                        <span>ğŸ’¬</span>
                        <span class="unread-badge" id="supportUnreadBadge" style="display: none;"></span>
                    </div>
                    <span class="action-title">æŠ€æœ¯æ”¯æŒ</span>
                </a>
                <a href="#trending" class="quick-action-item" onclick="switchSection('trending')">
                    <div class="action-icon-wrapper trending">
                        <span>ğŸ”¥</span>
                    </div>
                    <span class="action-title">çƒ­é—¨æ¨è</span>
                </a>
            </div>
            
            <!-- è®¢é˜…ä¸çº¿è·¯ä¿¡æ¯ï¼ˆæ•´åˆï¼‰ -->
            <div class="dashboard-subscription-lines">
                <h2 class="section-title">
                    <span>ğŸ“¡ è´¦å·ä¸çº¿è·¯</span>
                    <div class="title-actions">
                        <button class="refresh-btn" onclick="loadServerLines()" title="åˆ·æ–°">ğŸ”„</button>
                        <a href="#subscription" class="view-all-link" onclick="switchSection('subscription')">è®¢é˜…è¯¦æƒ… â†’</a>
                    </div>
                </h2>
                <div class="subscription-lines-container">
                    <!-- å·¦ä¾§ï¼šè®¢é˜…çŠ¶æ€ -->
                    <div class="subscription-status-mini">
                        {% if user.lv == 'a' %}
                        <div class="status-badge-mini whitelist">
                            <span class="badge-icon">ğŸ‘‘</span>
                            <div class="badge-info">
                                <span class="badge-title">ç™½åå•ç”¨æˆ·</span>
                                <span class="badge-desc">æ°¸ä¹…æœ‰æ•ˆ Â· æ— é™æ±‚ç‰‡</span>
                            </div>
                        </div>
                        {% elif user.ex and user.ex > now %}
                        <div class="status-badge-mini subscriber">
                            <span class="badge-icon">âœ¨</span>
                            <div class="badge-info">
                                <span class="badge-title">è®¢é˜…ç”¨æˆ·</span>
                                <span class="badge-desc">æœ‰æ•ˆæœŸè‡³ {{ user.ex.strftime('%Y-%m-%d') }}</span>
                            </div>
                        </div>
                        {% else %}
                        <div class="status-badge-mini no-sub">
                            <span class="badge-icon">ğŸ“­</span>
                            <div class="badge-info">
                                <span class="badge-title">æœªè®¢é˜…</span>
                                <span class="badge-desc"><a href="#purchase" onclick="switchSection('purchase')">ç‚¹å‡»è´­ä¹°å¥—é¤</a></span>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    <!-- ä¸­é—´ï¼šçº¿è·¯ä¿¡æ¯ -->
                    <div class="server-lines-compact" id="serverLinesContainer">
                        <div class="loading-placeholder">
                            <div class="spinner"></div>
                            <p>åŠ è½½ä¸­...</p>
                        </div>
                    </div>
                    <!-- å³ä¾§ï¼šç­¾åˆ°å¡ç‰‡ -->
                    <div class="checkin-mini-card" id="checkinMiniCard" style="display: none;">
                        <div class="checkin-mini-content">
                            <div class="checkin-mini-header">
                                <span class="checkin-mini-icon">ğŸ¯</span>
                                <span class="checkin-mini-title">æ¯æ—¥ç­¾åˆ°</span>
                            </div>
                            <div class="checkin-mini-coins">
                                <span class="coin-icon-mini">ğŸ’°</span>
                                <span class="coin-value-mini" id="userCoinsMini">0</span>
                                <span class="coin-name-mini" id="coinNameMini">ç§¯åˆ†</span>
                            </div>
                            <button class="checkin-mini-btn" id="checkinMiniBtn" onclick="doCheckin()">
                                <span class="btn-text">ç­¾åˆ°</span>
                            </button>
                            <div class="checkin-mini-hint" id="checkinMiniHint">ç­¾åˆ°è·å¾—å¥–åŠ±</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- é‚€è¯·å¥½å‹ - æ–°è®¾è®¡ -->
            <div class="invite-banner-modern">
                <div class="invite-bg-pattern"></div>
                <div class="invite-content-wrapper">
                    <div class="invite-icon-big">ğŸ</div>
                    <div class="invite-info">
                        <h3>é‚€è¯·å¥½å‹ï¼Œå…±äº«è¿”åˆ©</h3>
                        <p>å¥½å‹é€šè¿‡æ‚¨çš„é‚€è¯·é“¾æ¥è´­ä¹°å¥—é¤ï¼Œæ‚¨å°†è·å¾—<strong>10%é‡‘é¢å¥–åŠ±</strong></p>
                    </div>
                    <button class="invite-action-btn" onclick="showInviteDialog()">
                        <span>ç«‹å³é‚€è¯·</span>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- ç­¾åˆ°å…‘æ¢åŒºåŸŸï¼ˆä»…å½“ç­¾åˆ°å¯ç”¨æ—¶æ˜¾ç¤ºï¼‰ -->
            <div class="checkin-exchange-section" id="checkinExchangeSection" style="display: none;">
                <!-- å…‘æ¢å¥—é¤åŒºåŸŸ -->
                <div class="exchange-section">
                    <h3 class="exchange-title">ğŸ ç§¯åˆ†å…‘æ¢</h3>
                    <div class="exchange-plans" id="exchangePlans">
                        <!-- åŠ¨æ€ç”Ÿæˆå¥—é¤åˆ—è¡¨ -->
                    </div>
                </div>
                
                <!-- å…‘æ¢è®°å½• -->
                <div class="exchange-records">
                    <div class="records-header">
                        <h3>å…‘æ¢è®°å½•</h3>
                        <button class="view-all-btn" onclick="viewAllExchangeRecords()">æŸ¥çœ‹å…¨éƒ¨</button>
                    </div>
                    <div class="records-list" id="exchangeRecordsList">
                        <!-- åŠ¨æ€ç”Ÿæˆè®°å½• -->
                    </div>
                </div>
            </div>
        </section>
        
        <!-- æœç´¢æ±‚ç‰‡é¡µé¢ -->
        <section class="content-section" id="section-search">
            <div class="section-header">
                <h1>ğŸ” æœç´¢æ±‚ç‰‡</h1>
                <p>åœ¨MoviePilotä¸­æœç´¢ä½ æƒ³è¦çš„ç”µå½±æˆ–å‰§é›†</p>
            </div>
            
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ¬</div>
                    <div class="stat-content">
                        <div class="stat-value" id="todayCount">{{ today_count }}</div>
                        <div class="stat-label">ä»Šæ—¥å·²æ±‚ç‰‡</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">â­</div>
                    <div class="stat-content">
                        <div class="stat-value" id="maxDaily">{{ max_daily }}</div>
                        <div class="stat-label">æ¯æ—¥é™é¢</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“Š</div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalRequests">{{ total_requests }}</div>
                        <div class="stat-label">æ€»æ±‚ç‰‡æ¬¡æ•°</div>
                    </div>
                </div>
                {% if library_counts and library_counts.total > 0 %}
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“¦</div>
                    <div class="stat-content">
                        <div class="stat-value">{{ library_counts.total }}</div>
                        <div class="stat-label">åª’ä½“åº“æ€»è®¡</div>
                    </div>
                </div>
                {% endif %}
            </div>
            
            <div class="message" id="message"></div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="è¾“å…¥ç”µå½±æˆ–å‰§é›†åç§°...">
                <button onclick="searchMovies()">ğŸ” æœç´¢</button>
            </div>
            
            <div class="search-filters" id="searchFilters" style="display: none;">
                <div class="filter-group">
                    <label>å¹´ä»½:</label>
                    <select id="filterYear" onchange="applyFilters()">
                        <option value="">å…¨éƒ¨å¹´ä»½</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ç±»å‹:</label>
                    <select id="filterType" onchange="applyFilters()">
                        <option value="">å…¨éƒ¨ç±»å‹</option>
                        <option value="movie">ç”µå½±</option>
                        <option value="tv">å‰§é›†</option>
                    </select>
                </div>
                <button class="filter-reset" onclick="resetFilters()">é‡ç½®</button>
            </div>
            
            <div class="search-loading">
                <div class="spinner"></div>
                <p>æœç´¢ä¸­...</p>
            </div>
            <div class="search-results" id="searchResults"></div>
            <div class="pagination" id="searchPagination" style="justify-content: center; margin-top: 16px;"></div>
        </section>
        
        <!-- çƒ­é—¨æ¨èé¡µé¢ -->
        <section class="content-section" id="section-trending">
            <div class="section-header">
                <h1>ğŸ”¥ çƒ­é—¨æ¨è</h1>
                <p>è¿‘å¹´çƒ­åº¦æœ€é«˜çš„ç”µå½±å’Œå‰§é›†</p>
            </div>
            
            <div class="trending-container">
                <div class="trending-section">
                    <div class="trending-header">
                        <h3>ğŸ¬ è¿‘å¹´çƒ­åº¦æœ€é«˜ç”µå½±</h3>
                        <div class="pagination" id="moviePagination"></div>
                    </div>
                    <div class="search-results" id="trendingMovies">
                        <p style="text-align: center; padding: 20px 0; color: #999;">åŠ è½½ä¸­...</p>
                    </div>
                </div>
                
                <div class="trending-section">
                    <div class="trending-header">
                        <h3>ğŸ“º è¿‘å¹´çƒ­åº¦æœ€é«˜å‰§é›†</h3>
                        <div class="pagination" id="tvPagination"></div>
                    </div>
                    <div class="search-results" id="trendingTV">
                        <p style="text-align: center; padding: 20px 0; color: #999;">åŠ è½½ä¸­...</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- æ±‚ç‰‡ç®¡ç†é¡µé¢ -->
        <section class="content-section" id="section-requests">
            <div class="section-header">
                <h1>ğŸ“‹ æ±‚ç‰‡ç®¡ç†</h1>
                <p>æŸ¥çœ‹å’Œç®¡ç†ä½ çš„æ‰€æœ‰æ±‚ç‰‡è®°å½•</p>
            </div>
            
            <div class="request-stats">
                <div class="request-stat-item">
                    <span class="status-dot pending"></span>
                    <span>å¾…å¤„ç†</span>
                </div>
                <div class="request-stat-item">
                    <span class="status-dot downloading"></span>
                    <span>ä¸‹è½½ä¸­</span>
                </div>
                <div class="request-stat-item">
                    <span class="status-dot completed"></span>
                    <span>å·²å®Œæˆ</span>
                </div>
                <div class="request-stat-item">
                    <span class="status-dot failed"></span>
                    <span>å¤±è´¥</span>
                </div>
            </div>
            
            <div class="pagination" id="requestPagination" style="margin-bottom: 20px;"></div>
            
            <div class="request-list" id="requestList">
                        {% if requests %}
                            {% for req in requests %}
                            <div class="request-item" data-index="{{ loop.index0 }}" data-request-id="{{ req.id }}">
                                {% if req.poster_path %}
                                <img src="{{ tmdb_image_base }}{{ req.poster_path }}" alt="{{ req.title }}">
                                {% else %}
                                <div style="width: 80px; height: 120px; background: #ddd; border-radius: 5px; display: flex; align-items: center; justify-content: center;">&#x1F3AC;</div>
                                {% endif %}
                                <div class="details">
                                    <h3>{{ req.title }} ({{ req.year }}) 
                                        <span style="font-size: 12px; background: #3b82f6; color: white; padding: 2px 8px; border-radius: 3px; margin-left: 8px;">
                                            {% if req.media_type == 'movie' %}&#x1F3AC; ç”µå½±{% else %}&#x1F4FA; å‰§é›†{% endif %}
                                        </span>
                                        {% if req.media_type == 'tv' and req.get_request_scope() %}
                                        <span style="font-size: 12px; background: #10b981; color: white; padding: 2px 8px; border-radius: 3px; margin-left: 4px;">
                                            ğŸ“‘ {{ req.get_request_scope() }}
                                        </span>
                                        {% endif %}
                                    </h3>
                                    <p>{{ req.overview[:100] }}...</p>
                                    <span class="status {{ req.status }}">
                                        {% if req.status == 'pending' %}å¾…å¤„ç†
                                        {% elif req.status == 'approved' %}å·²æ‰¹å‡†
                                        {% elif req.status == 'processing' %}å·²æ‰¹å‡†
                                        {% elif req.status == 'completed' %}å·²å®Œæˆ
                                        {% elif req.status == 'rejected' %}å·²æ‹’ç»
                                        {% elif req.status == 'downloading' %}ä¸‹è½½ä¸­
                                        {% elif req.status == 'downloaded' %}å¾…å…¥åº“
                                        {% elif req.status == 'failed' %}ä¸‹è½½å¤±è´¥
                                        {% endif %}
                                    </span>
                                    
                                    {% if req.status == 'downloading' and req.download_task %}
                                    {% if req.download_task.progress and req.download_task.progress >= 100 %}
                                    <!-- ä¸‹è½½å®Œæˆï¼Œå¾…å…¥åº“ -->
                                    <div class="download-status-card pending-release">
                                        <div class="card-header">
                                            <span class="icon">ğŸ“¦</span>
                                            <span class="title">ä¸‹è½½å®Œæˆ</span>
                                            <span class="badge">å¾…å…¥åº“</span>
                                        </div>
                                        <div class="download-progress completed" data-request-id="{{ req.id }}">
                                            <div class="progress-track">
                                                <div class="progress-fill" style="width: 100%;"></div>
                                            </div>
                                            <div class="progress-meta">
                                                <span class="progress-value" style="color: #f59e0b;">âœ… å·²ä¸‹è½½å®Œæˆ</span>
                                            </div>
                                        </div>
                                    </div>
                                    {% else %}
                                    <!-- ä¸‹è½½ä¸­çŠ¶æ€å¡ç‰‡ -->
                                    <div class="download-status-card downloading" data-request-id="{{ req.id }}">
                                        <div class="card-header">
                                            <span class="icon">â¬‡ï¸</span>
                                            <span class="title">æ­£åœ¨ä¸‹è½½</span>
                                            <span class="badge">è¿›è¡Œä¸­</span>
                                        </div>
                                        <div class="download-progress" data-request-id="{{ req.id }}" data-progress="{{ req.download_task.progress or 0 }}" data-speed="{{ req.download_task.download_speed or 0 }}" data-eta="{{ req.download_task.eta if req.download_task.eta is not none else -1 }}">
                                            <div class="progress-track">
                                                <div class="progress-fill" style="width: {{ (req.download_task.progress or 0)|round(1) }}%;"></div>
                                            </div>
                                            <div class="progress-meta">
                                                <span class="progress-value">{{ (req.download_task.progress or 0)|round(1) }}%</span>
                                                <span class="progress-speed">0 B/s</span>
                                                <span class="progress-eta">ETA --:--:--</span>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                    {% elif req.status == 'downloaded' %}
                                    <!-- å¾…å…¥åº“çŠ¶æ€å¡ç‰‡ -->
                                    <div class="download-status-card pending-release">
                                        <div class="card-header">
                                            <span class="icon">ğŸ“¦</span>
                                            <span class="title">ä¸‹è½½å®Œæˆ</span>
                                            <span class="badge">å¾…å…¥åº“</span>
                                        </div>
                                        <div class="pending-message">
                                            <div class="spinner"></div>
                                            <span>èµ„æºå·²ä¸‹è½½å®Œæˆï¼Œç­‰å¾…å…¥åº“åˆ°åª’ä½“åº“...</span>
                                        </div>
                                    </div>
                                    {% elif req.status == 'completed' %}
                                    <!-- å·²å®ŒæˆçŠ¶æ€å¡ç‰‡ -->
                                    <div class="download-status-card completed">
                                        <div class="card-header">
                                            <span class="icon">âœ…</span>
                                            <span class="title">å·²å…¥åº“</span>
                                            <span class="badge">å®Œæˆ</span>
                                        </div>
                                        <div class="complete-message">
                                            <span>ğŸ‰ èµ„æºå·²æˆåŠŸä¸Šæ¶ï¼Œå¯å‰å¾€åª’ä½“åº“è§‚çœ‹ï¼</span>
                                        </div>
                                    </div>
                                    {% elif req.status == 'failed' and req.download_task %}
                                    <!-- ä¸‹è½½å¤±è´¥çŠ¶æ€å¡ç‰‡ -->
                                    <div class="download-status-card failed" data-request-id="{{ req.id }}">
                                        <div class="card-header">
                                            <span class="icon">âŒ</span>
                                            <span class="title">ä¸‹è½½å¤±è´¥</span>
                                            <span class="badge failed-badge">å¤±è´¥</span>
                                        </div>
                                        <div class="failed-message">
                                            <p class="error-text">{{ req.download_task.error_message or 'ä¸‹è½½è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯' }}</p>
                                            {% if req.download_task.retry_count < req.download_task.max_retries %}
                                            <button class="retry-btn" onclick="retryDownload({{ req.id }}, this)">
                                                <span class="retry-icon">ğŸ”„</span>
                                                é‡è¯•ä¸‹è½½ ({{ req.download_task.retry_count }}/{{ req.download_task.max_retries }})
                                            </button>
                                            {% else %}
                                            <p class="retry-exhausted">å·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•° ({{ req.download_task.max_retries }}æ¬¡)</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    <p style="margin-top: 10px; font-size: 12px; color: #999;">
                                        æ±‚ç‰‡æ—¶é—´: {{ req.created_at.strftime('%Y-%m-%d %H:%M') }}
                                    </p>
                                    {% if req.user_note %}
                                    <p style="margin-top: 5px; font-size: 12px; color: #3b82f6;">
                                        ğŸ’¬ æˆ‘çš„å¤‡æ³¨: {{ req.user_note }}
                                    </p>
                                    {% endif %}
                                    {% if req.admin_note %}
                                    <p style="margin-top: 5px; font-size: 12px; color: #e74c3c;">
                                        ğŸ“ ç®¡ç†å‘˜å¤‡æ³¨: {{ req.admin_note }}
                                    </p>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="empty-state">
                                <div class="empty-icon">ğŸ“­</div>
                                <div class="empty-title">æš‚æ— æ±‚ç‰‡è®°å½•</div>
                                <div class="empty-desc">åœ¨ä¸Šæ–¹æœç´¢æ¡†ä¸­æœç´¢æƒ³çœ‹çš„å½±ç‰‡ï¼Œç‚¹å‡»å³å¯æäº¤æ±‚ç‰‡è¯·æ±‚</div>
                            </div>
                        {% endif %}
                    </div>
                </div>
        </section>
        
        <!-- æ’­æ”¾ç›‘æ§é¡µé¢ -->
        <section class="content-section" id="section-playback">
            <div class="section-header">
                <h1>ğŸ“º æ’­æ”¾ç›‘æ§</h1>
                <p>æŸ¥çœ‹æ‚¨çš„è®¾å¤‡ã€æ’­æ”¾çŠ¶æ€å’Œè§‚çœ‹å†å²</p>
            </div>
            
            <!-- æ’­æ”¾ç»Ÿè®¡å¡ç‰‡ -->
            <div class="playback-stats-grid">
                <div class="playback-stat-card stat-playing">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z"/></svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="playingCount">-</div>
                        <div class="stat-label">æ’­æ”¾ä¸­</div>
                    </div>
                </div>
                <div class="playback-stat-card stat-online" style="display: none;">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"/></svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="onlineDeviceCount">-</div>
                        <div class="stat-label">åœ¨çº¿è®¾å¤‡</div>
                    </div>
                </div>
                <div class="playback-stat-card stat-history">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M13.5,8H12V13L16.28,15.54L17,14.33L13.5,12.25V8M13,3A9,9 0 0,0 4,12H1L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3"/></svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="historyCount">-</div>
                        <div class="stat-label">è§‚çœ‹è®°å½•</div>
                    </div>
                </div>
            </div>
            
            <!-- æ­£åœ¨æ’­æ”¾ -->
            <div class="playback-section">
                <div class="section-title-bar">
                    <h3>â–¶ï¸ æ­£åœ¨æ’­æ”¾</h3>
                    <button class="refresh-btn" onclick="refreshPlaybackData()">
                        <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        åˆ·æ–°
                    </button>
                </div>
                <div id="devicesContainer">
                    <div class="loading-placeholder">
                        <div class="loading-spinner"></div>
                        <span>åŠ è½½ä¸­...</span>
                    </div>
                </div>
            </div>
            
            <!-- æˆ‘çš„è®¾å¤‡ -->
            <div class="playback-section">
                <div class="section-title-bar">
                    <h3>ğŸ“± æˆ‘çš„è®¾å¤‡</h3>
                    <span class="device-count-badge" id="myDeviceCount">0 ä¸ªè®¾å¤‡</span>
                </div>
                <div id="myDevicesContainer">
                    <div class="loading-placeholder">
                        <div class="loading-spinner"></div>
                        <span>åŠ è½½ä¸­...</span>
                    </div>
                </div>
            </div>
            
            <!-- æ’­æ”¾å†å² -->
            <div class="playback-section">
                <div class="section-title-bar">
                    <h3>ğŸ“œ æœ€è¿‘è§‚çœ‹</h3>
                    <select class="history-limit-select" id="historyLimitSelect" onchange="changeHistoryLimit()">
                        <option value="10">æœ€è¿‘ 10 æ¡</option>
                        <option value="20" selected>æœ€è¿‘ 20 æ¡</option>
                        <option value="50">æœ€è¿‘ 50 æ¡</option>
                    </select>
                </div>
                <div id="historyContainer">
                    <div class="loading-placeholder">
                        <div class="loading-spinner"></div>
                        <span>åŠ è½½ä¸­...</span>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- æˆ‘çš„ä¿¡æ¯é¡µé¢ -->
        <section class="content-section" id="section-profile">
            <div class="section-header">
                <h1>ğŸ‘¤ æˆ‘çš„ä¿¡æ¯</h1>
                <p>æŸ¥çœ‹ä½ çš„è´¦æˆ·ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®</p>
            </div>
            
            <!-- æ–°è®¾è®¡çš„ä¸ªäººä¿¡æ¯é¡µé¢ -->
            <div class="profile-page-v2">
                <!-- é¡¶éƒ¨ç”¨æˆ·å¡ç‰‡ -->
                <div class="user-profile-card">
                    <div class="user-profile-header">
                        <div class="user-avatar-lg">{{ (user.name or 'U')[0].upper() }}</div>
                        <div class="user-profile-info">
                            <h2 class="user-display-name">{{ user.name or 'ç”¨æˆ·' }}</h2>
                            <div class="user-badges">
                                <span class="user-badge {% if user.lv == 'c' %}badge-banned{% elif user.lv == 'a' %}badge-vip{% elif user.ex and user.ex > now %}badge-sub{% else %}badge-normal{% endif %}">
                                    {% if user.lv == 'c' %}ğŸš« å·²å°ç¦{% elif user.lv == 'a' %}ğŸ‘‘ ç™½åå•{% elif user.ex and user.ex > now %}â­ è®¢é˜…ä¸­{% else %}æ™®é€šç”¨æˆ·{% endif %}
                                </span>
                                {% if user.embyid %}
                                <span class="user-badge badge-emby">âœ“ Emby å·²ç»‘å®š</span>
                                {% else %}
                                <span class="user-badge badge-warning">âš  æœªç»‘å®šEmby</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ•°æ®ç»Ÿè®¡åŒºåŸŸ -->
                <div class="stats-section-v2">
                    <h3 class="section-title-v2"><span class="title-icon">ğŸ“Š</span> æ•°æ®ç»Ÿè®¡</h3>
                    <div class="stats-row">
                        <div class="stat-item-v2">
                            <div class="stat-icon-v2 icon-today">ğŸ¬</div>
                            <div class="stat-info-v2">
                                <span class="stat-num">{{ today_count }}</span>
                                <span class="stat-text">ä»Šæ—¥æ±‚ç‰‡</span>
                            </div>
                        </div>
                        <div class="stat-item-v2">
                            <div class="stat-icon-v2 icon-total">ğŸ“ˆ</div>
                            <div class="stat-info-v2">
                                <span class="stat-num">{{ total_requests }}</span>
                                <span class="stat-text">æ€»æ±‚ç‰‡æ•°</span>
                            </div>
                        </div>
                        <div class="stat-item-v2">
                            <div class="stat-icon-v2 icon-daily">ğŸ“…</div>
                            <div class="stat-info-v2">
                                <span class="stat-num">{{ max_daily }}</span>
                                <span class="stat-text">æ¯æ—¥é™é¢</span>
                            </div>
                        </div>
                    </div>
                    {% if library_counts and library_counts.total > 0 %}
                    <div class="library-stats-card">
                        <div class="library-stats-header">
                            <span class="library-icon">ï¿½</span>
                            <span class="library-title">åª’ä½“åº“ç»Ÿè®¡</span>
                            <span class="library-total">å…± {{ "{:,}".format(library_counts.total) }} é¡¹</span>
                        </div>
                        <div class="library-stats-grid">
                            <div class="library-stat-item">
                                <div class="library-stat-icon">ğŸ¥</div>
                                <div class="library-stat-data">
                                    <span class="library-stat-value">{{ "{:,}".format(library_counts.movies) }}</span>
                                    <span class="library-stat-label">ç”µå½±</span>
                                </div>
                            </div>
                            <div class="library-stat-item">
                                <div class="library-stat-icon">ğŸ“º</div>
                                <div class="library-stat-data">
                                    <span class="library-stat-value">{{ "{:,}".format(library_counts.series) }}</span>
                                    <span class="library-stat-label">å‰§é›†</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- åŠŸèƒ½å¡ç‰‡åŒºåŸŸ -->
                <div class="feature-cards-v2">
                    <!-- Emby è´¦å·ç®¡ç† -->
                    <div class="feature-card-v2">
                        <div class="feature-card-header-v2">
                            <span class="feature-icon-v2">ğŸ¬</span>
                            <span class="feature-title-v2">Emby è´¦å·</span>
                            {% if user.embyid %}
                            <span class="feature-badge success">å·²ç»‘å®š</span>
                            {% else %}
                            <span class="feature-badge warning">æœªç»‘å®š</span>
                            {% endif %}
                        </div>
                        <div class="feature-card-content-v2">
                            {% if user.embyid %}
                            <div class="emby-info-list">
                                <div class="emby-info-row">
                                    <span class="info-key">ç”¨æˆ·å</span>
                                    <span class="info-val">{{ user.emby_name or user.name }}</span>
                                </div>
                                <div class="emby-info-row">
                                    <span class="info-key">Emby ID</span>
                                    <span class="info-val mono">{{ user.embyid[:16] }}...</span>
                                </div>
                            </div>
                            <p class="emby-bindtip">ğŸ’¡ å¦‚éœ€æ›´æ¢Embyè´¦å·ï¼Œè¯·è”ç³»ç®¡ç†å‘˜åˆ é™¤å½“å‰è´¦å·åé‡æ–°ç»‘å®š</p>
                            {% else %}
                            <p class="feature-desc-v2">ç»‘å®šå·²æœ‰Embyè´¦å·æˆ–åˆ›å»ºæ–°è´¦å·</p>
                            <div class="btn-group-v2">
                                <button class="btn-v2 btn-primary-v2" onclick="showEmbyBindDialog()">ğŸ”— ç»‘å®šå·²æœ‰è´¦å·</button>
                                {% if user.lv == 'a' or (user.ex and user.ex > now) %}
                                <button class="btn-v2 btn-secondary-v2" onclick="showEmbyCreateDialog()">â• åˆ›å»ºæ–°è´¦å·</button>
                                {% else %}
                                <button class="btn-v2 btn-secondary-v2 btn-disabled" onclick="showToast('æ‚¨æ²¡æœ‰æœ‰æ•ˆè®¢é˜…ï¼Œæ— æ³•åˆ›å»ºæ–°è´¦å·', 'error')" title="éœ€è¦æœ‰æ•ˆè®¢é˜…">â• åˆ›å»ºæ–°è´¦å·</button>
                                {% endif %}
                            </div>
                            {% if not (user.lv == 'a' or (user.ex and user.ex > now)) %}
                            <p class="subscription-sub-tip" style="margin-top: 12px; font-size: 12px; color: #f59e0b;">ğŸ’¡ è´­ä¹°è®¢é˜…åå¯åˆ›å»ºæ–°Embyè´¦å·</p>
                            {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- ä¿®æ”¹ç½‘ç«™ç™»å½•å¯†ç  -->
                    <div class="feature-card-v2">
                        <div class="feature-card-header-v2">
                            <span class="feature-icon-v2">ğŸ”</span>
                            <span class="feature-title-v2">ä¿®æ”¹ç½‘ç«™å¯†ç </span>
                        </div>
                        <div class="feature-card-content-v2">
                            <div class="password-notice-v2">
                                <span>ğŸ’¡</span> ç”¨äºç™»å½•æœ¬ç½‘ç«™çš„å¯†ç 
                            </div>
                            <form id="changePasswordForm" onsubmit="return changePassword(event)">
                                <div class="form-field-v2">
                                    <label>å½“å‰å¯†ç </label>
                                    <div class="input-group-v2">
                                        <input type="password" id="currentPassword" name="currentPassword" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç " required>
                                        <button type="button" class="toggle-pwd-v2" onclick="togglePasswordVisibilityField('currentPassword', this)">ğŸ‘ï¸</button>
                                    </div>
                                </div>
                                <div class="form-field-v2">
                                    <label>æ–°å¯†ç </label>
                                    <div class="input-group-v2">
                                        <input type="password" id="newPassword" name="newPassword" placeholder="è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" required minlength="6">
                                        <button type="button" class="toggle-pwd-v2" onclick="togglePasswordVisibilityField('newPassword', this)">ğŸ‘ï¸</button>
                                    </div>
                                </div>
                                <div class="form-field-v2">
                                    <label>ç¡®è®¤å¯†ç </label>
                                    <div class="input-group-v2">
                                        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="å†æ¬¡è¾“å…¥æ–°å¯†ç " required minlength="6">
                                        <button type="button" class="toggle-pwd-v2" onclick="togglePasswordVisibilityField('confirmPassword', this)">ğŸ‘ï¸</button>
                                    </div>
                                </div>
                                <button type="submit" class="btn-v2 btn-primary-v2 btn-full" id="changePasswordBtn">
                                    <span class="btn-text">ç¡®è®¤ä¿®æ”¹</span>
                                    <span class="btn-loading" style="display: none;">ä¿®æ”¹ä¸­...</span>
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- ä¿®æ”¹ Emby å¯†ç  -->
                    {% if user.embyid %}
                    <div class="feature-card-v2">
                        <div class="feature-card-header-v2">
                            <span class="feature-icon-v2">ğŸ¬</span>
                            <span class="feature-title-v2">ä¿®æ”¹ Emby å¯†ç </span>
                        </div>
                        <div class="feature-card-content-v2">
                            <div class="password-notice-v2">
                                <span>ğŸ’¡</span> ç”¨äºç™»å½• Emby å®¢æˆ·ç«¯çš„å¯†ç ï¼ˆä¸ç½‘ç«™å¯†ç ç‹¬ç«‹ï¼‰
                            </div>
                            <form id="changeEmbyPasswordForm" onsubmit="return changeEmbyPassword(event)">
                                <div class="form-field-v2">
                                    <label>å½“å‰ Emby å¯†ç </label>
                                    <div class="input-group-v2">
                                        <input type="password" id="currentEmbyPassword" name="currentEmbyPassword" placeholder="è¯·è¾“å…¥å½“å‰ Emby å¯†ç " required>
                                        <button type="button" class="toggle-pwd-v2" onclick="togglePasswordVisibilityField('currentEmbyPassword', this)">ğŸ‘ï¸</button>
                                    </div>
                                </div>
                                <div class="form-field-v2">
                                    <label>æ–° Emby å¯†ç </label>
                                    <div class="input-group-v2">
                                        <input type="password" id="newEmbyPassword" name="newEmbyPassword" placeholder="è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" required minlength="6">
                                        <button type="button" class="toggle-pwd-v2" onclick="togglePasswordVisibilityField('newEmbyPassword', this)">ğŸ‘ï¸</button>
                                    </div>
                                </div>
                                <div class="form-field-v2">
                                    <label>ç¡®è®¤æ–°å¯†ç </label>
                                    <div class="input-group-v2">
                                        <input type="password" id="confirmEmbyPassword" name="confirmEmbyPassword" placeholder="å†æ¬¡è¾“å…¥æ–°å¯†ç " required minlength="6">
                                        <button type="button" class="toggle-pwd-v2" onclick="togglePasswordVisibilityField('confirmEmbyPassword', this)">ğŸ‘ï¸</button>
                                    </div>
                                </div>
                                <button type="submit" class="btn-v2 btn-primary-v2 btn-full" id="changeEmbyPasswordBtn">
                                    <span class="btn-text">ç¡®è®¤ä¿®æ”¹</span>
                                    <span class="btn-loading" style="display: none;">ä¿®æ”¹ä¸­...</span>
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- å±é™©æ“ä½œåŒºåŸŸ -->
                <div class="danger-zone-v2">
                    <div class="danger-zone-header-v2">
                        <span>âš ï¸</span> å±é™©æ“ä½œ
                    </div>
                    <div class="danger-zone-content-v2">
                        <div class="danger-item-v2">
                            <div class="danger-text">
                                <strong>åˆ é™¤è´¦å·</strong>
                                <span>æ°¸ä¹…åˆ é™¤æ‚¨çš„è´¦å·åŠæ‰€æœ‰æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€</span>
                            </div>
                            <button class="btn-v2 btn-danger-v2" onclick="showDeleteAccountDialog()">åˆ é™¤è´¦å·</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- æ“ä½œæ—¥å¿—é¡µé¢ -->
        <section class="content-section" id="section-activity-logs">
            <div class="section-header">
                <h1>ğŸ“ æ“ä½œæ—¥å¿—</h1>
                <p>æŸ¥çœ‹æ‚¨çš„è´¦æˆ·æ´»åŠ¨è®°å½•</p>
            </div>
            
            <div class="activity-logs-page">
                <!-- ç­›é€‰æ  -->
                <div class="activity-filter-bar">
                    <select id="activityTypeFilter" class="activity-filter-select" onchange="loadMyActivityLogs()">
                        <option value="">ğŸ“‹ å…¨éƒ¨æ—¥å¿—</option>
                        <option value="login">ğŸ” ç™»å½•ç™»å‡º</option>
                        <option value="password_change">ğŸ”‘ å¯†ç ä¿®æ”¹</option>
                        <option value="request_movie">ğŸ¬ æ±‚ç‰‡è®°å½•</option>
                        <option value="view_lines">ğŸ”— æŸ¥çœ‹çº¿è·¯</option>
                        <option value="payment_success">ğŸ’° å……å€¼è®°å½•</option>
                        <option value="redeem_code">ğŸŸï¸ å…‘æ¢è®°å½•</option>
                        <option value="subscription_change">ğŸ’ è®¢é˜…å˜æ›´</option>
                        <option value="emby_account_create">ğŸ†• Embyè´¦å·</option>
                    </select>
                    <select id="activityDaysFilter" class="activity-filter-select" onchange="loadMyActivityLogs()">
                        <option value="7">â° æœ€è¿‘7å¤©</option>
                        <option value="30" selected>â° æœ€è¿‘30å¤©</option>
                        <option value="90">â° æœ€è¿‘90å¤©</option>
                        <option value="">â° å…¨éƒ¨æ—¶é—´</option>
                    </select>
                    <button class="activity-refresh-btn" onclick="loadMyActivityLogs()">
                        ğŸ”„ åˆ·æ–°
                    </button>
                </div>
                
                <!-- æ—¥å¿—åˆ—è¡¨ -->
                <div class="activity-logs-list" id="myActivityLogsList">
                    <div class="activity-loading">
                        <div class="spinner"></div>
                        <p>æ­£åœ¨åŠ è½½æ—¥å¿—...</p>
                    </div>
                </div>
                
                <!-- åˆ†é¡µ -->
                <div class="activity-pagination" id="myActivityPagination">
                </div>
            </div>
        </section>
        
        <!-- æˆ‘çš„è®¢é˜…é¡µé¢ -->
        <section class="content-section" id="section-subscription">
            <div class="section-header">
                <h1>ğŸ’³ æˆ‘çš„è®¢é˜…</h1>
                <p>æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„è®¢é˜…ä¿¡æ¯</p>
            </div>
            
            <div class="subscription-page-container">
                <!-- å½“å‰è®¢é˜…çŠ¶æ€å¡ç‰‡ - æ–°è®¾è®¡ -->
                <div class="subscription-hero-card">
                    <div class="subscription-hero-bg"></div>
                    <div class="subscription-hero-content">
                        <div class="hero-left">
                            <div class="hero-badge">
                                <span class="badge-icon">ğŸ‘‘</span>
                                <span class="badge-text" id="subscriptionBadgeText">åŠ è½½ä¸­...</span>
                            </div>
                            <div class="hero-title">
                                <h2 id="subscriptionUserName">{{ user.name or 'ç”¨æˆ·' }}</h2>
                                <span class="hero-level" id="subscriptionLevelName">{{ level_name }}</span>
                            </div>
                        </div>
                        <div class="hero-right">
                            <div class="hero-countdown" id="subscriptionCountdown">
                                <div class="countdown-ring">
                                    <svg viewBox="0 0 100 100">
                                        <circle class="countdown-bg" cx="50" cy="50" r="45"/>
                                        <circle class="countdown-progress" cx="50" cy="50" r="45" id="countdownProgress"/>
                                    </svg>
                                    <div class="countdown-inner">
                                        <span class="countdown-days" id="countdownDays">--</span>
                                        <span class="countdown-label">å‰©ä½™å¤©æ•°</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- è®¢é˜…è¯¦æƒ…ç½‘æ ¼ -->
                <div class="subscription-details-grid">
                    <div class="detail-card">
                        <div class="detail-icon">ğŸ“…</div>
                        <div class="detail-info">
                            <span class="detail-label">å¼€å§‹æ—¥æœŸ</span>
                            <span class="detail-value" id="subscriptionStartDate">--</span>
                        </div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-icon">â°</div>
                        <div class="detail-info">
                            <span class="detail-label">åˆ°æœŸæ—¥æœŸ</span>
                            <span class="detail-value" id="subscriptionEndDate">--</span>
                        </div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-icon">ğŸ¬</div>
                        <div class="detail-info">
                            <span class="detail-label">æ¯æ—¥æ±‚ç‰‡é™é¢</span>
                            <span class="detail-value" id="subscriptionDailyLimit">{{ max_daily }}</span>
                        </div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-icon">ğŸ“Š</div>
                        <div class="detail-info">
                            <span class="detail-label">ç´¯è®¡æ±‚ç‰‡</span>
                            <span class="detail-value" id="subscriptionTotalRequests">{{ total_requests }}</span>
                        </div>
                    </div>
                </div>
                
                <!-- å¿«æ·æ“ä½œæŒ‰é’®ç»„ -->
                <div class="subscription-action-group">
                    <a href="#purchase" class="sub-action-btn primary" onclick="switchSection('purchase')">
                        <div class="btn-icon">ğŸ›’</div>
                        <div class="btn-content">
                            <span class="btn-title">è´­ä¹°/ç»­è´¹å¥—é¤</span>
                            <span class="btn-desc">é€‰æ‹©é€‚åˆæ‚¨çš„å¥—é¤</span>
                        </div>
                        <span class="btn-arrow">â†’</span>
                    </a>
                    <button class="sub-action-btn secondary" onclick="refreshSubscription()">
                        <div class="btn-icon">ğŸ”„</div>
                        <div class="btn-content">
                            <span class="btn-title">åˆ·æ–°çŠ¶æ€</span>
                            <span class="btn-desc">è·å–æœ€æ–°è®¢é˜…ä¿¡æ¯</span>
                        </div>
                    </button>
                </div>
                
                <!-- è®¢é˜…å†å²æ—¶é—´çº¿ -->
                <div class="subscription-history-section">
                    <div class="history-header">
                        <h3>ğŸ“œ è®¢é˜…å†å²</h3>
                        <span class="history-count" id="subscriptionHistoryCount">0 æ¡è®°å½•</span>
                    </div>
                    <div class="history-timeline" id="subscriptionHistory">
                        <div class="history-empty">
                            <div class="empty-illustration">
                                <svg viewBox="0 0 200 150" fill="none">
                                    <rect x="40" y="30" width="120" height="90" rx="8" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="2"/>
                                    <path d="M60 60h80M60 80h60M60 100h40" stroke="#cbd5e1" stroke-width="3" stroke-linecap="round"/>
                                    <circle cx="160" cy="110" r="25" fill="#667eea" opacity="0.1"/>
                                    <path d="M155 105l5 5 10-10" stroke="#667eea" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <p>æš‚æ— è®¢é˜…è®°å½•</p>
                            <span>è´­ä¹°å¥—é¤åè®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</span>
                        </div>
                    </div>
                </div>
                
                <!-- æƒç›Šè¯´æ˜ - æ ¹æ®è®¢é˜…ç­‰çº§åŠ¨æ€æ˜¾ç¤º -->
                <div class="subscription-benefits">
                    <h3>ğŸ è®¢é˜…æƒç›Š</h3>
                    <div class="benefits-grid" id="benefitsGrid">
                        <!-- æƒç›Šå°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
                        <div class="benefit-item">
                            <div class="benefit-icon">ğŸ¬</div>
                            <span class="benefit-text">æ— é™åˆ¶æ±‚ç‰‡</span>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">âš¡</div>
                            <span class="benefit-text">ä¼˜å…ˆå¤„ç†</span>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">ğŸ“º</div>
                            <span class="benefit-text">é«˜æ¸…èµ„æº</span>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">ğŸ’¬</div>
                            <span class="benefit-text">ä¸“å±å®¢æœ</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- è´­ä¹°å¥—é¤é¡µé¢ -->
        <section class="content-section" id="section-purchase">
            <div class="section-header">
                <h1>ğŸ›’ è´­ä¹°å¥—é¤</h1>
                <p>é€‰æ‹©é€‚åˆæ‚¨çš„è®¢é˜…å¥—é¤ï¼Œç‚¹å‡»ä»·æ ¼å³å¯è´­ä¹°</p>
            </div>
            
            <!-- å…‘æ¢ç åŒºåŸŸ - é†’ç›®ä½ç½® -->
            <div class="redeem-card">
                <div class="redeem-card-icon">ğŸ</div>
                <div class="redeem-card-content">
                    <div class="redeem-card-title">æœ‰å…‘æ¢ç ï¼Ÿç«‹å³å…‘æ¢</div>
                    <div class="redeem-card-desc">è¾“å…¥å…‘æ¢ç å³å¯æ¿€æ´»å¥—é¤æˆ–ç»­è´¹</div>
                </div>
                <div class="redeem-card-form">
                    <input type="text" id="redeemCodeInput" placeholder="è¾“å…¥å…‘æ¢ç " maxlength="20">
                    <button id="redeemBtn" class="redeem-btn" onclick="redeemCode()">ç«‹å³å…‘æ¢</button>
                </div>
            </div>
            
            <div class="purchase-container">
                <!-- å¥—é¤é€‰æ‹© - åŠ¨æ€åŠ è½½ï¼Œæ˜¾ç¤ºæ‰€æœ‰å‘¨æœŸä»·æ ¼ -->
                <div class="plans-grid-new" id="plansGrid">
                    <div class="plans-loading">åŠ è½½å¥—é¤ä¸­...</div>
                </div>
                
                <!-- è´­ä¹°æç¤º -->
                <div class="purchase-tips">
                    <div class="tip-item">
                        <span class="tip-icon">âœ…</span>
                        <span>æ”¯ä»˜æˆåŠŸåè®¢é˜…è‡ªåŠ¨ç”Ÿæ•ˆ</span>
                    </div>
                    <div class="tip-item">
                        <span class="tip-icon">ğŸ”’</span>
                        <span>å®‰å…¨æ”¯ä»˜ï¼Œæ”¯æŒæ”¯ä»˜å®/å¾®ä¿¡</span>
                    </div>
                    <div class="tip-item">
                        <span class="tip-icon">ğŸ’¬</span>
                        <span>é‡åˆ°é—®é¢˜è¯·è”ç³»å®¢æœ</span>
                    </div>
                </div>
                
                <!-- æˆ‘çš„è®¢å• -->
                <div class="my-orders-section">
                    <div class="orders-header">
                        <h3>ğŸ“‹ æˆ‘çš„è®¢å•</h3>
                        <button class="refresh-orders-btn" onclick="loadMyOrders()">
                            <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                            åˆ·æ–°
                        </button>
                    </div>
                    <div class="orders-list" id="myOrdersList">
                        <div class="orders-loading">åŠ è½½è®¢å•ä¸­...</div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- é‚€è¯·è¿”åˆ©é¡µé¢ -->
        <section class="content-section" id="section-invite">
            <div class="section-header">
                <h1>ğŸ é‚€è¯·è¿”åˆ©</h1>
                <p>é‚€è¯·å¥½å‹æ³¨å†Œå¹¶è´­ä¹°ï¼Œè·èµ è´­ä¹°é‡‘é¢ 10% é‡‘é¢</p>
            </div>
            
            <div class="invite-container">
                <!-- é‚€è¯·ç å¡ç‰‡ -->
                <div class="invite-code-card">
                    <div class="invite-code-header">
                        <span class="icon">ğŸ«</span>
                        <span class="title">æˆ‘çš„é‚€è¯·ç </span>
                    </div>
                    <div class="invite-code-content">
                        <div class="code-display" id="myInviteCode">åŠ è½½ä¸­...</div>
                        <button class="copy-btn" onclick="copyInviteCode()">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg>
                            å¤åˆ¶
                        </button>
                    </div>
                    <div class="invite-link-section">
                        <label>é‚€è¯·é“¾æ¥ï¼š</label>
                        <div class="link-box">
                            <input type="text" id="inviteLink" readonly value="">
                            <button class="copy-link-btn" onclick="copyInviteLink()">å¤åˆ¶é“¾æ¥</button>
                        </div>
                    </div>
                </div>
                
                <!-- å¥–åŠ±è¯´æ˜ -->
                <div class="reward-rules">
                    <h3>ğŸ¯ å¥–åŠ±è§„åˆ™</h3>
                    <div class="rules-grid">
                        <div class="rule-item">
                            <div class="rule-icon">ğŸ</div>
                            <div class="rule-content">
                                <div class="rule-title">é‚€è¯·è¿”åˆ©</div>
                                <div class="rule-desc">å¥½å‹é€šè¿‡æ‚¨çš„é‚€è¯·ç æ³¨å†Œå¹¶è´­ä¹°å¥—é¤</div>
                                <div class="rule-reward">è·èµ è´­ä¹°é‡‘é¢ 10% </div>
                            </div>
                        </div>
                        <div class="rule-item">
                            <div class="rule-icon">â™¾ï¸</div>
                            <div class="rule-content">
                                <div class="rule-title">é•¿æœŸæœ‰æ•ˆ</div>
                                <div class="rule-desc">å¥½å‹æ¯æ¬¡ç»­è´¹æ‚¨éƒ½èƒ½è·å¾—è¿”åˆ©</div>
                                <div class="rule-reward">æ°¸ä¹…ç»‘å®šå…³ç³»</div>
                            </div>
                        </div>
                        <div class="rule-item">
                            <div class="rule-icon">âš¡</div>
                            <div class="rule-content">
                                <div class="rule-title">å³æ—¶åˆ°è´¦</div>
                                <div class="rule-desc">å¥½å‹æ”¯ä»˜æˆåŠŸåè‡ªåŠ¨å‘æ”¾å¥–åŠ±</div>
                                <div class="rule-reward">æ— éœ€æ‰‹åŠ¨é¢†å–</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- é‚€è¯·ç»Ÿè®¡ -->
                <div class="invite-stats">
                    <h3>ğŸ“Š é‚€è¯·ç»Ÿè®¡</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalInvites">0</div>
                            <div class="stat-label">æ€»é‚€è¯·äººæ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="validInvites">0</div>
                            <div class="stat-label">æœ‰æ•ˆé‚€è¯·</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalReward">0</div>
                            <div class="stat-label">ç´¯è®¡å¥–åŠ±(å¤©)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="pendingReward">0</div>
                            <div class="stat-label">å¾…é¢†å–å¥–åŠ±</div>
                        </div>
                    </div>
                </div>
                
                <!-- é‚€è¯·è®°å½• -->
                <div class="invite-records">
                    <h3>ğŸ“‹ é‚€è¯·è®°å½•</h3>
                    <div class="records-list" id="inviteRecords">
                        <div class="empty-state small">
                            <div class="empty-icon">ğŸ“­</div>
                            <div class="empty-title">æš‚æ— é‚€è¯·è®°å½•</div>
                            <div class="empty-desc">åˆ†äº«æ‚¨çš„é‚€è¯·ç ç»™å¥½å‹å¼€å§‹èµšå–å¥–åŠ±</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- ä½¿ç”¨æ–‡æ¡£é¡µé¢ -->
        <section class="content-section" id="section-docs">
            <div class="section-header">
                <h1>ğŸ“š ä½¿ç”¨æ–‡æ¡£</h1>
                <p>è¯¦ç»†çš„ä½¿ç”¨æ•™ç¨‹å’ŒåŠŸèƒ½ä»‹ç»</p>
            </div>
            
            <div class="docs-container">
                <!-- å¿«é€Ÿå¯¼èˆª -->
                <div class="docs-nav">
                    <div class="nav-title">ğŸ“‘ ç›®å½•</div>
                    <ul class="nav-list">
                        <li><a href="#doc-start" onclick="scrollToDoc('doc-start')">å¿«é€Ÿå¼€å§‹</a></li>
                        <li><a href="#doc-search" onclick="scrollToDoc('doc-search')">æœç´¢æ±‚ç‰‡</a></li>
                        <li><a href="#doc-status" onclick="scrollToDoc('doc-status')">çŠ¶æ€è¯´æ˜</a></li>
                        <li><a href="#doc-emby" onclick="scrollToDoc('doc-emby')">Emby ä½¿ç”¨</a></li>
                        <li><a href="#doc-mobile" onclick="scrollToDoc('doc-mobile')">ç§»åŠ¨ç«¯ä½¿ç”¨</a></li>
                        <li><a href="#doc-account" onclick="scrollToDoc('doc-account')">è´¦æˆ·ç®¡ç†</a></li>
                    </ul>
                </div>
                
                <!-- æ–‡æ¡£å†…å®¹ -->
                <div class="docs-content">
                    <article class="doc-section" id="doc-start">
                        <h2>ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
                        <div class="doc-body">
                            <p>{{ site_config.welcome_message or 'æ¬¢è¿ä½¿ç”¨ Emby ç®¡ç†ç³»ç»Ÿï¼' }}{{ site_config.docs_intro or 'ä»¥ä¸‹æ˜¯å¿«é€Ÿå…¥é—¨æŒ‡å—ï¼š' }}</p>
                            <ol>
                                <li><strong>ç™»å½•ç³»ç»Ÿ</strong>ï¼šä½¿ç”¨æ‚¨çš„ Telegram è´¦å·ç»‘å®šç™»å½•</li>
                                <li><strong>æœç´¢å½±ç‰‡</strong>ï¼šåœ¨æœç´¢æ¡†è¾“å…¥æƒ³çœ‹çš„ç”µå½±æˆ–å‰§é›†åç§°</li>
                                <li><strong>æäº¤æ±‚ç‰‡</strong>ï¼šæ‰¾åˆ°ç›®æ ‡å½±ç‰‡åç‚¹å‡»å³å¯æäº¤æ±‚ç‰‡è¯·æ±‚</li>
                                <li><strong>ç­‰å¾…å¤„ç†</strong>ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†æ‚¨çš„æ±‚ç‰‡è¯·æ±‚</li>
                                <li><strong>è§‚çœ‹å½±ç‰‡</strong>ï¼šå¤„ç†å®Œæˆåå³å¯åœ¨ Emby ä¸­è§‚çœ‹</li>
                            </ol>
                            <div class="doc-tip">
                                <span class="tip-icon">ğŸ’¡</span>
                                <span class="tip-text">æç¤ºï¼šæ¯æ—¥æ±‚ç‰‡æ¬¡æ•°æ ¹æ®ä¼šå‘˜ç­‰çº§æœ‰æ‰€ä¸åŒï¼Œè¯·åˆç†ä½¿ç”¨ã€‚</span>
                            </div>
                        </div>
                    </article>
                    
                    <article class="doc-section" id="doc-search">
                        <h2>ğŸ” æœç´¢æ±‚ç‰‡</h2>
                        <div class="doc-body">
                            <h3>æœç´¢æŠ€å·§</h3>
                            <ul>
                                <li>æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ç­‰å¤šè¯­è¨€æœç´¢</li>
                                <li>å¯ä»¥æœç´¢ç”µå½±åã€å¯¼æ¼”åã€æ¼”å‘˜å</li>
                                <li>å»ºè®®ä½¿ç”¨å®˜æ–¹è¯‘åä»¥è·å¾—æ›´å‡†ç¡®çš„ç»“æœ</li>
                                <li>å¹´ä»½å¯ä»¥å¸®åŠ©åŒºåˆ†åŒåå½±ç‰‡</li>
                            </ul>
                            <h3>æ±‚ç‰‡æµç¨‹</h3>
                            <ol>
                                <li>åœ¨æœç´¢æ¡†è¾“å…¥å…³é”®è¯</li>
                                <li>ä»æœç´¢ç»“æœä¸­é€‰æ‹©ç›®æ ‡å½±ç‰‡</li>
                                <li>ç¡®è®¤å½±ç‰‡ä¿¡æ¯åæäº¤æ±‚ç‰‡</li>
                                <li>å¦‚æœæ˜¯å‰§é›†ï¼Œå¯é€‰æ‹©æŒ‡å®šå­£/é›†</li>
                            </ol>
                        </div>
                    </article>
                    
                    <article class="doc-section" id="doc-status">
                        <h2>ğŸ“Š çŠ¶æ€è¯´æ˜</h2>
                        <div class="doc-body">
                            <div class="status-table">
                                <div class="status-row">
                                    <span class="status-badge pending">å¾…å¤„ç†</span>
                                    <span class="status-desc">æ±‚ç‰‡å·²æäº¤ï¼Œç­‰å¾…ç³»ç»Ÿå¤„ç†</span>
                                </div>
                                <div class="status-row">
                                    <span class="status-badge downloading">ä¸‹è½½ä¸­</span>
                                    <span class="status-desc">èµ„æºæ­£åœ¨ä¸‹è½½ï¼Œè¯·è€å¿ƒç­‰å¾…</span>
                                </div>
                                <div class="status-row">
                                    <span class="status-badge downloaded">å¾…å…¥åº“</span>
                                    <span class="status-desc">ä¸‹è½½å®Œæˆï¼Œç­‰å¾…å…¥åº“åˆ°åª’ä½“åº“</span>
                                </div>
                                <div class="status-row">
                                    <span class="status-badge completed">å·²å®Œæˆ</span>
                                    <span class="status-desc">å·²å…¥åº“ï¼Œå¯åœ¨ Emby ä¸­è§‚çœ‹</span>
                                </div>
                                <div class="status-row">
                                    <span class="status-badge failed">å¤±è´¥</span>
                                    <span class="status-desc">å¤„ç†å¤±è´¥ï¼Œå¯å°è¯•é‡æ–°æ±‚ç‰‡</span>
                                </div>
                            </div>
                        </div>
                    </article>
                    
                    <article class="doc-section" id="doc-emby">
                        <h2>ğŸ“º Emby ä½¿ç”¨</h2>
                        <div class="doc-body">
                            <h3>å®¢æˆ·ç«¯ä¸‹è½½</h3>
                            <p>Emby æ”¯æŒå¤šå¹³å°å®¢æˆ·ç«¯ï¼š</p>
                            <ul>
                                <li><strong>Windows/Mac</strong>ï¼šå®˜ç½‘ä¸‹è½½æ¡Œé¢å®¢æˆ·ç«¯</li>
                                <li><strong>iOS</strong>ï¼šApp Store æœç´¢ "Emby"</li>
                                <li><strong>Android</strong>ï¼šGoogle Play æˆ–å®˜ç½‘ä¸‹è½½ APK</li>
                                <li><strong>TV</strong>ï¼šå„å¤§ç”µè§†åº”ç”¨å•†åº—æœç´¢</li>
                                <li><strong>Web</strong>ï¼šç›´æ¥æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨åœ°å€</li>
                            </ul>
                            <h3>è¿æ¥æœåŠ¡å™¨</h3>
                            <ol>
                                <li>æ‰“å¼€ Emby å®¢æˆ·ç«¯</li>
                                <li>è¾“å…¥æœåŠ¡å™¨åœ°å€ï¼ˆè”ç³»ç®¡ç†å‘˜è·å–ï¼‰</li>
                                <li>ä½¿ç”¨æ‚¨çš„è´¦å·å¯†ç ç™»å½•</li>
                                <li>å¼€å§‹äº«å—è§‚å½±ä½“éªŒ</li>
                            </ol>
                        </div>
                    </article>
                    
                    <article class="doc-section" id="doc-mobile">
                        <h2>ğŸ“± ç§»åŠ¨ç«¯ä½¿ç”¨</h2>
                        <div class="doc-body">
                            <p>æœ¬ç®¡ç†ç³»ç»Ÿå·²é’ˆå¯¹ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼Œæ”¯æŒ PWA å®‰è£…ï¼š</p>
                            <h3>æ·»åŠ åˆ°ä¸»å±å¹•</h3>
                            <ul>
                                <li><strong>iOS Safari</strong>ï¼šç‚¹å‡»åˆ†äº«æŒ‰é’® â†’ æ·»åŠ åˆ°ä¸»å±å¹•</li>
                                <li><strong>Android Chrome</strong>ï¼šèœå• â†’ æ·»åŠ åˆ°ä¸»å±å¹•</li>
                            </ul>
                            <div class="doc-tip">
                                <span class="tip-icon">ğŸ’¡</span>
                                <span class="tip-text">æ·»åŠ åˆ°ä¸»å±å¹•åï¼Œå¯è·å¾—ç±»ä¼¼åŸç”Ÿåº”ç”¨çš„ä½“éªŒã€‚</span>
                            </div>
                        </div>
                    </article>
                    
                    <article class="doc-section" id="doc-account">
                        <h2>ğŸ‘¤ è´¦æˆ·ç®¡ç†</h2>
                        <div class="doc-body">
                            <h3>ä¼šå‘˜ç­‰çº§</h3>
                            <ul>
                                <li><strong>ç™½åå•ç”¨æˆ· (Açº§)</strong>ï¼šæ¯æ—¥ 3 æ¬¡æ±‚ç‰‡ï¼Œæ— æ—¶é—´é™åˆ¶</li>
                                <li><strong>æ³¨å†Œç”¨æˆ· (Bçº§)</strong>ï¼šæ¯æ—¥ 1 æ¬¡æ±‚ç‰‡ï¼Œéœ€æœ‰æ•ˆè®¢é˜…</li>
                            </ul>
                            <h3>è®¢é˜…ç»­è´¹</h3>
                            <p>è¯·å‰å¾€"è´­ä¹°å¥—é¤"é¡µé¢é€‰æ‹©é€‚åˆæ‚¨çš„å¥—é¤è¿›è¡Œç»­è´¹ï¼Œæ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ã€‚</p>
                        </div>
                    </article>
                </div>
            </div>
        </section>
        
        <!-- å¸¸è§é—®é¢˜é¡µé¢ -->
        <section class="content-section" id="section-faq">
            <div class="section-header">
                <h1>â“ å¸¸è§é—®é¢˜</h1>
                <p>è§£ç­”æ‚¨å¯èƒ½é‡åˆ°çš„é—®é¢˜</p>
            </div>
            
            <div class="faq-container">
                <div class="faq-search">
                    <input type="text" id="faqSearch" placeholder="æœç´¢é—®é¢˜..." oninput="filterFAQ()" autocomplete="off">
                    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3Z"/></svg>
                </div>
                
                <div class="faq-categories" id="faqCategories">
                    <button class="category-btn active" data-category="all" onclick="filterFAQCategory('all')">å…¨éƒ¨</button>
                    <!-- åˆ†ç±»æŒ‰é’®åŠ¨æ€åŠ è½½ -->
                </div>
                
                <div class="faq-list" id="faqList">
                    <div class="loading-state">
                        <p>åŠ è½½ä¸­...</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- æŠ€æœ¯æ”¯æŒé¡µé¢ -->
        <section class="content-section" id="section-support">
            <div class="section-header">
                <h1>ğŸ› ï¸ æŠ€æœ¯æ”¯æŒ</h1>
                <p>é‡åˆ°é—®é¢˜ï¼Ÿæˆ‘ä»¬æ¥å¸®æ‚¨è§£å†³</p>
            </div>
            
            <div class="support-container">
                <!-- è”ç³»æ–¹å¼ -->
                <div class="contact-cards">
                    <div class="contact-card">
                        <div class="contact-icon telegram">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M9.78 18.65L10.06 14.42L17.74 7.5C18.08 7.19 17.67 7.04 17.22 7.31L7.74 13.3L3.64 12C2.76 11.75 2.75 11.14 3.84 10.7L19.81 4.54C20.54 4.21 21.24 4.72 20.96 5.84L18.24 18.65C18.05 19.56 17.5 19.78 16.74 19.36L12.6 16.3L10.61 18.23C10.38 18.46 10.19 18.65 9.78 18.65Z"/></svg>
                        </div>
                        <div class="contact-info">
                            <div class="contact-title">Telegram ç¾¤ç»„</div>
                            <div class="contact-desc">åŠ å…¥ç¾¤ç»„è·å–æœ€æ–°åŠ¨æ€</div>
                            <a href="https://t.me/{{ site_config.telegram_group or bot_username }}" target="_blank" class="contact-link">ç«‹å³åŠ å…¥ â†’</a>
                        </div>
                    </div>
                    
                    <div class="contact-card">
                        <div class="contact-icon email">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"/></svg>
                        </div>
                        <div class="contact-info">
                            <div class="contact-title">é‚®ä»¶æ”¯æŒ</div>
                            <div class="contact-desc">å‘é€é‚®ä»¶è·å–å¸®åŠ©</div>
                            <a href="mailto:{{ site_config.support_email or 'support@example.com' }}" class="contact-link">å‘é€é‚®ä»¶ â†’</a>
                        </div>
                    </div>
                </div>
                
                <!-- æäº¤å·¥å• -->
                <div class="ticket-form-section">
                    <h3>ğŸ“ æäº¤å·¥å•</h3>
                    <form class="ticket-form" id="ticketForm" onsubmit="submitTicket(event)">
                        <div class="form-group">
                            <label>é—®é¢˜ç±»å‹ <span class="required">*</span></label>
                            <select id="ticketCategory" required>
                                <option value="">è¯·é€‰æ‹©é—®é¢˜ç±»å‹</option>
                                <option value="account">è´¦æˆ·é—®é¢˜</option>
                                <option value="payment">æ”¯ä»˜é—®é¢˜</option>
                                <option value="technical">æŠ€æœ¯é—®é¢˜</option>
                                <option value="content">å†…å®¹åé¦ˆ</option>
                                <option value="other">å…¶ä»–é—®é¢˜</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>é—®é¢˜æ ‡é¢˜ <span class="required">*</span></label>
                            <input type="text" id="ticketSubject" placeholder="ç®€è¦æè¿°æ‚¨çš„é—®é¢˜" required maxlength="100">
                        </div>
                        <div class="form-group">
                            <label>è¯¦ç»†æè¿° <span class="required">*</span></label>
                            <textarea id="ticketDescription" placeholder="è¯·è¯¦ç»†æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜ï¼ŒåŒ…æ‹¬æ“ä½œæ­¥éª¤ã€é”™è¯¯ä¿¡æ¯ç­‰" required maxlength="1000" rows="5"></textarea>
                        </div>
                        <div class="form-group">
                            <label>ä¼˜å…ˆçº§</label>
                            <div class="priority-options">
                                <label class="priority-option">
                                    <input type="radio" name="priority" value="low">
                                    <span class="priority-label low">ä½</span>
                                </label>
                                <label class="priority-option">
                                    <input type="radio" name="priority" value="normal" checked>
                                    <span class="priority-label normal">æ™®é€š</span>
                                </label>
                                <label class="priority-option">
                                    <input type="radio" name="priority" value="high">
                                    <span class="priority-label high">é«˜</span>
                                </label>
                                <label class="priority-option">
                                    <input type="radio" name="priority" value="urgent">
                                    <span class="priority-label urgent">ç´§æ€¥</span>
                                </label>
                            </div>
                        </div>
                        <button type="submit" class="submit-ticket-btn">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/></svg>
                            æäº¤å·¥å•
                        </button>
                    </form>
                </div>
                
                <!-- æˆ‘çš„å·¥å• -->
                <div class="my-tickets-section">
                    <h3>ğŸ“‹ æˆ‘çš„å·¥å•</h3>
                    <div class="tickets-list" id="myTickets">
                        <div class="empty-state small">
                            <div class="empty-icon">ğŸ“­</div>
                            <div class="empty-title">æš‚æ— å·¥å•</div>
                            <div class="empty-desc">æäº¤å·¥å•åå¯åœ¨æ­¤æŸ¥çœ‹å¤„ç†è¿›åº¦</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- ç¡®è®¤å¯¹è¯æ¡† -->
    <div class="confirm-overlay" id="confirmOverlay" onclick="closeConfirmDialog()">
        <div class="confirm-dialog tv-request-dialog" onclick="event.stopPropagation()">
            <div class="icon">&#x1F3AC;</div>
            <h3>ç¡®è®¤æ±‚ç‰‡</h3>
            <div class="movie-info">
                <div class="movie-title" id="confirmMovieTitle"></div>
                <div class="movie-type" id="confirmMovieType"></div>
            </div>
            
            <!-- Embyåº“çŠ¶æ€ä¿¡æ¯ -->
            <div id="embyStatusInfo" style="display: none; margin-bottom: 15px;"></div>
            
            <!-- å‰§é›†å­£/é›†é€‰æ‹© -->
            <div id="embyStatusInfo" style="display: none; margin-bottom: 15px;"></div>
            
            <!-- ç”µè§†å‰§å­£/é›†é€‰æ‹©åŒºåŸŸ -->
            <div class="tv-scope-selector" id="tvScopeSelector" style="display: none;">
                <div class="scope-title">ğŸ“‘ é€‰æ‹©æ±‚ç‰‡èŒƒå›´</div>
                <div class="scope-options">
                    <label class="scope-option">
                        <input type="radio" name="requestType" value="all" checked onclick="selectRequestType('all')">
                        <span class="option-label">ğŸ¬ å…¨å‰§ï¼ˆæ‰€æœ‰å­£ï¼‰</span>
                    </label>
                    <label class="scope-option">
                        <input type="radio" name="requestType" value="season" onclick="selectRequestType('season')">
                        <span class="option-label">ğŸ“‚ æŒ‡å®šå­£</span>
                    </label>
                    <label class="scope-option">
                        <input type="radio" name="requestType" value="episode" onclick="selectRequestType('episode')">
                        <span class="option-label">ğŸ“„ æŒ‡å®šé›†</span>
                    </label>
                </div>
                
                <!-- å­£é€‰æ‹© -->
                <div class="season-selector" id="seasonSelector" style="display: none;">
                    <label>é€‰æ‹©å­£ï¼š</label>
                    <select id="seasonSelect" onchange="loadEpisodes()">
                        <option value="">-- è¯·é€‰æ‹© --</option>
                    </select>
                    <div class="season-loading" id="seasonLoading" style="display: none;">
                        <span class="mini-spinner"></span> åŠ è½½ä¸­...
                    </div>
                </div>
                
                <!-- é›†é€‰æ‹© -->
                <div class="episode-selector" id="episodeSelector" style="display: none;">
                    <label>é€‰æ‹©é›†ï¼š</label>
                    <select id="episodeSelect">
                        <option value="">-- è¯·é€‰æ‹© --</option>
                    </select>
                    <div class="episode-loading" id="episodeLoading" style="display: none;">
                        <span class="mini-spinner"></span> åŠ è½½ä¸­...
                    </div>
                </div>
                
                <!-- ç”¨æˆ·å¤‡æ³¨ -->
                <div class="user-note-input">
                    <label>ğŸ’¬ å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰ï¼š</label>
                    <input type="text" id="userNoteInput" placeholder="å¦‚ï¼šæ±‚ 4K HDR ç‰ˆæœ¬" maxlength="100">
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn-cancel" onclick="closeConfirmDialog()">å–æ¶ˆ</button>
                <button class="btn-confirm" id="confirmBtn" onclick="confirmRequest()">ç¡®å®šæ±‚ç‰‡</button>
            </div>
        </div>
    </div>

    <!-- ç»“æœæç¤ºå¯¹è¯æ¡† -->
    <div class="confirm-overlay" id="resultOverlay" onclick="closeResultDialog()">
        <div class="confirm-dialog" onclick="event.stopPropagation()">
            <div class="icon" id="resultIcon">&#x2705;</div>
            <h3 id="resultTitle">æ±‚ç‰‡æˆåŠŸ</h3>
            <div class="movie-info">
                <div id="resultMessage" style="font-size: 16px; color: #333; line-height: 1.6;"></div>
            </div>
            <div class="buttons">
                <button class="btn-confirm" onclick="closeResultDialog()" style="width: 100%;">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- åŠ è½½åŠ¨ç”» -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨æäº¤æ±‚ç‰‡è¯·æ±‚...</p>
        </div>
    </div>

    <!-- å…¬å‘Šå¼¹çª— -->
    {% if announcement_enabled %}
    <div class="announcement-overlay" id="announcementOverlay" onclick="closeAnnouncement()">
        <div class="announcement-dialog" onclick="event.stopPropagation()">
            <div class="icon">ğŸ“¢</div>
            <h3>ç³»ç»Ÿå…¬å‘Š</h3>
            <div class="content">
                {{ announcement_content | safe | replace('\n', '<br>') }}
            </div>
            <div class="buttons">
                <button onclick="closeAnnouncement()">æˆ‘çŸ¥é“äº†</button>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Telegram ç»‘å®šå¼¹çª— -->
    <div class="telegram-bind-overlay" id="telegramBindOverlay" style="display: none;" onclick="closeTelegramBindDialog()">
        <div class="telegram-bind-dialog" onclick="event.stopPropagation()">
            <div class="dialog-header">
                <h3>ğŸ“± ç»‘å®š Telegram</h3>
                <button class="close-btn" onclick="closeTelegramBindDialog()">âœ•</button>
            </div>
            <div class="dialog-content">
                <div class="bind-intro">
                    <p>ç»‘å®šåæ‚¨å¯ä»¥äº«å—ï¼š</p>
                    <ul>
                        <li><span class="icon">ğŸ””</span> æ±‚ç‰‡è¿›åº¦å®æ—¶æ¨é€</li>
                        <li><span class="icon">â°</span> è®¢é˜…åˆ°æœŸåŠæ—¶æé†’</li>
                        <li><span class="icon">ğŸ¤–</span> Bot å¿«æ·æŸ¥è¯¢æœåŠ¡</li>
                    </ul>
                </div>
                <!-- æ¨ªå‘å¸ƒå±€çš„æ­¥éª¤ -->
                <div class="bind-steps-horizontal">
                    <div class="step-item">
                        <div class="step-badge">STEP 1</div>
                        <div class="step-content">
                            <label>æ‰“å¼€ Telegram Bot</label>
                            <a href="#" id="telegramBotLink" target="_blank" class="bot-link">
                                <span class="bot-icon">ğŸ¤–</span>
                                <span class="bot-name">@åŠ è½½ä¸­...</span>
                                <span class="arrow">â†’</span>
                            </a>
                        </div>
                    </div>
                    <div class="step-divider-horizontal">â†’</div>
                    <div class="step-item">
                        <div class="step-badge">STEP 2</div>
                        <div class="step-content">
                            <label>å‘é€ç»‘å®šæŒ‡ä»¤</label>
                            <div class="bind-code-container">
                                <code id="telegramBindInstruction">/bind åŠ è½½ä¸­...</code>
                                <button class="copy-btn" type="button" onclick="copyBindCommand(event)" title="å¤åˆ¶æŒ‡ä»¤">
                                    <span>ğŸ“‹</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bind-code-display">
                    <div class="code-header">
                        <span class="code-label">æ‚¨çš„ç»‘å®šç </span>
                        <span class="code-expire" id="telegramBindExpire"></span>
                    </div>
                    <div class="code-main">
                        <span class="code-value" id="telegramBindCode">åŠ è½½ä¸­...</span>
                        <button class="refresh-btn" id="refreshBindCodeBtn" onclick="regenerateBindCode()" title="é‡æ–°ç”Ÿæˆ">
                            <span>ğŸ”„</span>
                        </button>
                    </div>
                </div>
                <div class="bind-status-hint" id="telegramBindStatusHint">
                    <span class="hint-icon">â³</span>
                    <span class="hint-text">ç­‰å¾…ç»‘å®šä¸­... å‘é€æŒ‡ä»¤åæ­¤å¯¹è¯æ¡†å°†è‡ªåŠ¨å…³é—­</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Emby è´¦å·å¼•å¯¼å¼¹çª—ï¼ˆæœªç»‘å®šæ—¶è‡ªåŠ¨å¼¹å‡ºï¼‰ -->
    <div class="emby-bind-overlay" id="embyGuideOverlay" style="display: none;">
        <div class="emby-bind-dialog emby-guide-dialog">
            <button class="close-btn" onclick="closeEmbyGuideDialog()" style="color:#999">&times;</button>
            <div class="guide-header">
                <div class="guide-icon">ğŸ“º</div>
                <h2>æ¬¢è¿ä½¿ç”¨ Emby å½±è§†æœåŠ¡</h2>
                <p>æ£€æµ‹åˆ°æ‚¨è¿˜æ²¡æœ‰ç»‘å®š Emby è´¦å·ï¼Œè¯·å…ˆå®Œæˆè´¦å·è®¾ç½®ä»¥å¼€å§‹ä½¿ç”¨</p>
            </div>
            <div class="guide-options">
                <div class="guide-option" onclick="guideToEmbyBind()">
                    <div class="guide-option-icon">ğŸ”—</div>
                    <div class="guide-option-info">
                        <h3>ç»‘å®šå·²æœ‰è´¦å·</h3>
                        <p>æˆ‘å·²ç»æœ‰ Emby è´¦å·ï¼Œç›´æ¥ç»‘å®šä½¿ç”¨</p>
                    </div>
                    <div class="guide-option-arrow">â€º</div>
                </div>
                <div class="guide-option" id="guideCreateBtn" onclick="guideToEmbyCreate()">
                    <div class="guide-option-icon">âœ¨</div>
                    <div class="guide-option-info">
                        <h3>åˆ›å»ºæ–°è´¦å·</h3>
                        <p>æˆ‘è¿˜æ²¡æœ‰è´¦å·ï¼Œå¸®æˆ‘åˆ›å»ºä¸€ä¸ªæ–°çš„</p>
                    </div>
                    <div class="guide-option-arrow">â€º</div>
                </div>
                <div class="guide-create-hint" id="guideCreateHint" style="display: none;">
                    ğŸ’¡ åˆ›å»ºæ–°è´¦å·éœ€è¦æœ‰æ•ˆè®¢é˜…ï¼Œæ‚¨å¯ä»¥å…ˆç»‘å®šå·²æœ‰è´¦å·æˆ–è´­ä¹°è®¢é˜…åå†åˆ›å»º
                </div>
            </div>
        </div>
    </div>
    <style>
        .emby-guide-dialog {
            max-width: 480px;
            padding: 36px 30px 28px;
            background: #faf9f7 !important;
            border: 1px solid #e8e5e0 !important;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15) !important;
        }
        .guide-header {
            text-align: center;
            margin-bottom: 28px;
        }
        .guide-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        .guide-header h2 {
            color: #1a1a1a;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        .guide-header p {
            color: #888;
            font-size: 14px;
            line-height: 1.6;
        }
        .guide-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .guide-option {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 18px 16px;
            background: #fff;
            border: 1px solid #e8e5e0;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.25s;
        }
        .guide-option:hover {
            background: #f0edff;
            border-color: #667eea;
            transform: translateX(4px);
        }
        .guide-option:active {
            transform: translateX(2px);
        }
        .guide-option-icon {
            font-size: 28px;
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f3ff;
            border-radius: 12px;
        }
        .guide-option-info {
            flex: 1;
        }
        .guide-option-info h3 {
            color: #1a1a1a;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .guide-option-info p {
            color: #999;
            font-size: 12px;
            margin: 0;
        }
        .guide-option-arrow {
            color: #ccc;
            font-size: 22px;
            font-weight: 300;
            flex-shrink: 0;
        }
        .guide-option.guide-btn-disabled {
            opacity: 0.45;
            cursor: not-allowed;
        }
        .guide-option.guide-btn-disabled:hover {
            background: #fff;
            border-color: #e8e5e0;
            transform: none;
        }
        .guide-create-hint {
            text-align: center;
            color: #d97706;
            font-size: 12px;
            padding: 10px 14px;
            background: #fef8ee;
            border: 1px solid #fde6b4;
            border-radius: 8px;
            line-height: 1.5;
        }
    </style>

    <!-- Emby è´¦å·ç»‘å®šå¼¹çª—ï¼ˆä»…ç»‘å®šå·²æœ‰è´¦å·ï¼‰ -->
    <div class="emby-bind-overlay" id="embyBindOverlay" style="display: none;">
        <div class="emby-bind-dialog">
            <button class="close-btn" onclick="closeEmbyBindDialog()">&times;</button>
            <div class="dialog-header">
                <h2>ğŸ”— ç»‘å®š Emby è´¦å·</h2>
                <p>ç»‘å®šæ‚¨å·²æœ‰çš„ Emby è´¦å·</p>
            </div>
            
            <!-- ç»‘å®šç°æœ‰è´¦å·è¡¨å• -->
            <div class="emby-tab-content" id="bindTab">
                <p class="tab-desc">å¦‚æœæ‚¨å·²æœ‰ Emby è´¦å·ï¼Œè¯·è¾“å…¥è´¦å·å¯†ç è¿›è¡Œç»‘å®šéªŒè¯</p>
                <form id="embyBindForm" onsubmit="submitEmbyBind(event)">
                    <div class="form-group">
                        <label>Emby ç”¨æˆ·å</label>
                        <input type="text" id="bindUsername" placeholder="è¯·è¾“å…¥æ‚¨çš„ Emby ç”¨æˆ·å" required>
                    </div>
                    <div class="form-group">
                        <label>Emby å¯†ç </label>
                        <input type="password" id="bindPassword" placeholder="è¯·è¾“å…¥æ‚¨çš„ Emby å¯†ç " required>
                    </div>
                    <div class="form-error" id="bindError"></div>
                    <button type="submit" class="submit-btn" id="bindSubmitBtn">éªŒè¯å¹¶ç»‘å®š</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Emby è´¦å·åˆ›å»ºå¼¹çª—ï¼ˆä»…åˆ›å»ºæ–°è´¦å·ï¼‰ -->
    <div class="emby-bind-overlay" id="embyCreateOverlay" style="display: none;">
        <div class="emby-bind-dialog">
            <button class="close-btn" onclick="closeEmbyCreateDialog()">&times;</button>
            <div class="dialog-header">
                <h2>â• åˆ›å»º Emby è´¦å·</h2>
                <p>åˆ›å»ºä¸€ä¸ªæ–°çš„ Emby è´¦å·</p>
            </div>
            
            <!-- åˆ›å»ºæ–°è´¦å·è¡¨å• -->
            <div class="emby-tab-content" id="createTab">
                <p class="tab-desc">åˆ›å»ºä¸€ä¸ªæ–°çš„ Emby è´¦å·ï¼Œç”¨äºè§‚çœ‹å½±è§†å†…å®¹</p>
                <form id="embyCreateForm" onsubmit="submitEmbyCreate(event)">
                    <div class="form-group">
                        <label>ç”¨æˆ·å <span class="hint">(3-20ä¸ªå­—ç¬¦ï¼Œä»…å­—æ¯æ•°å­—ä¸‹åˆ’çº¿)</span></label>
                        <input type="text" id="createUsername" placeholder="è®¾ç½®æ‚¨çš„ç”¨æˆ·å" required 
                               pattern="[a-zA-Z0-9_]{3,20}" oninput="checkEmbyUsername()">
                        <div class="username-status" id="usernameStatus"></div>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç  <span class="hint">(è‡³å°‘6ä¸ªå­—ç¬¦)</span></label>
                        <input type="password" id="createPassword" placeholder="è®¾ç½®æ‚¨çš„å¯†ç " required minlength="6">
                    </div>
                    <div class="form-group">
                        <label>ç¡®è®¤å¯†ç </label>
                        <input type="password" id="createPasswordConfirm" placeholder="å†æ¬¡è¾“å…¥å¯†ç " required>
                    </div>
                    <div class="form-error" id="createError"></div>
                    <button type="submit" class="submit-btn" id="createSubmitBtn">åˆ›å»ºè´¦å·</button>
                </form>
            </div>
        </div>
    </div>

    <style>
        /* Emby è´¦å·ç»‘å®šå¼¹çª—æ ·å¼ */
        .emby-bind-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }
        
        .emby-bind-dialog {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 450px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .emby-bind-dialog .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .emby-bind-dialog .close-btn:hover {
            color: #fff;
        }
        
        .emby-bind-dialog .dialog-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .emby-bind-dialog .dialog-header h2 {
            color: #fff;
            font-size: 22px;
            margin-bottom: 8px;
        }
        
        .emby-bind-dialog .dialog-header p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }
        
        .emby-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .emby-tabs .tab-btn {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .emby-tabs .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .emby-tabs .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
            color: #fff;
        }
        
        .emby-tab-content {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .emby-tab-content .tab-desc {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .emby-bind-dialog .form-group {
            margin-bottom: 18px;
        }
        
        .emby-bind-dialog .form-group label {
            display: block;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .emby-bind-dialog .form-group label .hint {
            color: rgba(255, 255, 255, 0.4);
            font-size: 12px;
        }
        
        .emby-bind-dialog .form-group input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            color: #fff;
            font-size: 15px;
            transition: all 0.3s;
            outline: none;
        }
        
        .emby-bind-dialog .form-group input:focus {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .emby-bind-dialog .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        .username-status {
            margin-top: 8px;
            font-size: 13px;
            min-height: 20px;
        }
        
        .username-status.available {
            color: #4ade80;
        }
        
        .username-status.unavailable {
            color: #f87171;
        }
        
        .username-status.checking {
            color: #facc15;
        }
        
        .form-error {
            color: #f87171;
            font-size: 13px;
            margin-bottom: 15px;
            min-height: 20px;
        }
        
        .emby-bind-dialog .submit-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .emby-bind-dialog .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .emby-bind-dialog .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Emby è´¦å·ç®¡ç†åŒºåŸŸæ ·å¼ */
        .emby-account-section {
            margin-bottom: 30px;
        }
        
        .emby-account-section h3 {
            font-size: 18px;
            color: #fff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .emby-account-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
        }
        
        .emby-bound-info,
        .emby-unbound-info {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .emby-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            width: fit-content;
        }
        
        .emby-status-badge.bound {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
            border: 1px solid rgba(74, 222, 128, 0.3);
        }
        
        .emby-status-badge.unbound {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }
        
        .emby-status-badge .status-icon {
            font-weight: bold;
        }
        
        .emby-account-details {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .emby-account-details .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .emby-account-details .detail-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }
        
        .emby-account-details .detail-value {
            color: #fff;
            font-weight: 500;
            font-size: 14px;
        }
        
        .emby-account-details .detail-value.emby-id {
            font-family: monospace;
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .emby-hint {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .emby-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .btn-emby-bind,
        .btn-emby-create,
        .btn-emby-unbind {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-emby-bind {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }
        
        .btn-emby-bind:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-emby-create {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-emby-create:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .btn-emby-unbind {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .btn-emby-unbind:hover {
            background: rgba(239, 68, 68, 0.25);
            transform: translateY(-2px);
        }
        
        /* Telegram ç»‘å®šçŠ¶æ€æ ·å¼ */
        .telegram-bind-status {
            margin-top: 10px;
        }
        
        .status-badge-mini.telegram {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, rgba(0, 136, 204, 0.15) 0%, rgba(0, 136, 204, 0.05) 100%);
            border: 1px solid rgba(0, 136, 204, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
        }
        
        .status-badge-mini.telegram.bound {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(34, 197, 94, 0.05) 100%);
            border-color: rgba(34, 197, 94, 0.3);
        }
        
        .bind-action-btn {
            margin-left: auto;
            padding: 6px 16px;
            border-radius: 6px;
            border: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            background: linear-gradient(135deg, #0088cc 0%, #0066aa 100%);
            color: white;
        }
        
        .bind-action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 136, 204, 0.3);
        }
        
        .bind-action-btn.unbind {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .bind-action-btn.unbind:hover {
            background: rgba(239, 68, 68, 0.25);
        }
        
        /* Telegram ç»‘å®šå¼¹çª—æ ·å¼ */
        .telegram-bind-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.2s ease;
        }
        
        .telegram-bind-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }
        
        .telegram-bind-dialog {
            background: #ffffff;
            border-radius: 24px;
            width: 95%;
            max-width: 1200px;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.15), 0 10px 30px rgba(0, 136, 204, 0.1);
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
        }
        
        .telegram-bind-dialog::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: linear-gradient(180deg, rgba(0, 136, 204, 0.05) 0%, transparent 100%);
            pointer-events: none;
        }
        
        .telegram-bind-dialog .dialog-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 28px 28px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            background: transparent;
            position: relative;
            z-index: 1;
        }
        
        .telegram-bind-dialog .dialog-header h3 {
            margin: 0;
            font-size: 22px;
            font-weight: 600;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .telegram-bind-dialog .close-btn {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: rgba(0, 0, 0, 0.5);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .telegram-bind-dialog .close-btn:hover {
            background: rgba(0, 0, 0, 0.1);
            color: #000;
            transform: rotate(90deg);
        }
        
        .telegram-bind-dialog .dialog-content {
            padding: 28px;
            position: relative;
            z-index: 1;
        }
        
        .telegram-bind-dialog .bind-intro {
            background: linear-gradient(135deg, rgba(0, 136, 204, 0.08) 0%, rgba(0, 102, 170, 0.05) 100%);
            border: 1px solid rgba(0, 136, 204, 0.15);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }
        
        .telegram-bind-dialog .bind-intro p {
            margin: 0 0 12px 0;
            color: #374151;
            font-size: 14px;
            font-weight: 500;
        }
        
        .telegram-bind-dialog .bind-intro ul {
            margin: 0;
            padding: 0;
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .telegram-bind-dialog .bind-intro li {
            color: #6b7280;
            font-size: 13px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .telegram-bind-dialog .bind-intro li .icon {
            font-size: 16px;
        }
        
        /* æ¨ªå‘å¸ƒå±€çš„æ­¥éª¤ */
        .telegram-bind-dialog .bind-steps-horizontal {
            display: flex;
            flex-direction: row;
            align-items: stretch;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .telegram-bind-dialog .step-item {
            flex: 1;
            background: rgba(0, 0, 0, 0.02);
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 14px;
            padding: 18px 20px;
        }
        
        .telegram-bind-dialog .step-divider-horizontal {
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(0, 136, 204, 0.5);
            font-size: 24px;
            font-weight: bold;
            padding: 0 8px;
        }
        
        .telegram-bind-dialog .step-badge {
            display: inline-block;
            background: linear-gradient(135deg, rgba(0, 136, 204, 0.2) 0%, rgba(0, 102, 170, 0.2) 100%);
            border: 1px solid rgba(0, 136, 204, 0.3);
            color: #0088cc;
            font-size: 11px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 6px;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }
        
        .telegram-bind-dialog .step-content label {
            display: block;
            color: #4b5563;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .telegram-bind-dialog .bot-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: rgba(0, 136, 204, 0.06);
            border: 1px solid rgba(0, 136, 204, 0.15);
            border-radius: 10px;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .telegram-bind-dialog .bot-link:hover {
            background: rgba(0, 136, 204, 0.15);
            border-color: rgba(0, 136, 204, 0.4);
            transform: translateX(4px);
        }
        
        .telegram-bind-dialog .bot-link .bot-icon {
            font-size: 24px;
        }
        
        .telegram-bind-dialog .bot-link .bot-name {
            flex: 1;
            color: #0088cc;
            font-size: 15px;
            font-weight: 500;
        }
        
        .telegram-bind-dialog .bot-link .arrow {
            color: rgba(0, 136, 204, 0.5);
            font-size: 18px;
            transition: transform 0.3s;
        }
        
        .telegram-bind-dialog .bot-link:hover .arrow {
            transform: translateX(4px);
        }
        
        .telegram-bind-dialog .bind-code-container {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 16px;
            background: rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        
        .telegram-bind-dialog .bind-code-container code {
            flex: 1;
            color: #0088cc;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 15px;
            font-weight: 500;
        }
        
        .telegram-bind-dialog .copy-btn {
            background: rgba(0, 136, 204, 0.1);
            border: 1px solid rgba(0, 136, 204, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }
        
        .telegram-bind-dialog .copy-btn:hover {
            background: rgba(0, 136, 204, 0.25);
            transform: scale(1.05);
        }
        
        .telegram-bind-dialog .bind-code-display {
            background: linear-gradient(135deg, rgba(0, 136, 204, 0.06) 0%, rgba(0, 102, 170, 0.04) 100%);
            border: 1px solid rgba(0, 136, 204, 0.15);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .telegram-bind-dialog .code-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .telegram-bind-dialog .code-label {
            color: #6b7280;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .telegram-bind-dialog .code-expire {
            color: #f59e0b;
            font-size: 12px;
            font-weight: 500;
        }
        
        .telegram-bind-dialog .code-main {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .telegram-bind-dialog .code-value {
            flex: 1;
            color: #1f2937;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 32px;
            font-weight: 700;
            letter-spacing: 4px;
            text-shadow: none;
        }
        
        .telegram-bind-dialog .refresh-btn {
            background: rgba(0, 136, 204, 0.1);
            border: 1px solid rgba(0, 136, 204, 0.2);
            border-radius: 10px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 20px;
        }
        
        .telegram-bind-dialog .refresh-btn:hover:not(:disabled) {
            background: rgba(0, 136, 204, 0.25);
            transform: rotate(180deg);
        }
        
        .telegram-bind-dialog .refresh-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .telegram-bind-dialog .bind-status-hint {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 18px;
            background: rgba(251, 191, 36, 0.06);
            border: 1px solid rgba(251, 191, 36, 0.15);
            border-radius: 10px;
        }
        
        .telegram-bind-dialog .hint-icon {
            font-size: 18px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .telegram-bind-dialog .hint-text {
            flex: 1;
            color: #d97706;
            font-size: 13px;
            font-weight: 500;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* è§£ç»‘ç¡®è®¤å¼¹çª— */
        .unbind-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            padding: 20px;
        }
        
        .unbind-dialog {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .unbind-dialog .warning-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .unbind-dialog h3 {
            color: #fff;
            font-size: 20px;
            margin-bottom: 12px;
        }
        
        .unbind-dialog p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .unbind-dialog .warning-text {
            background: rgba(251, 191, 36, 0.15);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 20px;
            color: #fbbf24;
            font-size: 13px;
        }
        
        .unbind-dialog .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .unbind-dialog .form-group label {
            display: block;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .unbind-dialog .form-group input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            color: #fff;
            font-size: 15px;
            outline: none;
        }
        
        .unbind-dialog .form-group input:focus {
            border-color: #f87171;
            background: rgba(248, 113, 113, 0.1);
        }
        
        .unbind-dialog .form-error {
            color: #f87171;
            font-size: 13px;
            margin-bottom: 15px;
            min-height: 20px;
        }
        
        .unbind-dialog .dialog-btns {
            display: flex;
            gap: 12px;
        }
        
        .unbind-dialog .btn-cancel {
            flex: 1;
            padding: 14px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .unbind-dialog .btn-cancel:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .unbind-dialog .btn-confirm-unbind {
            flex: 1;
            padding: 14px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .unbind-dialog .btn-confirm-unbind:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        
        .unbind-dialog .btn-confirm-unbind:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
    </style>
    
    <!-- è§£ç»‘ Emby è´¦å·ç¡®è®¤å¼¹çª— -->
    <div class="unbind-overlay" id="unbindEmbyOverlay" style="display: none;">
        <div class="unbind-dialog">
            <div class="warning-icon">âš ï¸</div>
            <h3>è§£ç»‘ Emby è´¦å·</h3>
            <p>è§£ç»‘åï¼Œæ‚¨å°†æ— æ³•ä½¿ç”¨åª’ä½“åº“æœåŠ¡ï¼Œä½† Emby è´¦å·æœ¬èº«ä¸ä¼šè¢«åˆ é™¤</p>
            <div class="warning-text">
                âš ï¸ è§£ç»‘åæ‚¨éœ€è¦é‡æ–°ç»‘å®šæˆ–åˆ›å»ºè´¦å·æ‰èƒ½ç»§ç»­ä½¿ç”¨
            </div>
            <form id="unbindEmbyForm" onsubmit="submitEmbyUnbind(event)">
                <div class="form-group">
                    <label>è¯·è¾“å…¥å½“å‰å¯†ç ç¡®è®¤è§£ç»‘</label>
                    <input type="password" id="unbindPassword" placeholder="è¯·è¾“å…¥æ‚¨çš„å¯†ç " required>
                </div>
                <div class="form-error" id="unbindError"></div>
                <div class="dialog-btns">
                    <button type="button" class="btn-cancel" onclick="closeUnbindEmbyDialog()">å–æ¶ˆ</button>
                    <button type="submit" class="btn-confirm-unbind" id="unbindSubmitBtn">ç¡®è®¤è§£ç»‘</button>
                </div>
            </form>
        </div>
    </div>

    <script id="dashboard-data" type="application/json">
        {
            "siteName": {{ (site_config.site_name or 'Emby') | tojson }},
            "tmdbImageBase": {{ tmdb_image_base | tojson }},
            "requestedKeys": [
                {% if requests %}
                {% for req in requests %}
                {{ (req.tmdb_id ~ '_' ~ req.media_type) | tojson }}{% if not loop.last %},{% endif %}
                {% endfor %}
                {% endif %}
            ]
        }
    </script>
    <script src="{{ url_for('static', filename='js/common.js') }}?v=22"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}?v=42"></script>
    <script src="{{ url_for('static', filename='js/checkin.js') }}?v=4"></script>
    {% if site_config.custom_js %}
    <script>{{ site_config.custom_js | safe }}</script>
    {% endif %}
    {% if not user.embyid %}
    <script>
        // ç”¨æˆ·æœªç»‘å®š Embyï¼Œé¡µé¢åŠ è½½åå¼¹å‡ºå¼•å¯¼
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkEmbyBindStatus, 800);
        });
    </script>
    {% endif %}
</body>
</html>