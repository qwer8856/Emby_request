<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†é¢æ¿ - {{ site_config.site_title or 'Embyç®¡ç†ç³»ç»Ÿ' }}</title>
    {% if site_config and site_config.site_logo %}
    <link rel="icon" href="{{ site_config.site_logo }}" type="image/png">
    {% endif %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}?v=23">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}?v=20">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin-checkin.css') }}?v=2">
    <!-- é˜²æ­¢åˆ·æ–°é¡µé¢æ—¶é—ªå± -->
    <style id="preload-style">
        .admin-section {
            display: none !important;
        }
    </style>
    <!-- ç¦ç”¨æœç´¢æ¡†è‡ªåŠ¨å¡«å……çš„æ ·å¼ -->
    <style>
        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px white inset !important;
            box-shadow: 0 0 0 30px white inset !important;
        }

        .search-box input,
        .filter-input {
            -webkit-text-security: none;
        }
    </style>
    <style>
        /* å•é€‰æŒ‰é’®æ ·å¼ */
        .radio-label {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            user-select: none;
        }

        .radio-label input[type="radio"] {
            margin-right: 6px;
            cursor: pointer;
        }

        .radio-label:hover {
            color: var(--primary-color);
        }

        /* å¤é€‰æ¡†æ ·å¼ */
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            user-select: none;
            padding: 8px 0;
        }

        .checkbox-label input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
            width: 16px;
            height: 16px;
        }

        .checkbox-label:hover {
            color: var(--primary-color);
        }

        .checkbox-label span {
            font-weight: 500;
        }
    </style>
    <script>
        (function () {
            var hash = window.location.hash.slice(1);
            var validSections = ['dashboard', 'requests', 'users', 'orders', 'redeem', 'playback', 'tickets', 'invites', 'plans', 'knowledge', 'settings'];
            // å¦‚æœæ²¡æœ‰hashæˆ–hashæ˜¯dashboardï¼ˆé»˜è®¤ï¼‰ï¼Œç§»é™¤é¢„åŠ è½½æ ·å¼è®©é»˜è®¤çš„activeç”Ÿæ•ˆ
            if (!hash || hash === 'dashboard' || validSections.indexOf(hash) === -1) {
                var style = document.getElementById('preload-style');
                if (style) style.remove();
            }
        })();
    </script>
</head>

<body class="page-admin">
    <!-- ç§»åŠ¨ç«¯é¡¶éƒ¨æ  -->
    <header class="mobile-header">
        <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleSidebar()">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <div class="mobile-logo">
            {% if site_config.site_logo %}
            <img src="{{ site_config.site_logo }}" alt="Logo">
            {% endif %}
            <span>{{ site_config.site_name or 'Emby' }}</span>
        </div>
        <div class="mobile-user-avatar">{{ (session.get('username', 'A'))[0].upper() }}</div>
    </header>

    <div class="admin-layout">
        <!-- ä¾§è¾¹æ å¯¼èˆª -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <div class="logo-icon">
                    <span>ğŸ“‹</span>
                </div>
                <span class="logo-text">ç®¡ç†é¢æ¿</span>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-section="dashboard" data-perm="dashboard"
                    onclick="switchAdminSection('dashboard', event)">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-text">ä»ªè¡¨ç›˜</span>
                </a>
                <a href="#" class="nav-item" data-section="requests" data-perm="requests"
                    onclick="switchAdminSection('requests', event)">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span class="nav-text">æ±‚ç‰‡ç®¡ç†</span>
                </a>
                <a href="#" class="nav-item" data-section="users" data-perm="users" onclick="switchAdminSection('users', event)">
                    <span class="nav-icon">ğŸ‘¥</span>
                    <span class="nav-text">ç”¨æˆ·ç®¡ç†</span>
                </a>
                <a href="#" class="nav-item" data-section="orders" data-perm="orders" onclick="switchAdminSection('orders', event)">
                    <span class="nav-icon">ğŸ“¦</span>
                    <span class="nav-text">è®¢å•ç®¡ç†</span>
                </a>
                <a href="#" class="nav-item" data-section="redeem" data-perm="redeem" onclick="switchAdminSection('redeem', event)">
                    <span class="nav-icon">ğŸŸï¸</span>
                    <span class="nav-text">å…‘æ¢ç ç®¡ç†</span>
                </a>
                <a href="#" class="nav-item" data-section="playback" data-perm="playback" onclick="switchAdminSection('playback', event)">
                    <span class="nav-icon">ğŸ“º</span>
                    <span class="nav-text">æ’­æ”¾ç›‘æ§</span>
                </a>
                <a href="#" class="nav-item" data-section="tickets" data-perm="tickets" onclick="switchAdminSection('tickets', event)">
                    <span class="nav-icon">ğŸ«</span>
                    <span class="nav-text">å·¥å•ç®¡ç†</span>
                </a>
                <a href="#" class="nav-item" data-section="invites" data-perm="invites" onclick="switchAdminSection('invites', event)">
                    <span class="nav-icon">ğŸ</span>
                    <span class="nav-text">é‚€è¯·ç»Ÿè®¡</span>
                </a>
                <a href="#" class="nav-item" data-section="plans" data-perm="plans" onclick="switchAdminSection('plans', event)">
                    <span class="nav-icon">ğŸ’°</span>
                    <span class="nav-text">å¥—é¤é…ç½®</span>
                </a>
                <a href="#" class="nav-item" data-section="knowledge" data-perm="knowledge" onclick="switchAdminSection('knowledge', event)">
                    <span class="nav-icon">ğŸ“š</span>
                    <span class="nav-text">çŸ¥è¯†åº“</span>
                </a>
                <a href="#" class="nav-item" data-section="settings" data-perm="settings" onclick="switchAdminSection('settings', event)">
                    <span class="nav-icon">âš™ï¸</span>
                    <span class="nav-text">ç³»ç»Ÿè®¾ç½®</span>
                </a>
                <a href="#" class="nav-item" data-section="audit" data-perm="settings" onclick="switchAdminSection('audit', event)">
                    <span class="nav-icon">ğŸ“</span>
                    <span class="nav-text">å®¡è®¡æ—¥å¿—</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="sidebar-footer-row">
                    <a href="javascript:void(0)" class="nav-item-compact" onclick="adminLogout()">
                        <span class="nav-icon">ğŸšª</span>
                        <span class="nav-text">é€€å‡ºåå°</span>
                    </a>
                </div>
            </div>
        </aside>

        <!-- ä¾§è¾¹æ é®ç½©å±‚ï¼ˆç§»åŠ¨ç«¯ç”¨ï¼‰ -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="admin-main">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <div class="admin-topbar">
                <button class="sidebar-toggle" onclick="toggleSidebar()">â˜°</button>
                <h1 class="page-title" id="pageTitle">ä»ªè¡¨ç›˜</h1>
                <div class="topbar-actions">
                    <span class="admin-user">{{ admin_info.username or session.get('admin_username', 'ç®¡ç†å‘˜') }}{% if admin_info and not admin_info.is_super %} <small style="opacity:0.7">(å­ç®¡ç†å‘˜)</small>{% endif %}</span>
                </div>
            </div>

            <div class="admin-content">
                <!-- ä»ªè¡¨ç›˜æ€»è§ˆ -->
                <section id="section-dashboard" class="admin-section active">
                    <div class="dashboard-header">
                        <h2 class="dashboard-title">ç®¡ç†æ§åˆ¶å°</h2>
                        <button class="btn btn-primary btn-sm" onclick="loadDashboardStats()" title="åˆ·æ–°æ•°æ®">
                            ğŸ”„ åˆ·æ–°æ•°æ®
                        </button>
                    </div>

                    <!-- Tab åˆ‡æ¢ -->
                    <div class="dash-tabs">
                        <button class="dash-tab active" data-tab="overview" onclick="switchDashTab('overview')">ç³»ç»Ÿæ¦‚è§ˆ</button>
                        <button class="dash-tab" data-tab="system" onclick="switchDashTab('system')">ç³»ç»ŸçŠ¶æ€</button>
                    </div>

                    <!-- Tab: ç³»ç»Ÿæ¦‚è§ˆ -->
                    <div class="dash-tab-content active" id="dashTabOverview">
                        <!-- 4æ ¸å¿ƒæŒ‡æ ‡ -->
                        <div class="dashboard-highlights">
                            <div class="highlight-card" onclick="switchAdminSection('users', null)">
                                <div class="highlight-top">
                                    <span class="highlight-label">æ€»ç”¨æˆ·æ•°</span>
                                    <span class="highlight-icon-sm">ğŸ‘¥</span>
                                </div>
                                <span class="highlight-value" id="dash-total-users">-</span>
                                <div class="highlight-sub">
                                    <span class="highlight-change" id="dash-users-change"></span>
                                </div>
                                <a class="highlight-link" onclick="event.stopPropagation();switchAdminSection('users', null)">æŸ¥çœ‹ç”¨æˆ· â†—</a>
                            </div>
                            <div class="highlight-card" onclick="switchAdminSection('orders', null)">
                                <div class="highlight-top">
                                    <span class="highlight-label">è®¢é˜…æ”¶å…¥</span>
                                    <span class="highlight-icon-sm">ğŸ’°</span>
                                </div>
                                <span class="highlight-value" id="dash-period-revenue">-</span>
                                <div class="highlight-sub">
                                    <span class="highlight-change" id="dash-revenue-change"></span>
                                </div>
                                <a class="highlight-link" onclick="event.stopPropagation();switchAdminSection('orders', null)">æŸ¥çœ‹è´¦å• â†—</a>
                            </div>
                            <div class="highlight-card" onclick="switchAdminSection('tickets', null)">
                                <div class="highlight-top">
                                    <span class="highlight-label">å¾…å¤„ç†å·¥å•</span>
                                    <span class="highlight-icon-sm">ğŸ“‹</span>
                                </div>
                                <span class="highlight-value" id="dash-tickets-open">-</span>
                                <div class="highlight-sub">
                                    <span class="highlight-sub-text">å…± <strong id="dash-tickets-total">-</strong> ä¸ªå·¥å•</span>
                                </div>
                                <a class="highlight-link" onclick="event.stopPropagation();switchAdminSection('tickets', null)">æŸ¥çœ‹å·¥å• â†—</a>
                            </div>
                            <div class="highlight-card" onclick="switchAdminSection('requests', null)">
                                <div class="highlight-top">
                                    <span class="highlight-label">åª’ä½“è¯·æ±‚</span>
                                    <span class="highlight-icon-sm">ğŸ¬</span>
                                </div>
                                <span class="highlight-value" id="dash-requests-pending">-</span>
                                <div class="highlight-sub">
                                    <span class="highlight-sub-text">å…± <strong id="dash-requests-total">-</strong> ä¸ªè¯·æ±‚</span>
                                </div>
                                <a class="highlight-link" onclick="event.stopPropagation();switchAdminSection('requests', null)">æŸ¥çœ‹è¯·æ±‚ â†—</a>
                            </div>
                        </div>

                        <!-- ä¸¤æ å¸ƒå±€ï¼šæ”¶å…¥å›¾è¡¨ + ä»Šæ—¥æ’­æ”¾ -->
                        <div class="dash-two-col">
                            <!-- å·¦æ ï¼šæ”¶å…¥æ›²çº¿å›¾ -->
                            <div class="dash-panel dash-panel-wide">
                                <div class="dash-panel-header">
                                    <h3>ğŸ“ˆ æ”¶å…¥è¶‹åŠ¿</h3>
                                    <div class="dash-date-picker">
                                        <select id="dashRevenuePeriod" onchange="loadRevenueChart()">
                                            <option value="7">æœ€è¿‘ 7 å¤©</option>
                                            <option value="30" selected>æœ€è¿‘ 30 å¤©</option>
                                            <option value="90">æœ€è¿‘ 90 å¤©</option>
                                            <option value="180">æœ€è¿‘åŠå¹´</option>
                                            <option value="365">æœ€è¿‘ä¸€å¹´</option>
                                            <option value="custom">è‡ªå®šä¹‰</option>
                                        </select>
                                        <div id="dashCustomDateRange" class="dash-custom-date" style="display:none;">
                                            <input type="date" id="dashRevenueStart" onchange="loadRevenueChart()">
                                            <span>è‡³</span>
                                            <input type="date" id="dashRevenueEnd" onchange="loadRevenueChart()">
                                        </div>
                                    </div>
                                </div>
                                <div class="dash-revenue-summary">
                                    <div class="revenue-stat">
                                        <span class="revenue-stat-label">æœŸé—´æ€»æ”¶å…¥</span>
                                        <span class="revenue-stat-value" id="dash-chart-total-revenue">Â¥0.00</span>
                                    </div>
                                    <div class="revenue-stat">
                                        <span class="revenue-stat-label">æœŸé—´è®¢å•æ•°</span>
                                        <span class="revenue-stat-value" id="dash-chart-total-orders">0</span>
                                    </div>
                                    <div class="revenue-stat">
                                        <span class="revenue-stat-label">æ—¥å‡æ”¶å…¥</span>
                                        <span class="revenue-stat-value" id="dash-chart-avg-revenue">Â¥0.00</span>
                                    </div>
                                </div>
                                <div class="dash-chart-container" id="dashRevenueChart">
                                    <div class="dash-chart-loading">åŠ è½½ä¸­...</div>
                                </div>
                            </div>

                            <!-- å³æ ï¼šä»Šæ—¥æ’­æ”¾ç»Ÿè®¡ -->
                            <div class="dash-panel">
                                <div class="dash-panel-header">
                                    <h3>ğŸ“º ä»Šæ—¥æ’­æ”¾</h3>
                                </div>
                                <div class="dash-play-stats">
                                    <div class="play-stat-item">
                                        <div class="play-stat-icon">â–¶ï¸</div>
                                        <div class="play-stat-info">
                                            <span class="play-stat-value" id="dash-play-count">-</span>
                                            <span class="play-stat-label">æ’­æ”¾æ¬¡æ•°</span>
                                        </div>
                                    </div>
                                    <div class="play-stat-item">
                                        <div class="play-stat-icon">ğŸ‘¤</div>
                                        <div class="play-stat-info">
                                            <span class="play-stat-value" id="dash-play-users">-</span>
                                            <span class="play-stat-label">æ´»è·ƒè§‚ä¼—</span>
                                        </div>
                                    </div>
                                    <div class="play-stat-item">
                                        <div class="play-stat-icon">â±ï¸</div>
                                        <div class="play-stat-info">
                                            <span class="play-stat-value" id="dash-play-duration">-</span>
                                            <span class="play-stat-label">æ€»æ’­æ”¾æ—¶é•¿</span>
                                        </div>
                                    </div>
                                    <div class="play-stat-item">
                                        <div class="play-stat-icon">ğŸ¬</div>
                                        <div class="play-stat-info">
                                            <span class="play-stat-value" id="dash-play-movies">-</span>
                                            <span class="play-stat-label">ç”µå½±æ’­æ”¾</span>
                                        </div>
                                    </div>
                                    <div class="play-stat-item">
                                        <div class="play-stat-icon">ğŸ“º</div>
                                        <div class="play-stat-info">
                                            <span class="play-stat-value" id="dash-play-episodes">-</span>
                                            <span class="play-stat-label">å‰§é›†æ’­æ”¾</span>
                                        </div>
                                    </div>
                                    <div class="play-stat-item">
                                        <div class="play-stat-icon">ğŸ“¡</div>
                                        <div class="play-stat-info">
                                            <span class="play-stat-value" id="dash-play-transcode">-</span>
                                            <span class="play-stat-label">è½¬ç æ’­æ”¾</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="dash-play-top">
                                    <h4>ğŸ”¥ ä»Šæ—¥çƒ­æ’­</h4>
                                    <div id="dash-play-top-list" class="dash-top-list">
                                        <div class="dash-chart-loading">åŠ è½½ä¸­...</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- æœ€è¿‘æ´»åŠ¨ -->
                        <!-- æœ€è¿‘æ´»åŠ¨æ¿å—å·²ç§»é™¤ -->

                        <!-- ç»Ÿè®¡åˆ†æï¼ˆç¯å½¢å›¾ï¼‰ -->
                        <div class="dash-panel">
                            <div class="dash-panel-header">
                                <h3>ğŸ“Š ç»Ÿè®¡åˆ†æ (æœ€è¿‘ <span id="dashAnalyticsDays">30</span> å¤©)</h3>
                                <div class="dash-date-picker">
                                    <select id="dashAnalyticsPeriod" onchange="loadDashboardAnalytics()">
                                        <option value="7">æœ€è¿‘ 7 å¤©</option>
                                        <option value="30" selected>æœ€è¿‘ 30 å¤©</option>
                                        <option value="90">æœ€è¿‘ 90 å¤©</option>
                                    </select>
                                </div>
                            </div>
                            <div class="dash-donut-row">
                                <div class="dash-donut-card">
                                    <h4>ğŸ‘¤ ç”¨æˆ·ç»Ÿè®¡</h4>
                                    <div class="donut-chart-wrap" id="donutUsers"></div>
                                    <div class="donut-legend" id="legendUsers"></div>
                                </div>
                                <div class="dash-donut-card">
                                    <h4>ğŸ“± å®¢æˆ·ç«¯ç»Ÿè®¡</h4>
                                    <div class="donut-chart-wrap" id="donutClients"></div>
                                    <div class="donut-legend" id="legendClients"></div>
                                </div>
                                <div class="dash-donut-card">
                                    <h4>ğŸ–¥ï¸ è®¾å¤‡ç»Ÿè®¡</h4>
                                    <div class="donut-chart-wrap" id="donutDevices"></div>
                                    <div class="donut-legend" id="legendDevices"></div>
                                </div>
                            </div>
                        </div>

                        <!-- åª’ä½“ç»Ÿè®¡ï¼ˆç¯å½¢å›¾ï¼‰ -->
                        <div class="dash-panel">
                            <div class="dash-panel-header">
                                <h3>ğŸ¬ åª’ä½“ç»Ÿè®¡ (æœ€è¿‘ <span id="dashMediaDays">30</span> å¤©)</h3>
                            </div>
                            <div class="dash-donut-row dash-donut-row-2">
                                <div class="dash-donut-card dash-donut-card-lg">
                                    <h4>ğŸ¬ ç”µå½±ç»Ÿè®¡</h4>
                                    <div class="donut-chart-wrap donut-chart-lg" id="donutMovies"></div>
                                    <div class="donut-legend donut-legend-paged" id="legendMovies"></div>
                                </div>
                                <div class="dash-donut-card dash-donut-card-lg">
                                    <h4>ğŸ“º å‰§é›†ç»Ÿè®¡</h4>
                                    <div class="donut-chart-wrap donut-chart-lg" id="donutSeries"></div>
                                    <div class="donut-legend donut-legend-paged" id="legendSeries"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ•°æ®åˆ†æå’Œæ´»åŠ¨æ—¥å¿—Tabå·²ç§»é™¤ -->

                    <!-- Tab: ç³»ç»ŸçŠ¶æ€ -->
                    <div class="dash-tab-content" id="dashTabSystem">
                        <div class="dash-panel">
                            <div class="dash-panel-header">
                                <h3>ğŸ–¥ï¸ åç«¯ç³»ç»ŸçŠ¶æ€</h3>
                                <span class="dash-sub-text">å®æ—¶ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ</span>
                            </div>
                            <div class="dash-system-stats">
                                <div class="system-stat-row">
                                    <span class="system-stat-label">CPUä½¿ç”¨ç‡</span>
                                    <div class="system-bar-wrap">
                                        <div class="system-bar"><div class="system-bar-fill" id="dashCpuBar" style="width:0%"></div></div>
                                    </div>
                                    <span class="system-stat-val" id="dashCpuVal">- %</span>
                                </div>
                                <div class="system-stat-row">
                                    <span class="system-stat-label">å†…å­˜ä½¿ç”¨ç‡</span>
                                    <div class="system-bar-wrap">
                                        <div class="system-bar"><div class="system-bar-fill" id="dashMemBar" style="width:0%"></div></div>
                                    </div>
                                    <span class="system-stat-val" id="dashMemVal">- %</span>
                                </div>
                                <div class="system-stat-row">
                                    <span class="system-stat-label">ç£ç›˜ä½¿ç”¨ç‡</span>
                                    <div class="system-bar-wrap">
                                        <div class="system-bar"><div class="system-bar-fill" id="dashDiskBar" style="width:0%"></div></div>
                                    </div>
                                    <span class="system-stat-val" id="dashDiskVal">- %</span>
                                </div>
                            </div>
                            <div class="dash-system-info">
                                <span class="dash-sub-text">æœ€åæ›´æ–°: <span id="dashSystemTime">-</span></span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- æ±‚ç‰‡ç®¡ç†éƒ¨åˆ† -->
                <section id="section-requests" class="admin-section">
                    <!-- å¿«æ·æ“ä½œåŒº -->
                    <div class="quick-actions">
                        <div class="action-item" onclick="filterRequests('pending')">
                            <div class="action-icon pending">â³</div>
                            <div class="action-info">
                                <h4>{{ stats.pending }}</h4>
                                <p>å¾…å¤„ç†</p>
                            </div>
                        </div>
                        <div class="action-item" onclick="filterRequests('downloading')">
                            <div class="action-icon downloading">ğŸ“¥</div>
                            <div class="action-info">
                                <h4>{{ stats.downloading }}</h4>
                                <p>ä¸‹è½½ä¸­</p>
                            </div>
                        </div>
                        <div class="action-item" onclick="filterRequests('downloaded')">
                            <div class="action-icon downloaded">ğŸ“¦</div>
                            <div class="action-info">
                                <h4>{{ stats.downloaded }}</h4>
                                <p>å¾…å…¥åº“</p>
                            </div>
                        </div>
                        <div class="action-item" onclick="syncDownloads()">
                            <div class="action-icon sync">ğŸ”„</div>
                            <div class="action-info">
                                <h4>åŒæ­¥</h4>
                                <p>ä¸‹è½½çŠ¶æ€</p>
                            </div>
                        </div>
                        <div class="action-item" onclick="refreshDashboard()">
                            <div class="action-icon refresh">â†»</div>
                            <div class="action-info">
                                <h4>åˆ·æ–°</h4>
                                <p>æ›´æ–°æ•°æ®</p>
                            </div>
                        </div>
                    </div>

                    <div class="stats">
                        <div class="stat-card total" onclick="filterRequests('all')" style="cursor: pointer;">
                            <div class="stat-icon">ğŸ“Š</div>
                            <div class="stat-content">
                                <h3>{{ stats.total }}</h3>
                                <p>æ€»æ±‚ç‰‡æ•°</p>
                            </div>
                        </div>
                        <div class="stat-card pending" onclick="filterRequests('pending')" style="cursor: pointer;">
                            <div class="stat-icon">â³</div>
                            <div class="stat-content">
                                <h3>{{ stats.pending }}</h3>
                                <p>å¾…å¤„ç†</p>
                            </div>
                        </div>
                        <div class="stat-card approved" onclick="filterRequests('approved')" style="cursor: pointer;">
                            <div class="stat-icon">âœ…</div>
                            <div class="stat-content">
                                <h3>{{ stats.approved }}</h3>
                                <p>å·²æ‰¹å‡†</p>
                            </div>
                        </div>
                        <div class="stat-card completed" onclick="filterRequests('completed')" style="cursor: pointer;">
                            <div class="stat-icon">ğŸ‰</div>
                            <div class="stat-content">
                                <h3>{{ stats.completed }}</h3>
                                <p>å·²å®Œæˆ</p>
                            </div>
                        </div>
                        <div class="stat-card rejected" onclick="filterRequests('rejected')" style="cursor: pointer;">
                            <div class="stat-icon">âŒ</div>
                            <div class="stat-content">
                                <h3>{{ stats.rejected }}</h3>
                                <p>å·²æ‹’ç»</p>
                            </div>
                        </div>
                        <div class="stat-card downloading" onclick="filterRequests('downloading')"
                            style="cursor: pointer;">
                            <div class="stat-icon">ğŸ“¥</div>
                            <div class="stat-content">
                                <h3>{{ stats.downloading }}</h3>
                                <p>ä¸‹è½½ä¸­</p>
                            </div>
                        </div>
                        <div class="stat-card downloaded" onclick="filterRequests('downloaded')"
                            style="cursor: pointer;">
                            <div class="stat-icon">ğŸ“¦</div>
                            <div class="stat-content">
                                <h3>{{ stats.downloaded }}</h3>
                                <p>å¾…å…¥åº“</p>
                            </div>
                        </div>
                        <div class="stat-card failed" onclick="filterRequests('failed')" style="cursor: pointer;">
                            <div class="stat-icon">âš ï¸</div>
                            <div class="stat-content">
                                <h3>{{ stats.failed }}</h3>
                                <p>å¤±è´¥</p>
                            </div>
                        </div>
                    </div>

                    <!-- ç»Ÿè®¡å›¾è¡¨åŒºåŸŸ -->
                    <div class="chart-section">
                        <div class="chart-container">
                            <h3>ğŸ“ˆ è¿‘30å¤©æ±‚ç‰‡è¶‹åŠ¿</h3>
                            <canvas id="dailyChart"></canvas>
                        </div>
                        <div class="chart-container chart-small">
                            <h3>ğŸ“Š ç±»å‹åˆ†å¸ƒ</h3>
                            <canvas id="typeChart"></canvas>
                        </div>
                    </div>

                    <div class="requests-section">
                        <div class="section-header">
                            <h2>ğŸ“‹ æ±‚ç‰‡ç®¡ç†</h2>
                            <div class="header-actions">
                                <!-- æœç´¢æ¡† -->
                                <div class="search-box">
                                    <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢å½±ç‰‡åç§°ã€ç”¨æˆ·..."
                                        onkeyup="searchRequests()" autocomplete="off" autocorrect="off"
                                        autocapitalize="off" spellcheck="false" data-form-type="other">
                                </div>
                                <!-- å¯¼å‡ºæŒ‰é’® -->
                                <button class="export-btn" onclick="exportRequests()" title="å¯¼å‡ºå½“å‰æ•°æ®">ğŸ“¤ å¯¼å‡º</button>
                                <!-- æ‰¹é‡æ“ä½œæŒ‰é’® -->
                                <div class="batch-actions" id="batchActions" style="display: none;">
                                    <span class="selected-count">å·²é€‰æ‹© <strong id="selectedCount">0</strong> æ¡</span>
                                    <button class="batch-btn batch-approve" onclick="batchUpdate('approved')">âœ…
                                        æ‰¹é‡æ‰¹å‡†</button>
                                    <button class="batch-btn batch-complete" onclick="batchUpdate('completed')">ğŸ‰
                                        æ‰¹é‡å®Œæˆ</button>
                                    <button class="batch-btn batch-reject" onclick="showBatchNoteModal()">âŒ
                                        æ‰¹é‡æ‹’ç»</button>
                                    <button class="batch-btn batch-delete" onclick="batchDelete()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
                                </div>
                            </div>
                        </div>

                        <div class="filter-tabs">
                            <button class="{{ 'active' if current_status == 'all' else '' }}"
                                onclick="filterRequests('all')">å…¨éƒ¨</button>
                            <button class="{{ 'active' if current_status == 'pending' else '' }}"
                                onclick="filterRequests('pending')">å¾…å¤„ç†</button>
                            <button class="{{ 'active' if current_status in ['approved', 'processing'] else '' }}"
                                onclick="filterRequests('approved')">å·²æ‰¹å‡†</button>
                            <button class="{{ 'active' if current_status == 'completed' else '' }}"
                                onclick="filterRequests('completed')">å·²å®Œæˆ</button>
                            <button class="{{ 'active' if current_status == 'rejected' else '' }}"
                                onclick="filterRequests('rejected')">å·²æ‹’ç»</button>
                            <button class="{{ 'active' if current_status == 'downloading' else '' }}"
                                onclick="filterRequests('downloading')">ä¸‹è½½ä¸­</button>
                            <button class="{{ 'active' if current_status == 'downloaded' else '' }}"
                                onclick="filterRequests('downloaded')">å¾…å…¥åº“</button>
                            <button class="{{ 'active' if current_status == 'failed' else '' }}"
                                onclick="filterRequests('failed')">å¤±è´¥</button>
                        </div>

                        <table class="request-table">
                            <thead>
                                <tr>
                                    <th style="width: 40px;"><input type="checkbox" id="selectAll"
                                            onchange="toggleSelectAll()"></th>
                                    <th>å½±ç‰‡ä¿¡æ¯</th>
                                    <th>ç”¨æˆ·</th>
                                    <th>ç±»å‹</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æ±‚ç‰‡æ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="requestTableBody">
                                {% for req in requests %}
                                <tr data-status="{{ req.status }}" data-id="{{ req.id }}"
                                    data-request-id="{{ req.id }}">
                                    <td data-label="é€‰æ‹©"><input type="checkbox" class="row-checkbox" value="{{ req.id }}"
                                            onchange="updateSelectedCount()"></td>
                                    <td data-label="å½±ç‰‡ä¿¡æ¯">
                                        <div class="movie-info">
                                            {% if req.poster_path %}
                                            <img src="{{ tmdb_image_base }}{{ req.poster_path }}" alt="{{ req.title }}">
                                            {% else %}
                                            <div
                                                style="width: 50px; height: 75px; background: #ddd; border-radius: 5px; display: flex; align-items: center; justify-content: center;">
                                                ğŸ¬</div>
                                            {% endif %}
                                            <div class="details">
                                                <h4>{{ req.title }}</h4>
                                                <p>{{ req.year }} | TMDB ID: {{ req.tmdb_id }}</p>
                                                {% if req.admin_note %}
                                                <p style="color: #e74c3c;">å¤‡æ³¨: {{ req.admin_note }}</p>
                                                {% endif %}
                                                {% if req.download_task %}
                                                {% if req.status == 'completed' %}
                                                <!-- å·²å…¥åº“çŠ¶æ€ -->
                                                <div class="download-progress completed" data-request-id="{{ req.id }}">
                                                    <div class="progress-track">
                                                        <div class="progress-fill" style="width: 100%;"></div>
                                                    </div>
                                                    <div class="progress-meta">
                                                        <span class="progress-value" style="color: #059669;">âœ…
                                                            å·²å…¥åº“</span>
                                                    </div>
                                                </div>
                                                {% elif req.download_task.progress and req.download_task.progress >= 100
                                                %}
                                                <!-- å·²ä¸‹è½½å®Œæˆï¼Œå¾…å…¥åº“ -->
                                                <div class="download-progress completed" data-request-id="{{ req.id }}">
                                                    <div class="progress-track">
                                                        <div class="progress-fill" style="width: 100%;"></div>
                                                    </div>
                                                    <div class="progress-meta">
                                                        <span class="progress-value" style="color: #f59e0b;">ğŸ“¦
                                                            å·²ä¸‹è½½å®Œæˆ</span>
                                                    </div>
                                                </div>
                                                {% else %}
                                                <!-- ä¸‹è½½ä¸­ -->
                                                <div class="download-progress" data-request-id="{{ req.id }}"
                                                    data-progress="{{ req.download_task.progress or 0 }}"
                                                    data-speed="{{ req.download_task.download_speed or 0 }}"
                                                    data-eta="{{ req.download_task.eta if req.download_task.eta is not none else -1 }}">
                                                    <div class="progress-track">
                                                        <div class="progress-fill"
                                                            style="width: {{ (req.download_task.progress or 0)|round(1) }}%;">
                                                        </div>
                                                    </div>
                                                    <div class="progress-meta">
                                                        <span class="progress-value">{{ (req.download_task.progress or
                                                            0)|round(1) }}%</span>
                                                        <span class="progress-speed">0 B/s</span>
                                                        <span class="progress-eta">ETA --:--:--</span>
                                                    </div>
                                                </div>
                                                {% endif %}
                                                {% endif %}
                                            </div>
                                        </div>
                                    </td>
                                    <td data-label="ç”¨æˆ·">{{ req.user.emby_name or req.user.name or 'æœªçŸ¥ç”¨æˆ·' }}</td>
                                    <td data-label="ç±»å‹">
                                        <div
                                            style="display: flex; flex-direction: column; gap: 4px; align-items: flex-start;">
                                            {% if req.media_type == 'movie' %}
                                            <span
                                                style="background: #667eea; color: white; padding: 4px 10px; border-radius: 4px; font-size: 12px; white-space: nowrap;">ğŸ¬
                                                ç”µå½±</span>
                                            {% else %}
                                            <span
                                                style="background: #764ba2; color: white; padding: 4px 10px; border-radius: 4px; font-size: 12px; white-space: nowrap;">ğŸ“º
                                                å‰§é›†</span>
                                            {% if req.get_request_scope() %}
                                            <span
                                                style="background: #10b981; color: white; padding: 4px 10px; border-radius: 4px; font-size: 11px; white-space: nowrap;">{{
                                                req.get_request_scope() }}</span>
                                            {% endif %}
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td data-label="çŠ¶æ€">
                                        <span class="status-badge {{ req.status }}">
                                            {% if req.status == 'pending' %}å¾…å¤„ç†
                                            {% elif req.status == 'approved' %}å·²æ‰¹å‡†
                                            {% elif req.status == 'processing' %}å·²æ‰¹å‡†
                                            {% elif req.status == 'completed' %}å·²å®Œæˆ
                                            {% elif req.status == 'rejected' %}å·²æ‹’ç»
                                            {% elif req.status == 'downloading' %}ä¸‹è½½ä¸­
                                            {% elif req.status == 'downloaded' %}å¾…å…¥åº“
                                            {% elif req.status == 'failed' %}ä¸‹è½½å¤±è´¥
                                            {% endif %}
                                        </span>
                                    </td>
                                    <td data-label="æ±‚ç‰‡æ—¶é—´">{{ req.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td data-label="æ“ä½œ">
                                        <div class="action-buttons">
                                            {% if req.status == 'pending' %}
                                            <button class="btn-approve" data-id="{{ req.id }}"
                                                onclick="showApproveModal(this.dataset.id)">æ‰¹å‡†</button>
                                            <button class="btn-reject" data-id="{{ req.id }}"
                                                onclick="showNoteModal(this.dataset.id, 'rejected')">æ‹’ç»</button>
                                            {% elif req.status == 'approved' or req.status == 'processing' %}
                                            <button class="btn-complete" data-id="{{ req.id }}"
                                                onclick="updateStatus(this.dataset.id, 'completed')">å·²å…¥åº“</button>
                                            {% elif req.status == 'downloaded' or req.status == 'downloading' %}
                                            <button class="btn-complete" data-id="{{ req.id }}"
                                                onclick="updateStatus(this.dataset.id, 'completed')"
                                                title="æ‰‹åŠ¨æ ‡è®°ä¸ºå·²å…¥åº“">å·²å…¥åº“</button>
                                            {% endif %}
                                            {% if mp_enabled and req.status in ['pending', 'approved', 'processing',
                                            'failed', 'downloaded'] %}
                                            <button class="btn-secondary" data-request="{{ req.id }}"
                                                data-title="{{ req.title }}" data-year="{{ req.year }}"
                                                data-media-type="{{ req.media_type }}"
                                                data-request-type="{{ req.request_type or 'all' }}"
                                                data-season="{{ req.season_number or '' }}"
                                                data-episode="{{ req.episode_number or '' }}"
                                                onclick="openPtModal(this)">PTæœç´¢</button>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>

                        <!-- åˆ†é¡µå¯¼èˆª -->
                        {% if pagination and pagination.pages > 1 %}
                        <div class="pagination">
                            {% if pagination.has_prev %}
                            <a href="?status={{ current_status }}&page={{ pagination.prev_num }}"
                                class="page-btn">ä¸Šä¸€é¡µ</a>
                            {% endif %}

                            {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2,
                            right_current=2) %}
                            {% if page_num %}
                            {% if page_num == pagination.page %}
                            <span class="page-btn active">{{ page_num }}</span>
                            {% else %}
                            <a href="?status={{ current_status }}&page={{ page_num }}" class="page-btn">{{ page_num
                                }}</a>
                            {% endif %}
                            {% else %}
                            <span class="page-ellipsis">...</span>
                            {% endif %}
                            {% endfor %}

                            {% if pagination.has_next %}
                            <a href="?status={{ current_status }}&page={{ pagination.next_num }}"
                                class="page-btn">ä¸‹ä¸€é¡µ</a>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </section>

                <!-- è®¢é˜…ç®¡ç†éƒ¨åˆ† -->
                <section id="section-subscriptions" class="admin-section">
                    <div class="section-header">
                        <h2>ğŸ’ è®¢é˜…ç®¡ç†</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <input type="text" id="subscriptionSearch" placeholder="ğŸ” æœç´¢ç”¨æˆ·..."
                                    onkeyup="searchSubscriptions()" autocomplete="off" autocorrect="off"
                                    autocapitalize="off" spellcheck="false" data-form-type="other">
                            </div>
                            <select id="subscriptionStatusFilter" onchange="loadSubscriptions()">
                                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                <option value="active">ç”Ÿæ•ˆä¸­</option>
                                <option value="expired">å·²è¿‡æœŸ</option>
                                <option value="cancelled">å·²å–æ¶ˆ</option>
                            </select>
                            <button class="btn btn-secondary" onclick="syncSubscriptionRecords()"
                                title="ä¸ºæœ‰è®¢é˜…ä½†æ²¡æœ‰è®¢é˜…è®°å½•çš„ç”¨æˆ·è¡¥å……åˆ›å»ºè®°å½•">
                                ğŸ”„ åŒæ­¥è®¢é˜…è®°å½•
                            </button>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="action-item">
                            <div class="action-icon">ğŸ’</div>
                            <div class="action-info">
                                <h4 id="totalSubscriptions">0</h4>
                                <p>æ€»è®¢é˜…æ•°</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">âœ…</div>
                            <div class="action-info">
                                <h4 id="activeSubscriptions">0</h4>
                                <p>ç”Ÿæ•ˆä¸­</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">â°</div>
                            <div class="action-info">
                                <h4 id="expiredSubscriptions">0</h4>
                                <p>å·²è¿‡æœŸ</p>
                            </div>
                        </div>
                    </div>

                    <div class="batch-actions" id="subscriptionBatchActions" style="display:none;">
                        <span class="batch-info">å·²é€‰æ‹© <strong id="selectedSubscriptionCount">0</strong> æ¡</span>
                        <button class="batch-btn" onclick="batchExtendSubscriptions()" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;">â³ æ‰¹é‡å»¶æœŸ</button>
                        <button class="batch-btn danger" onclick="batchDeleteSubscriptions()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
                    </div>

                    <table class="admin-table" id="subscriptionsTable">
                        <thead>
                            <tr>
                                <th style="width:40px;"><input type="checkbox" id="selectAllSubscriptions" onchange="toggleSelectAllSubscriptions()"></th>
                                <th>ç”¨æˆ·å</th>
                                <th>TG ID</th>
                                <th>ç”¨æˆ·ç±»å‹</th>
                                <th>æ³¨å†Œæ—¶é—´</th>
                                <th>åˆ°æœŸæ—¶é—´</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="subscriptionsTableBody">
                            <tr>
                                <td colspan="8" class="loading-cell">åŠ è½½ä¸­...</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- è®¢å•ç®¡ç†éƒ¨åˆ† -->
                <section id="section-orders" class="admin-section">
                    <div class="section-header">
                        <h2>ğŸ“¦ è®¢å•ç®¡ç†</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <input type="text" id="orderSearch" placeholder="ğŸ” æœç´¢è®¢å•å·..." onkeyup="searchOrders()"
                                    autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                                    data-form-type="other">
                            </div>
                            <select id="orderStatusFilter" onchange="loadOrders()">
                                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                <option value="pending">å¾…æ”¯ä»˜</option>
                                <option value="paid">å·²æ”¯ä»˜</option>
                                <option value="cancelled">å·²å–æ¶ˆ</option>
                                <option value="refunded">å·²é€€æ¬¾</option>
                            </select>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="action-item">
                            <div class="action-icon">ğŸ“¦</div>
                            <div class="action-info">
                                <h4 id="totalOrders">0</h4>
                                <p>æ€»è®¢å•æ•°</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">â³</div>
                            <div class="action-info">
                                <h4 id="pendingOrders">0</h4>
                                <p>å¾…æ”¯ä»˜</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">ğŸ’°</div>
                            <div class="action-info">
                                <h4 id="paidOrders">0</h4>
                                <p>å·²æ”¯ä»˜</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">ğŸ’µ</div>
                            <div class="action-info">
                                <h4 id="totalRevenue">Â¥0</h4>
                                <p>æ€»æ”¶å…¥</p>
                            </div>
                        </div>
                    </div>

                    <div class="batch-actions" id="orderBatchActions" style="display:none;">
                        <span class="batch-info">å·²é€‰æ‹© <strong id="selectedOrderCount">0</strong> æ¡</span>
                        <button class="batch-btn warning" onclick="batchCancelOrders()">âŒ æ‰¹é‡å–æ¶ˆ</button>
                        <button class="batch-btn danger" onclick="batchDeleteOrders()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
                    </div>

                    <table class="admin-table" id="ordersTable">
                        <thead>
                            <tr>
                                <th style="width:40px;"><input type="checkbox" id="selectAllOrders" onchange="toggleSelectAllOrders()"></th>
                                <th>è®¢å•å·</th>
                                <th>ç”¨æˆ·</th>
                                <th>å¥—é¤</th>
                                <th>é‡‘é¢</th>
                                <th>æ”¯ä»˜æ–¹å¼</th>
                                <th>çŠ¶æ€</th>
                                <th>åˆ›å»ºæ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <tr>
                                <td colspan="9" class="loading-cell">åŠ è½½ä¸­...</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- å…‘æ¢ç ç®¡ç†éƒ¨åˆ† -->
                <section id="section-redeem" class="admin-section">
                    <div class="section-header">
                        <h2>ğŸŸï¸ å…‘æ¢ç ç®¡ç†</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" onclick="showGenerateRedeemDialog()">
                                <span>â•</span> ç”Ÿæˆå…‘æ¢ç 
                            </button>
                            <button class="btn btn-danger" id="batchDeleteRedeemBtn" style="display: none;"
                                onclick="showDeleteRedeemConfirm()">
                                <span>ğŸ—‘ï¸</span> æ‰¹é‡åˆ é™¤ (<span id="selectedRedeemCount">0</span>)
                            </button>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="action-item">
                            <div class="action-icon">ğŸŸï¸</div>
                            <div class="action-info">
                                <h4 id="totalCodes">0</h4>
                                <p>æ€»å…‘æ¢ç </p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">âœ…</div>
                            <div class="action-info">
                                <h4 id="usedCodes">0</h4>
                                <p>å·²ä½¿ç”¨</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">â³</div>
                            <div class="action-info">
                                <h4 id="unusedCodes">0</h4>
                                <p>æœªä½¿ç”¨</p>
                            </div>
                        </div>
                    </div>

                    <div class="filter-bar">
                        <select id="codeTypeFilter" onchange="loadRedeemCodes()">
                            <option value="">å…¨éƒ¨ç±»å‹</option>
                            <option value="new">æ–°è®¢é˜…</option>
                            <option value="renew">ç»­è´¹</option>
                        </select>
                        <select id="codeStatusFilter" onchange="loadRedeemCodes()">
                            <option value="">å…¨éƒ¨çŠ¶æ€</option>
                            <option value="unused">æœªä½¿ç”¨</option>
                            <option value="used">å·²ä½¿ç”¨</option>
                        </select>
                    </div>

                    <table class="admin-table" id="redeemCodesTable">
                        <thead>
                            <tr>
                                <th style="width: 40px;"><input type="checkbox" id="selectAllRedeem"
                                        onchange="toggleSelectAllRedeem()"></th>
                                <th>å…‘æ¢ç </th>
                                <th>ç±»å‹</th>
                                <th>å¥—é¤</th>
                                <th>å¤©æ•°</th>
                                <th>çŠ¶æ€</th>
                                <th>ä½¿ç”¨è€…</th>
                                <th>ä½¿ç”¨æ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="redeemCodesTableBody">
                            <tr>
                                <td colspan="9" class="loading-cell">åŠ è½½ä¸­...</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="redeem-pagination">
                        <button onclick="changeRedeemPage(-1)" id="redeemPrevBtn">ä¸Šä¸€é¡µ</button>
                        <span id="redeemPageInfo">ç¬¬ 1 / 1 é¡µ</span>
                        <button onclick="changeRedeemPage(1)" id="redeemNextBtn">ä¸‹ä¸€é¡µ</button>
                    </div>
                </section>

                <!-- æ’­æ”¾ç›‘æ§éƒ¨åˆ† -->
                <section id="section-playback" class="admin-section">
                    <div class="section-header">
                        <h2>ğŸ“º æ’­æ”¾ç›‘æ§</h2>
                        <div class="header-actions">
                            <button class="btn btn-secondary" onclick="syncAllPlaybackHistory()">
                                ğŸ“¥ åŒæ­¥å†å²
                            </button>
                            <button class="btn btn-primary" onclick="refreshAdminPlayback()">
                                ğŸ”„ åˆ·æ–°æ•°æ®
                            </button>
                        </div>
                    </div>

                    <!-- å®æ—¶ç»Ÿè®¡ -->
                    <div class="playback-admin-stats" id="adminPlaybackStats">
                        <div class="stat-box">
                            <div class="stat-value" id="adminTotalSessions">-</div>
                            <div class="stat-label">æ­£åœ¨æ’­æ”¾</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="adminTotalDevices">-</div>
                            <div class="stat-label">æ³¨å†Œè®¾å¤‡</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="adminTotalHistory">-</div>
                            <div class="stat-label">æ’­æ”¾è®°å½•</div>
                        </div>
                    </div>

                    <!-- é€‰é¡¹å¡ -->
                    <div class="playback-tabs">
                        <button class="tab-btn active" onclick="switchPlaybackTab('sessions')">å®æ—¶ä¼šè¯</button>
                        <button class="tab-btn" onclick="switchPlaybackTab('devices')">è®¾å¤‡ç®¡ç†</button>
                        <button class="tab-btn" onclick="switchPlaybackTab('blacklist')">è®¾å¤‡é»‘åå•</button>
                        <button class="tab-btn" onclick="switchPlaybackTab('history')">æ’­æ”¾å†å²</button>
                    </div>

                    <!-- å®æ—¶ä¼šè¯ -->
                    <div id="playbackTabSessions" class="playback-tab-content active">
                        <div class="admin-sessions-grid" id="adminSessionsContainer">
                            <div class="loading-placeholder">
                                <div class="loading-spinner"></div>
                                <span>åŠ è½½ä¸­...</span>
                            </div>
                        </div>
                    </div>

                    <!-- è®¾å¤‡ç®¡ç† -->
                    <div id="playbackTabDevices" class="playback-tab-content">
                        <div class="filter-bar">
                            <input type="text" id="deviceSearchInput" placeholder="æœç´¢ç”¨æˆ·/è®¾å¤‡åç§°..."
                                onkeyup="searchAdminDevices()" autocomplete="off" autocorrect="off" autocapitalize="off"
                                spellcheck="false" data-form-type="other">
                        </div>
                        <div class="batch-actions" id="deviceBatchActions" style="display:none;">
                            <span class="batch-info">å·²é€‰æ‹© <strong id="selectedDeviceCount">0</strong> æ¡</span>
                            <button class="batch-btn danger" onclick="batchDeleteDevices()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
                            <button class="batch-btn warning" onclick="batchBlockDevices()">ğŸš« æ‰¹é‡ç¦ç”¨</button>
                            <button class="batch-btn success" onclick="batchUnblockDevices()">âœ… æ‰¹é‡è§£ç¦</button>
                        </div>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th style="width:40px;"><input type="checkbox" id="selectAllDevices" onchange="toggleSelectAllDevices()"></th>
                                        <th>ç”¨æˆ·</th>
                                        <th>è®¾å¤‡åç§°</th>
                                        <th>å®¢æˆ·ç«¯</th>
                                        <th>æœ€åæ´»è·ƒ</th>
                                        <th>æœ€åIP</th>
                                        <th>çŠ¶æ€</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="adminDevicesBody">
                                    <tr>
                                        <td colspan="8" class="loading-cell">åŠ è½½ä¸­...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="devicesPagination"></div>
                    </div>

                    <!-- æ’­æ”¾å†å² -->
                    <div id="playbackTabHistory" class="playback-tab-content">
                        <div class="filter-bar">
                            <input type="text" id="historySearchInput" placeholder="æœç´¢åª’ä½“åç§°..."
                                onkeyup="searchAdminHistory()" autocomplete="off" autocorrect="off" autocapitalize="off"
                                spellcheck="false" data-form-type="other">
                        </div>
                        <div class="batch-actions" id="historyBatchActions" style="display:none;">
                            <span class="batch-info">å·²é€‰æ‹© <strong id="selectedHistoryCount">0</strong> æ¡</span>
                            <button class="batch-btn danger" onclick="batchDeleteHistory()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
                        </div>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th style="width:40px;"><input type="checkbox" id="selectAllHistory" onchange="toggleSelectAllHistory()"></th>
                                        <th>ç”¨æˆ·</th>
                                        <th>åª’ä½“</th>
                                        <th>ç±»å‹</th>
                                        <th>è®¾å¤‡</th>
                                        <th>è¿›åº¦</th>
                                        <th>å¼€å§‹æ—¶é—´</th>
                                    </tr>
                                </thead>
                                <tbody id="adminHistoryBody">
                                    <tr>
                                        <td colspan="7" class="loading-cell">åŠ è½½ä¸­...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="historyPagination"></div>
                    </div>

                    <!-- è®¾å¤‡é»‘åå• -->
                    <div id="playbackTabBlacklist" class="playback-tab-content">
                        <div class="section-header">
                            <div class="header-actions">
                                <button class="btn-primary" onclick="showAddBlacklistModal()">â• æ·»åŠ è§„åˆ™</button>
                            </div>
                        </div>

                        <div class="info-box warning">
                            <strong>ğŸ’¡ åŠŸèƒ½è¯´æ˜ï¼š</strong>
                            <ul>
                                <li>æ”¯æŒä½¿ç”¨é€šé…ç¬¦ï¼ˆ* å’Œ ?ï¼‰åŒ¹é…å®¢æˆ·ç«¯å’Œè®¾å¤‡åç§°</li>
                                <li><strong>åœæ­¢æ’­æ”¾ï¼š</strong>ç¦ç”¨è¯¥è®¾å¤‡ï¼Œä½†ä¸ç¦ç”¨ç”¨æˆ·è´¦å·</li>
                                <li><strong>åœæ­¢+ç¦å·ï¼š</strong>ç¦ç”¨è®¾å¤‡å¹¶è‡ªåŠ¨ç¦ç”¨ç”¨æˆ·è´¦å·</li>
                                <li>æ£€æµ‹åˆ°é»‘åå•è®¾å¤‡æ—¶ä¼šè‡ªåŠ¨å‘é€é€šçŸ¥ç»™ç®¡ç†å‘˜</li>
                            </ul>
                        </div>

                        <div class="batch-actions" id="blacklistBatchActions" style="display:none;">
                            <span class="batch-info">å·²é€‰æ‹© <strong id="selectedBlacklistCount">0</strong> æ¡</span>
                            <button class="batch-btn danger" onclick="batchDeleteBlacklist()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
                        </div>
                        <div class="admin-table-container">
                            <table class="admin-table" id="blacklistTable">
                                <thead>
                                    <tr>
                                        <th style="width:40px;"><input type="checkbox" id="selectAllBlacklist" onchange="toggleSelectAllBlacklist()"></th>
                                        <th>è§„åˆ™åç§°</th>
                                        <th>å®¢æˆ·ç«¯åŒ¹é…</th>
                                        <th>è®¾å¤‡åç§°åŒ¹é…</th>
                                        <th>å¤„ç†æ–¹å¼</th>
                                        <th>çŠ¶æ€</th>
                                        <th>åˆ›å»ºæ—¶é—´</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="blacklistTableBody">
                                    <tr>
                                        <td colspan="8" class="loading-cell">åŠ è½½ä¸­...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- å·¥å•ç®¡ç†éƒ¨åˆ† -->
                <section id="section-tickets" class="admin-section">
                    <div class="section-header">
                        <h2>ğŸ« å·¥å•ç®¡ç†</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <input type="text" id="ticketSearch" placeholder="ğŸ” æœç´¢å·¥å•..." onkeyup="searchTickets()"
                                    autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                                    data-form-type="other">
                            </div>
                            <select id="ticketStatusFilter" onchange="loadTickets()">
                                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                <option value="open">å¾…å¤„ç†</option>
                                <option value="in_progress">å¤„ç†ä¸­</option>
                                <option value="closed">å·²å…³é—­</option>
                            </select>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="action-item">
                            <div class="action-icon">ğŸ«</div>
                            <div class="action-info">
                                <h4 id="totalTickets">0</h4>
                                <p>æ€»å·¥å•æ•°</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">ğŸ”´</div>
                            <div class="action-info">
                                <h4 id="openTickets">0</h4>
                                <p>å¾…å¤„ç†</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">ğŸŸ¡</div>
                            <div class="action-info">
                                <h4 id="inProgressTickets">0</h4>
                                <p>å¤„ç†ä¸­</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">âš«</div>
                            <div class="action-info">
                                <h4 id="closedTickets">0</h4>
                                <p>å·²å…³é—­</p>
                            </div>
                        </div>
                    </div>

                    <div class="batch-actions" id="ticketBatchActions" style="display:none;">
                        <span class="batch-info">å·²é€‰æ‹© <strong id="selectedTicketCount">0</strong> æ¡</span>
                        <button class="batch-btn warning" onclick="batchCloseTickets()">ğŸ”’ æ‰¹é‡å…³é—­</button>
                        <button class="batch-btn danger" onclick="batchDeleteTickets()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
                    </div>

                    <table class="admin-table" id="ticketsTable">
                        <thead>
                            <tr>
                                <th style="width:40px;"><input type="checkbox" id="selectAllTickets" onchange="toggleSelectAllTickets()"></th>
                                <th>å·¥å•å·</th>
                                <th>ç”¨æˆ·</th>
                                <th>ç±»åˆ«</th>
                                <th>ä¸»é¢˜</th>
                                <th>ä¼˜å…ˆçº§</th>
                                <th>çŠ¶æ€</th>
                                <th>åˆ›å»ºæ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="ticketsTableBody">
                            <tr>
                                <td colspan="9" class="loading-cell">åŠ è½½ä¸­...</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- é‚€è¯·ç»Ÿè®¡éƒ¨åˆ† -->
                <section id="section-invites" class="admin-section">
                    <div class="section-header">
                        <h2>ğŸ é‚€è¯·ç»Ÿè®¡</h2>
                        <div class="header-actions">
                            <button class="btn-primary" onclick="exportInviteStats()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="action-item">
                            <div class="action-icon">ğŸ”—</div>
                            <div class="action-info">
                                <h4 id="totalInvites">0</h4>
                                <p>æ€»é‚€è¯·æ•°</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">âœ…</div>
                            <div class="action-info">
                                <h4 id="successfulInvites">0</h4>
                                <p>æˆåŠŸé‚€è¯·</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">ğŸ</div>
                            <div class="action-info">
                                <h4 id="totalRewards">Â¥0</h4>
                                <p>ç´¯è®¡è¿”åˆ©</p>
                            </div>
                        </div>
                    </div>

                    <div class="invite-charts">
                        <div class="chart-container">
                            <h3>ğŸ“ˆ è¿‘30å¤©é‚€è¯·è¶‹åŠ¿</h3>
                            <canvas id="inviteTrendChart"></canvas>
                        </div>
                        <div class="chart-container chart-small">
                            <h3>ğŸ† é‚€è¯·æ’è¡Œæ¦œ</h3>
                            <div id="inviteRankList" class="rank-list">
                                <div class="loading-placeholder">åŠ è½½ä¸­...</div>
                            </div>
                        </div>
                    </div>

                    <div class="section-header" style="margin-top: 30px;">
                        <h3>é‚€è¯·è®°å½•</h3>
                    </div>
                    <table class="admin-table" id="invitesTable">
                        <thead>
                            <tr>
                                <th>é‚€è¯·äºº</th>
                                <th>è¢«é‚€è¯·äºº</th>
                                <th>é‚€è¯·ç </th>
                                <th>å¥–åŠ±ç±»å‹</th>
                                <th>å¥–åŠ±é‡‘é¢</th>
                                <th>å¾…å®¡æ ¸</th>
                                <th>çŠ¶æ€</th>
                                <th>é‚€è¯·æ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="invitesTableBody">
                            <tr>
                                <td colspan="9" class="loading-cell">åŠ è½½ä¸­...</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- ç”¨æˆ·ç®¡ç†éƒ¨åˆ† -->
                <section id="section-users" class="admin-section">
                    <div class="section-header">
                        <h2>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <input type="text" id="userSearch" placeholder="ğŸ” æœç´¢ç”¨æˆ·å/TG ID..."
                                    onkeyup="searchUsers()" autocomplete="off" autocorrect="off" autocapitalize="off"
                                    spellcheck="false" data-form-type="other">
                            </div>
                            <select id="userRoleFilter" onchange="loadUsers()">
                                <option value="">å…¨éƒ¨è§’è‰²</option>
                                <option value="admin">ç®¡ç†å‘˜</option>
                                <option value="user">æ™®é€šç”¨æˆ·</option>
                            </select>
                            <select id="userStatusFilter" onchange="loadUsers()">
                                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                <option value="whitelist">ç™½åå•</option>
                                <option value="subscribed">å·²è®¢é˜…</option>
                                <option value="normal">æœªè®¢é˜…</option>
                                <option value="banned">å·²ç¦ç”¨</option>
                            </select>
                            <div class="dropdown" style="position:relative;display:inline-block;">
                                <button class="export-btn" onclick="toggleExportMenu(this)" title="å¯¼å‡ºæ•°æ®">ğŸ“¤ å¯¼å‡º</button>
                                <div class="dropdown-menu" style="display:none;position:absolute;right:0;top:100%;background:#fff;border-radius:8px;box-shadow:0 4px 16px rgba(0,0,0,.15);min-width:160px;z-index:100;overflow:hidden;margin-top:4px;">
                                    <a href="#" onclick="exportData('users');return false;" style="display:block;padding:10px 16px;color:#333;text-decoration:none;font-size:13px;white-space:nowrap;">ğŸ‘¥ å¯¼å‡ºç”¨æˆ·åˆ—è¡¨</a>
                                    <a href="#" onclick="exportData('orders');return false;" style="display:block;padding:10px 16px;color:#333;text-decoration:none;font-size:13px;border-top:1px solid #f0f0f0;white-space:nowrap;">ğŸ§¾ å¯¼å‡ºè®¢å•æ•°æ®</a>
                                    <a href="#" onclick="exportData('subscriptions');return false;" style="display:block;padding:10px 16px;color:#333;text-decoration:none;font-size:13px;border-top:1px solid #f0f0f0;white-space:nowrap;">ğŸ’ å¯¼å‡ºè®¢é˜…è®°å½•</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="action-item">
                            <div class="action-icon">ğŸ‘¥</div>
                            <div class="action-info">
                                <h4 id="totalUsers">0</h4>
                                <p>æ€»ç”¨æˆ·æ•°</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">ğŸ‘‘</div>
                            <div class="action-info">
                                <h4 id="adminUsers">0</h4>
                                <p>ç®¡ç†å‘˜</p>
                            </div>
                        </div>
                        <div class="action-item">
                            <div class="action-icon">âœ¨</div>
                            <div class="action-info">
                                <h4 id="subscribedUsers">0</h4>
                                <p>è®¢é˜…ç”¨æˆ·</p>
                            </div>
                        </div>
                    </div>

                    <div class="batch-actions" id="userBatchActions" style="display:none;">
                        <span class="batch-info">å·²é€‰æ‹© <strong id="selectedUserCount">0</strong> æ¡</span>
                        <button class="batch-btn" onclick="batchGiftSubscription()" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;">ğŸ æ‰¹é‡èµ é€è®¢é˜…</button>
                        <button class="batch-btn" onclick="batchSetWhitelist()" style="background:linear-gradient(135deg,#06b6d4 0%,#0891b2 100%);color:#fff;">ğŸ‘‘ æ‰¹é‡è®¾ç™½åå•</button>
                        <button class="batch-btn warning" onclick="batchBanUsers()">â›” æ‰¹é‡ç¦ç”¨</button>
                        <button class="batch-btn success" onclick="batchUnbanUsers()">âœ… æ‰¹é‡è§£ç¦</button>
                        <button class="batch-btn danger" onclick="batchDeleteUsers()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
                    </div>

                    <table class="admin-table" id="usersTable">
                        <thead>
                            <tr>
                                <th style="width:40px;"><input type="checkbox" id="selectAllUsers" onchange="toggleSelectAllUsers()"></th>
                                <th class="hide-mobile">ç”¨æˆ·ID</th>
                                <th>ç”¨æˆ·å</th>
                                <th class="hide-mobile">Telegram ID</th>
                                <th>è§’è‰²</th>
                                <th>è®¢é˜…çŠ¶æ€</th>
                                <th class="hide-mobile" id="coinColumnHeader">ç§¯åˆ†</th>
                                <th class="hide-mobile">åˆ°æœŸæ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr>
                                <td colspan="9" class="loading-cell">åŠ è½½ä¸­...</td>
                            </tr>
                        </tbody>
                    </table>
                </section>



                <!-- å¥—é¤é…ç½®éƒ¨åˆ† -->
                <section id="section-plans" class="admin-section">
                    <div class="section-header">
                        <h2>ğŸ“¦ å¥—é¤é…ç½®</h2>
                        <div class="section-actions">
                            <button class="btn-primary" onclick="addNewPlan()">
                                <span>â•</span> æ·»åŠ å¥—é¤
                            </button>
                        </div>
                    </div>

                    <!-- é»˜è®¤æƒç›Šé…ç½®ï¼ˆæœªè®¢é˜…ç”¨æˆ·å’Œç™½åå•ç”¨æˆ·ï¼‰ -->
                    <div class="default-benefits-card">
                        <div class="default-benefits-header">
                            <h3>ğŸ é»˜è®¤æƒç›Šé…ç½®</h3>
                            <p class="default-benefits-tip">é…ç½®æœªè®¢é˜…ç”¨æˆ·å’Œç™½åå•ç”¨æˆ·åœ¨"æˆ‘çš„è®¢é˜…"é¡µé¢æ˜¾ç¤ºçš„æƒç›Šï¼ˆæœ€å¤š8ä¸ªï¼‰</p>
                        </div>

                        <!-- æœªè®¢é˜…ç”¨æˆ·æƒç›Š - æŠ˜å å¡ç‰‡ -->
                        <div class="benefit-collapsible-card" data-benefit-type="unsubscribed">
                            <div class="benefit-collapsible-header" onclick="toggleBenefitCard('unsubscribed')">
                                <div class="benefit-header-left">
                                    <span class="collapse-icon">â–¶</span>
                                    <span class="benefit-card-title">ğŸ‘¤ æœªè®¢é˜…ç”¨æˆ·æƒç›Š</span>
                                </div>
                                <span class="benefit-count-badge" id="unsubscribedBenefitCount">0 é¡¹</span>
                            </div>
                            <div class="benefit-collapsible-body">
                                <div class="benefits-config-list" id="unsubscribedBenefitsList"></div>
                                <button class="btn-secondary btn-xs" onclick="addDefaultBenefit('unsubscribed')">â• æ·»åŠ </button>
                            </div>
                        </div>

                        <!-- ç™½åå•ç”¨æˆ·æƒç›Š - æŠ˜å å¡ç‰‡ -->
                        <div class="benefit-collapsible-card" data-benefit-type="whitelist">
                            <div class="benefit-collapsible-header" onclick="toggleBenefitCard('whitelist')">
                                <div class="benefit-header-left">
                                    <span class="collapse-icon">â–¶</span>
                                    <span class="benefit-card-title">ğŸ‘‘ ç™½åå•ç”¨æˆ·æƒç›Š</span>
                                </div>
                                <span class="benefit-count-badge" id="whitelistBenefitCount">0 é¡¹</span>
                            </div>
                            <div class="benefit-collapsible-body">
                                <div class="benefits-config-list" id="whitelistBenefitsList"></div>
                                <button class="btn-secondary btn-xs" onclick="addDefaultBenefit('whitelist')">â• æ·»åŠ </button>
                            </div>
                        </div>

                        <div class="default-benefits-actions">
                            <button class="btn-primary btn-sm" onclick="saveDefaultBenefits()">
                                <span>ğŸ’¾</span> ä¿å­˜é»˜è®¤æƒç›Š
                            </button>
                        </div>
                    </div>

                    <div class="plans-config-container">
                        <div class="plans-config-tips">
                            <p>ğŸ’¡ é…ç½®å¯è´­ä¹°çš„è®¢é˜…å¥—é¤ï¼Œè®¾ç½®å¥—é¤åç§°ã€æ—¶é•¿ã€ä»·æ ¼å’Œè®¢é˜…æƒç›Šã€‚ä¿å­˜åç«‹å³åœ¨å‰ç«¯ç”Ÿæ•ˆã€‚</p>
                        </div>

                        <div class="plans-config-list" id="plansConfigList">
                            <!-- å¥—é¤åˆ—è¡¨å°†é€šè¿‡JSåŠ è½½ï¼Œæ¯ä¸ªå¥—é¤éƒ½æ˜¯å¯æŠ˜å å¡ç‰‡ -->
                            <div class="loading-placeholder">åŠ è½½ä¸­...</div>
                        </div>

                        <div class="plans-config-footer">
                            <button class="btn-primary btn-lg" onclick="savePlansConfig()">
                                <span>ğŸ’¾</span> ä¿å­˜æ‰€æœ‰å¥—é¤
                            </button>
                            <span class="save-hint">ä¿å­˜åç«‹å³åœ¨å‰ç«¯è´­ä¹°é¡µé¢ç”Ÿæ•ˆ</span>
                        </div>
                    </div>
                </section>

                <!-- æ·»åŠ /ç¼–è¾‘çº¿è·¯å¼¹çª— -->
                <div class="modal" id="lineModal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="lineModalTitle">æ·»åŠ çº¿è·¯</h3>
                            <button class="modal-close" onclick="closeLineModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="editLineId">
                            <div class="form-group">
                                <label for="lineName">çº¿è·¯åç§° *</label>
                                <input type="text" id="lineName" placeholder="å¦‚ï¼šä¸»çº¿è·¯ã€å¤‡ç”¨çº¿è·¯" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="lineServerUrl">æœåŠ¡å™¨åœ°å€ *</label>
                                <input type="text" id="lineServerUrl" placeholder="å¦‚ï¼šemby.example.com"
                                    class="form-input">
                                <span class="form-hint">ä¸å¸¦åè®®å‰ç¼€(http/https)</span>
                            </div>
                            <div class="form-row">
                                <div class="form-group half">
                                    <label for="linePort">ç«¯å£</label>
                                    <input type="number" id="linePort" value="8096" class="form-input">
                                </div>
                                <div class="form-group half">
                                    <label for="lineHttps">ä½¿ç”¨HTTPS</label>
                                    <select id="lineHttps" class="form-input">
                                        <option value="false">å¦ (HTTP)</option>
                                        <option value="true">æ˜¯ (HTTPS)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="lineAccessLevel">è®¿é—®çº§åˆ« *</label>
                                <select id="lineAccessLevel" class="form-input">
                                    <option value="whitelist">ç™½åå•ç”¨æˆ·ä¸“å±</option>
                                    <option value="subscriber">è®¢é˜…ç”¨æˆ·å¯è§</option>
                                </select>
                                <span class="form-hint">ç™½åå•ç”¨æˆ·å¯ä»¥çœ‹åˆ°æ‰€æœ‰çº¿è·¯ï¼Œè®¢é˜…ç”¨æˆ·åªèƒ½çœ‹åˆ°"è®¢é˜…ç”¨æˆ·å¯è§"çš„çº¿è·¯</span>
                            </div>
                            <div class="form-group">
                                <label for="lineDescription">çº¿è·¯æè¿°</label>
                                <textarea id="lineDescription" placeholder="å¦‚ï¼šé¦™æ¸¯èŠ‚ç‚¹ï¼Œé€Ÿåº¦å¿«" class="form-input"
                                    rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="lineSortOrder">æ’åºé¡ºåº</label>
                                <input type="number" id="lineSortOrder" value="0" class="form-input">
                                <span class="form-hint">æ•°å­—è¶Šå°è¶Šé å‰</span>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="closeLineModal()">å–æ¶ˆ</button>
                            <button class="btn-primary" onclick="saveLine()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- çŸ¥è¯†åº“ç®¡ç†éƒ¨åˆ† -->
                <section id="section-knowledge" class="admin-section">
                    <div class="section-header">
                        <h2>ğŸ“š çŸ¥è¯†åº“ç®¡ç†</h2>
                        <div class="header-actions">
                            <button class="btn-primary" onclick="openAddKnowledgeModal()">â• æ·»åŠ æ¡ç›®</button>
                            <button class="btn-secondary" onclick="openCategoryModal()">ğŸ·ï¸ åˆ†ç±»ç®¡ç†</button>
                        </div>
                    </div>

                    <!-- ç­›é€‰æ  -->
                    <div class="filter-bar">
                        <div class="search-box">
                            <input type="text" id="knowledgeSearch" placeholder="ğŸ” æœç´¢é—®é¢˜..." onkeyup="searchKnowledge()"
                                autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                                data-form-type="other">
                        </div>
                        <select id="knowledgeCategoryFilter" onchange="filterKnowledgeByCategory()">
                            <option value="">å…¨éƒ¨åˆ†ç±»</option>
                        </select>
                    </div>

                    <!-- çŸ¥è¯†åº“åˆ—è¡¨ -->
                    <div class="knowledge-list" id="knowledgeList">
                        <div class="empty-state">
                            <span class="empty-icon">ğŸ“š</span>
                            <p>æš‚æ— çŸ¥è¯†åº“æ¡ç›®</p>
                            <button class="btn-primary" onclick="openAddKnowledgeModal()">æ·»åŠ ç¬¬ä¸€æ¡</button>
                        </div>
                    </div>
                </section>

                <!-- æ·»åŠ /ç¼–è¾‘çŸ¥è¯†åº“æ¡ç›®å¼¹çª— -->
                <div id="knowledgeModal" class="modal" style="display: none;">
                    <div class="modal-content" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3 id="knowledgeModalTitle">æ·»åŠ çŸ¥è¯†åº“æ¡ç›®</h3>
                            <button class="modal-close" onclick="closeKnowledgeModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="knowledgeItemId">
                            <div class="form-group">
                                <label>åˆ†ç±»</label>
                                <select id="knowledgeCategory" class="form-input">
                                    <option value="account">è´¦æˆ·ç›¸å…³</option>
                                    <option value="request">æ±‚ç‰‡ç›¸å…³</option>
                                    <option value="playback">æ’­æ”¾é—®é¢˜</option>
                                    <option value="payment">æ”¯ä»˜é—®é¢˜</option>
                                    <option value="other">å…¶ä»–</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>é—®é¢˜ <span class="required">*</span></label>
                                <input type="text" id="knowledgeQuestion" class="form-input" placeholder="è¯·è¾“å…¥é—®é¢˜">
                            </div>
                            <div class="form-group">
                                <label>å›ç­” <span class="required">*</span> <span
                                        style="font-size: 12px; color: #64748b; font-weight: normal;">ï¼ˆä»…æ”¯æŒ HTML
                                        æ ¼å¼ï¼‰</span></label>
                                <textarea id="knowledgeAnswer" class="form-input" rows="6"
                                    placeholder="è¯·è¾“å…¥ï¼Œä¾‹å¦‚ï¼š&#10;&lt;p&gt;è¿™æ˜¯ä¸€æ®µæ–‡å­—&lt;/p&gt;&#10;&lt;ul&gt;&#10;  &lt;li&gt;åˆ—è¡¨é¡¹1&lt;/li&gt;&#10;  &lt;li&gt;åˆ—è¡¨é¡¹2&lt;/li&gt;&#10;&lt;/ul&gt;"></textarea>
                                <div style="font-size: 12px; color: #94a3b8; margin-top: 6px;">
                                    å¸¸ç”¨æ ‡ç­¾ï¼š<code>&lt;p&gt;</code> æ®µè½ã€<code>&lt;ul&gt;&lt;li&gt;</code>
                                    æ— åºåˆ—è¡¨ã€<code>&lt;ol&gt;&lt;li&gt;</code> æœ‰åºåˆ—è¡¨ã€<code>&lt;b&gt;</code> åŠ ç²—
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="closeKnowledgeModal()">å–æ¶ˆ</button>
                            <button class="btn-primary" onclick="saveKnowledgeItem()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- åˆ†ç±»ç®¡ç†å¼¹çª— -->
                <div id="categoryModal" class="modal" style="display: none;">
                    <div class="modal-content" style="max-width: 500px;">
                        <div class="modal-header">
                            <h3>åˆ†ç±»ç®¡ç†</h3>
                            <button class="modal-close" onclick="closeCategoryModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div id="categoryList" class="category-list">
                                <!-- åˆ†ç±»åˆ—è¡¨åŠ¨æ€åŠ è½½ -->
                            </div>
                            <div class="add-category-form" style="margin-top: 15px; display: flex; gap: 10px;">
                                <input type="text" id="newCategoryId" class="form-input" placeholder="åˆ†ç±»IDï¼ˆè‹±æ–‡ï¼‰"
                                    style="flex: 1;">
                                <input type="text" id="newCategoryName" class="form-input" placeholder="åˆ†ç±»åç§°"
                                    style="flex: 1;">
                                <button class="btn-primary" onclick="addCategory()">æ·»åŠ </button>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="closeCategoryModal()">å…³é—­</button>
                            <button class="btn-primary" onclick="saveCategories()">ä¿å­˜åˆ†ç±»</button>
                        </div>
                    </div>
                </div>

                <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
                <div id="deleteKnowledgeModal" class="modal" style="display: none;">
                    <div class="modal-content" style="max-width: 400px;">
                        <div class="modal-header">
                            <h3>ç¡®è®¤åˆ é™¤</h3>
                            <button class="modal-close" onclick="closeDeleteKnowledgeModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p>ç¡®å®šè¦åˆ é™¤è¿™æ¡çŸ¥è¯†åº“æ¡ç›®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚</p>
                            <input type="hidden" id="deleteKnowledgeId">
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="closeDeleteKnowledgeModal()">å–æ¶ˆ</button>
                            <button class="btn-danger" onclick="confirmDeleteKnowledge()">ç¡®è®¤åˆ é™¤</button>
                        </div>
                    </div>
                </div>

                <!-- ç³»ç»Ÿè®¾ç½®éƒ¨åˆ† -->
                <section id="section-settings" class="admin-section">
                    <div class="section-header">
                        <h2>âš™ï¸ ç³»ç»Ÿè®¾ç½®</h2>
                    </div>

                    <!-- è®¾ç½®åˆ†ç±»æ ‡ç­¾å¯¼èˆª -->
                    <div class="settings-tabs" id="settingsTabs">
                        <button class="settings-tab active" data-group="basic" onclick="switchSettingsGroup('basic', this)">
                            <span>ğŸ”Œ</span> åŸºç¡€æœåŠ¡
                        </button>
                        <button class="settings-tab" data-group="business" onclick="switchSettingsGroup('business', this)">
                            <span>ğŸ’°</span> è¿è¥ç®¡ç†
                        </button>
                        <button class="settings-tab" data-group="site" onclick="switchSettingsGroup('site', this)">
                            <span>ğŸ¨</span> ç«™ç‚¹å¤–è§‚
                        </button>
                        <button class="settings-tab" data-group="advanced" onclick="switchSettingsGroup('advanced', this)">
                            <span>ğŸ”§</span> è¿›é˜¶è®¾ç½®
                        </button>
                    </div>

                    <!-- ==================== åŸºç¡€æœåŠ¡ - æ ¸å¿ƒå¯¹æ¥ ==================== -->
                    <!-- Emby æœåŠ¡å™¨é…ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="basic">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ“º Emby æœåŠ¡å™¨é…ç½®</h3>
                            </div>
                            <span class="status-badge" id="embyStatus">æœªé…ç½®</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½® Emby æœåŠ¡å™¨è¿æ¥ï¼Œç”¨äºæ£€æŸ¥åª’ä½“åº“å’Œæ¥æ”¶å…¥åº“é€šçŸ¥ã€‚</p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label for="embyUrl">Emby æœåŠ¡å™¨åœ°å€</label>
                                    <input type="text" id="embyUrl" placeholder="http://127.0.0.1:8096"
                                        class="form-input">
                                    <span class="form-hint">Emby æœåŠ¡å™¨ Web åœ°å€ï¼Œä¸å¸¦æœ«å°¾æ–œæ </span>
                                </div>

                                <div class="form-group">
                                    <label for="embyApiKey">API Key</label>
                                    <input type="text" id="embyApiKey" placeholder="è¯·è¾“å…¥ Emby API Key"
                                        class="form-input">
                                    <span class="form-hint">åœ¨ Emby æ§åˆ¶å° â†’ è®¾ç½® â†’ API å¯†é’¥ ä¸­ç”Ÿæˆ</span>
                                </div>

                                <div class="form-group">
                                    <label for="embyWebhookSecret">Webhook å¯†é’¥ï¼ˆå¯é€‰ï¼‰</label>
                                    <input type="text" id="embyWebhookSecret" placeholder="ç•™ç©ºåˆ™ä¸éªŒè¯ Webhook å¯†é’¥"
                                        class="form-input">
                                    <span class="form-hint">ç”¨äºéªŒè¯ Emby Webhook è¯·æ±‚çš„åˆæ³•æ€§</span>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveEmbyConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-secondary" onclick="testEmbyConfig()">
                                    <span>ğŸ”§</span> æµ‹è¯•è¿æ¥
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ é…ç½®è¯´æ˜</h4>
                                <ul>
                                    <li>Emby ç”¨äºæ£€æŸ¥åª’ä½“åº“æ˜¯å¦å·²å­˜åœ¨æ‰€æ±‚å½±ç‰‡</li>
                                    <li>é…ç½® Webhook å¯åœ¨å…¥åº“æ—¶è‡ªåŠ¨æ›´æ–°æ±‚ç‰‡çŠ¶æ€</li>
                                    <li>Webhook URL: <code>ä½ çš„åŸŸå/api/webhook/emby</code></li>
                                    <li>é…ç½®ä¿å­˜å<strong>æ— éœ€é‡å¯æœåŠ¡</strong>ï¼Œç«‹å³ç”Ÿæ•ˆ</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Telegram BOTé…ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="basic">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ“± Telegram BOTé…ç½®</h3>
                            </div>
                            <span class="status-badge" id="telegramStatus">æœªé…ç½®</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½® Telegram Bot ç”¨äºå‘é€æ±‚ç‰‡é€šçŸ¥å’ŒçŠ¶æ€æ›´æ–°ã€‚</p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label for="tgBotToken">Bot Token</label>
                                    <input type="text" id="tgBotToken"
                                        placeholder="123456789:ABCdefGhIjKlmNoPqRsTuVwXyZ" class="form-input">
                                    <span class="form-hint">ä» @BotFather è·å–çš„ Bot Token</span>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="tgChatId">é€šçŸ¥ç¾¤ç»„ Chat ID</label>
                                        <input type="text" id="tgChatId" placeholder="-1001234567890"
                                            class="form-input">
                                        <span class="form-hint">æ±‚ç‰‡é€šçŸ¥å‘é€åˆ°çš„ç¾¤ç»„ ID</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="tgGroupId">å…¥åº“é€šçŸ¥ç¾¤ç»„ IDï¼ˆå¯é€‰ï¼‰</label>
                                        <input type="text" id="tgGroupId" placeholder="ç•™ç©ºåˆ™ä½¿ç”¨ä¸Šæ–¹ Chat ID"
                                            class="form-input">
                                        <span class="form-hint">å…¥åº“é€šçŸ¥ä¸“ç”¨ç¾¤ç»„ï¼Œç•™ç©ºåŒä¸Š</span>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="tgGiftDays">èµ é€å¤©æ•°ï¼ˆ/kk å‘½ä»¤ï¼‰</label>
                                        <input type="number" id="tgGiftDays" placeholder="30" min="1" max="365"
                                            class="form-input" style="width: 150px;">
                                        <span class="form-hint">ç®¡ç†å‘˜ä½¿ç”¨ /kk å‘½ä»¤èµ é€çš„é»˜è®¤å¤©æ•°</span>
                                    </div>
                                    <div class="form-group">
                                        <label for="tgMaxStreams">æœ€å¤§åŒæ—¶æ’­æ”¾æ•°</label>
                                        <input type="number" id="tgMaxStreams" placeholder="0" min="0" max="100"
                                            class="form-input" style="width: 150px;">
                                        <span class="form-hint">æ¯ä¸ªç”¨æˆ·æœ€å¤§åŒæ—¶æ’­æ”¾æµæ•°ï¼Œ0 ä¸ºä¸é™åˆ¶</span>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="tgBotAdmins">BOT ç®¡ç†å‘˜</label>
                                    <input type="text" id="tgBotAdmins" placeholder="123456789, 987654321"
                                        class="form-input">
                                    <span class="form-hint">å¯ä»¥ä½¿ç”¨ /kk å‘½ä»¤çš„ Telegram IDï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼Œç•™ç©ºåˆ™æ‰€æœ‰ç¾¤æˆå‘˜å¯ç”¨</span>
                                </div>

                                <div class="form-group">
                                    <label for="tgBotPhoto">æ¬¢è¿å›¾ç‰‡ URL</label>
                                    <input type="text" id="tgBotPhoto" placeholder="https://example.com/welcome.jpg"
                                        class="form-input">
                                    <span class="form-hint">/start å‘½ä»¤æ˜¾ç¤ºçš„æ¬¢è¿å›¾ç‰‡ï¼Œæ”¯æŒ JPG/PNGï¼Œå»ºè®®å°ºå¯¸ 800x400ï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤å›¾ç‰‡</span>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveTelegramConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-secondary" onclick="setTelegramWebhook()">
                                    <span>ğŸ”—</span> è®¾ç½® Webhook
                                </button>
                                <button class="btn-secondary" onclick="testTelegramConfig()">
                                    <span>ğŸ”§</span> æµ‹è¯•è¿æ¥
                                </button>
                                <button class="btn-secondary" onclick="registerTelegramCommands()">
                                    <span>ğŸ“‹</span> æ³¨å†Œå‘½ä»¤èœå•
                                </button>
                            </div>

                            <!-- æ˜¾ç¤ºå½“å‰çŠ¶æ€ -->
                            <div
                                style="margin-top: 10px; padding: 8px 12px; background: var(--card-bg); border-radius: 6px; border: 1px solid var(--border-color);">
                                <span style="color: var(--text-secondary); font-size: 13px;">WebhookçŠ¶æ€ï¼š</span>
                                <span id="telegramModeDisplay" class="badge badge-secondary">æœªé…ç½®</span>
                                <span style="color: var(--text-secondary); font-size: 12px; margin-left: 10px;">
                                    ğŸ’¡ éœ€è¦ HTTPS åŸŸåæ‰èƒ½ä½¿ç”¨ Webhook
                                </span>
                            </div>

                            <!-- é€šçŸ¥æ¨¡æ¿é…ç½® -->
                            <div class="settings-divider"
                                style="margin: 20px 0; border-top: 1px dashed var(--border-color);"></div>
                            <h4 style="margin-bottom: 15px; color: var(--text-primary);">ğŸ“ é€šçŸ¥æ¨¡æ¿é…ç½®</h4>
                            <p class="settings-desc" style="margin-bottom: 15px;">è‡ªå®šä¹‰æ±‚ç‰‡é€šçŸ¥å’Œå…¥åº“é€šçŸ¥çš„æ¶ˆæ¯æ ¼å¼ï¼Œç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤æ¨¡æ¿ã€‚æ”¯æŒHTMLæ ¼å¼ã€‚
                            </p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label for="tgRequestTemplate">æ±‚ç‰‡é€šçŸ¥æ¨¡æ¿</label>
                                    <textarea id="tgRequestTemplate" class="form-input" rows="8"
                                        placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤æ¨¡æ¿ï¼Œå¯ç”¨å˜é‡ï¼š{user} {admin} {title} {year} {category} {tmdb_id} {tmdb_url} {time} {scope} {overview}"></textarea>
                                    <span class="form-hint">ç”¨æˆ·å‘èµ·æ±‚ç‰‡æ—¶å‘é€çš„é€šçŸ¥ã€‚å¯ç”¨å˜é‡è§ä¸‹æ–¹è¯´æ˜ã€‚</span>
                                </div>

                                <div class="form-group">
                                    <label for="tgCompletionTemplate">å…¥åº“é€šçŸ¥æ¨¡æ¿</label>
                                    <textarea id="tgCompletionTemplate" class="form-input" rows="8"
                                        placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤æ¨¡æ¿ï¼Œå¯ç”¨å˜é‡ï¼š{user} {title} {year} {category} {rating} {quality} {size} {file_count}"></textarea>
                                    <span class="form-hint">å½±ç‰‡å…¥åº“å®Œæˆæ—¶å‘é€çš„é€šçŸ¥ã€‚å¯ç”¨å˜é‡è§ä¸‹æ–¹è¯´æ˜ã€‚</span>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveTelegramTemplates()">
                                    <span>ğŸ’¾</span> ä¿å­˜æ¨¡æ¿
                                </button>
                                <button class="btn-secondary" onclick="resetTelegramTemplates()">
                                    <span>ğŸ”„</span> æ¢å¤é»˜è®¤
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ é…ç½®è¯´æ˜</h4>
                                <ul>
                                    <li>åœ¨ Telegram æœç´¢ @BotFather åˆ›å»ºæœºå™¨äººè·å– Token</li>
                                    <li>ä½¿ç”¨ @userinfobot è·å–ç¾¤ç»„ Chat ID</li>
                                    <li>ç¡®ä¿æœºå™¨äººå·²æ·»åŠ åˆ°ç¾¤ç»„å¹¶æœ‰å‘é€æ¶ˆæ¯æƒé™</li>
                                    <li>æµ‹è¯•è¿æ¥ä¼šå‘é€ä¸€æ¡æµ‹è¯•æ¶ˆæ¯åˆ°ç¾¤ç»„</li>
                                </ul>
                                <h4 style="margin-top: 15px;">ğŸ“ æ¨¡æ¿å˜é‡è¯´æ˜</h4>
                                <ul>
                                    <li><code>{user}</code> - ç”¨æˆ·åï¼ˆå¸¦@é“¾æ¥ï¼‰</li>
                                    <li><code>{admin}</code> - ç®¡ç†å‘˜æé†’ï¼ˆä»…æ±‚ç‰‡é€šçŸ¥ï¼‰</li>
                                    <li><code>{title}</code> - å½±ç‰‡åç§°</li>
                                    <li><code>{year}</code> - ä¸Šæ˜ å¹´ä»½</li>
                                    <li><code>{category}</code> - åˆ†ç±»ï¼ˆç”µå½±/å›½äº§å‰§/ç¾å‰§/æ—¥éŸ©å‰§ç­‰ï¼‰</li>
                                    <li><code>{tmdb_id}</code> - TMDB IDï¼ˆä»…æ±‚ç‰‡é€šçŸ¥ï¼‰</li>
                                    <li><code>{tmdb_url}</code> - TMDBé“¾æ¥ï¼ˆä»…æ±‚ç‰‡é€šçŸ¥ï¼‰</li>
                                    <li><code>{time}</code> - æ—¶é—´ï¼ˆä»…æ±‚ç‰‡é€šçŸ¥ï¼‰</li>
                                    <li><code>{scope}</code> - æ±‚ç‰‡èŒƒå›´ï¼ˆä»…å‰§é›†æ±‚ç‰‡é€šçŸ¥ï¼‰</li>
                                    <li><code>{overview}</code> - ç®€ä»‹ï¼ˆä»…æ±‚ç‰‡é€šçŸ¥ï¼‰</li>
                                    <li><code>{rating}</code> - è¯„åˆ†ï¼ˆä»…å…¥åº“é€šçŸ¥ï¼‰</li>
                                    <li><code>{quality}</code> - è´¨é‡ï¼ˆä»…å…¥åº“é€šçŸ¥ï¼‰</li>
                                    <li><code>{size}</code> - å¤§å°ï¼ˆä»…å…¥åº“é€šçŸ¥ï¼‰</li>
                                    <li><code>{file_count}</code> - æ–‡ä»¶æ•°é‡ï¼ˆä»…å…¥åº“é€šçŸ¥ï¼‰</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- TMDB API é…ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="basic">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ¬ TMDB API é…ç½®</h3>
                            </div>
                            <span class="status-badge" id="tmdbStatus">æœªé…ç½®</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½® TMDB API ç”¨äºæœç´¢å½±ç‰‡ä¿¡æ¯ã€è·å–æµ·æŠ¥å’Œè¯¦æƒ…ã€‚</p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label for="tmdbApiKey">TMDB API Key</label>
                                    <input type="text" id="tmdbApiKey" placeholder="è¯·è¾“å…¥ TMDB API Key"
                                        class="form-input">
                                    <span class="form-hint">ä» <a href="https://www.themoviedb.org/settings/api"
                                            target="_blank">TMDB å®˜ç½‘</a> è·å– API Key</span>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveTmdbConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-secondary" onclick="testTmdbConfig()">
                                    <span>ğŸ”§</span> æµ‹è¯•è¿æ¥
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ é…ç½®è¯´æ˜</h4>
                                <ul>
                                    <li>è®¿é—® <a href="https://www.themoviedb.org/signup" target="_blank">TMDB å®˜ç½‘</a> æ³¨å†Œè´¦å·
                                    </li>
                                    <li>åœ¨è®¾ç½® â†’ API ä¸­ç”³è¯· API Key</li>
                                    <li>TMDB ç”¨äºæœç´¢å½±ç‰‡ä¿¡æ¯ã€è·å–æµ·æŠ¥å’Œè¯¦ç»†ä»‹ç»</li>
                                    <li>æµ·æŠ¥å›¾ç‰‡è‡ªåŠ¨é€šè¿‡æœåŠ¡å™¨ä»£ç†åŠ è½½ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„ä»£ç†é…ç½®ï¼‰</li>
                                    <li>é…ç½®ä¿å­˜å<strong>æ— éœ€é‡å¯æœåŠ¡</strong>ï¼Œç«‹å³ç”Ÿæ•ˆ</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- é‚®ä»¶ SMTP é…ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="basic">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ“§ é‚®ä»¶æœåŠ¡é…ç½®</h3>
                            </div>
                            <span class="status-badge" id="emailStatus">æœªé…ç½®</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½® SMTP é‚®ä»¶æœåŠ¡ï¼Œç”¨äºé‚®ç®±ç»‘å®šéªŒè¯ã€å¯†ç æ‰¾å›ã€è¥é”€é‚®ä»¶ç¾¤å‘ç­‰åŠŸèƒ½ã€‚</p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="emailEnabled" onchange="toggleEmailFields()">
                                        <span>å¯ç”¨é‚®ä»¶åŠŸèƒ½</span>
                                    </label>
                                    <span class="form-hint">å¼€å¯åç”¨æˆ·å¯ç»‘å®šé‚®ç®±ã€é€šè¿‡é‚®ç®±æ‰¾å›å¯†ç </span>
                                </div>

                                <div id="emailConfigFields">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="smtpHost">SMTP æœåŠ¡å™¨</label>
                                            <input type="text" id="smtpHost" placeholder="smtp.qq.com" class="form-input">
                                            <span class="form-hint">å¦‚ smtp.qq.com / smtp.163.com / smtp.gmail.com</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="smtpPort">ç«¯å£</label>
                                            <input type="number" id="smtpPort" placeholder="465" class="form-input" value="465">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="smtpSsl" checked>
                                            <span>ä½¿ç”¨ SSL åŠ å¯†</span>
                                        </label>
                                        <span class="form-hint">ç«¯å£465é€šå¸¸ä½¿ç”¨SSLï¼Œç«¯å£587é€šå¸¸ä½¿ç”¨STARTTLS</span>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="smtpUser">å‘ä»¶é‚®ç®±</label>
                                            <input type="text" id="smtpUser" placeholder="your@qq.com" class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="smtpPassword">å¯†ç /æˆæƒç </label>
                                            <input type="password" id="smtpPassword" placeholder="SMTPæˆæƒç " class="form-input">
                                            <span class="form-hint">QQé‚®ç®±/163é‚®ç®±éœ€ä½¿ç”¨æˆæƒç è€Œéç™»å½•å¯†ç </span>
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="emailSenderName">å‘ä»¶äººåç§°</label>
                                            <input type="text" id="emailSenderName" placeholder="Embyç®¡ç†ç³»ç»Ÿ" class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="requireEmailRegister">
                                                <span>æ³¨å†Œæ—¶å¼ºåˆ¶ç»‘å®šé‚®ç®±</span>
                                            </label>
                                            <span class="form-hint">å¼€å¯åç”¨æˆ·æ³¨å†Œæ—¶å¿…é¡»å¡«å†™é‚®ç®±</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveEmailConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-secondary" onclick="testEmailConfig()">
                                    <span>ğŸ“¨</span> å‘é€æµ‹è¯•é‚®ä»¶
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ é…ç½®è¯´æ˜</h4>
                                <ul>
                                    <li>QQé‚®ç®±: è®¾ç½® â†’ è´¦æˆ· â†’ å¼€å¯SMTP â†’ ç”Ÿæˆæˆæƒç </li>
                                    <li>163é‚®ç®±: è®¾ç½® â†’ POP3/SMTP â†’ å¼€å¯SMTP â†’ è®¾ç½®æˆæƒç </li>
                                    <li>Gmail: éœ€å¼€å¯ä¸¤æ­¥éªŒè¯åç”Ÿæˆåº”ç”¨ä¸“ç”¨å¯†ç </li>
                                    <li>å¯ç”¨åç”¨æˆ·å¯åœ¨ä¸ªäººä¸­å¿ƒç»‘å®šé‚®ç®±ï¼Œå¿˜è®°å¯†ç å¯é€šè¿‡é‚®ç®±æ‰¾å›</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- ç¾¤å‘é‚®ä»¶ - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="business">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ“¬ ç¾¤å‘é‚®ä»¶</h3>
                            </div>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">å‘å·²ç»‘å®šé‚®ç®±çš„ç”¨æˆ·å‘é€é€šçŸ¥æˆ–è¥é”€é‚®ä»¶ã€‚</p>

                            <div id="emailStatsBar" style="display:flex;gap:16px;margin-bottom:18px;flex-wrap:wrap;">
                                <div style="background:#f0f4ff;padding:10px 18px;border-radius:8px;font-size:13px;">
                                    ğŸ“Š å·²ç»‘å®šé‚®ç®±: <strong id="statBoundUsers">-</strong> äºº
                                </div>
                                <div style="background:#f0fdf4;padding:10px 18px;border-radius:8px;font-size:13px;">
                                    âœ… æ´»è·ƒç”¨æˆ·: <strong id="statActiveBound">-</strong> äºº
                                </div>
                            </div>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label for="broadcastTarget">æ”¶ä»¶èŒƒå›´</label>
                                    <select id="broadcastTarget" class="form-input" onchange="toggleCustomEmails()">
                                        <option value="all">æ‰€æœ‰å·²ç»‘å®šé‚®ç®±çš„ç”¨æˆ·</option>
                                        <option value="active">ä»…æ´»è·ƒç”¨æˆ·ï¼ˆæœ‰æ•ˆè®¢é˜…ï¼‰</option>
                                        <option value="custom">è‡ªå®šä¹‰æ”¶ä»¶åœ°å€</option>
                                    </select>
                                </div>

                                <div class="form-group" id="customEmailsGroup" style="display:none;">
                                    <label for="customEmails">æ”¶ä»¶åœ°å€</label>
                                    <textarea id="customEmails" class="form-input" rows="3" placeholder="æ¯è¡Œä¸€ä¸ªé‚®ç®±åœ°å€"></textarea>
                                </div>

                                <div class="form-group">
                                    <label for="broadcastSubject">é‚®ä»¶æ ‡é¢˜</label>
                                    <input type="text" id="broadcastSubject" placeholder="è¯·è¾“å…¥é‚®ä»¶æ ‡é¢˜" class="form-input">
                                </div>

                                <div class="form-group">
                                    <label for="broadcastContent">é‚®ä»¶å†…å®¹</label>
                                    <textarea id="broadcastContent" class="form-input" rows="8" placeholder="æ”¯æŒ HTML æ ¼å¼ï¼Œæ¢è¡Œä¼šè‡ªåŠ¨è½¬æ¢ä¸º <br>"></textarea>
                                    <span class="form-hint">æ”¯æŒ HTML æ ‡ç­¾å¦‚ &lt;b&gt;åŠ ç²—&lt;/b&gt;ã€&lt;a href=&quot;...&quot;&gt;é“¾æ¥&lt;/a&gt; ç­‰</span>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="sendBroadcastEmail()">
                                    <span>ğŸš€</span> å‘é€é‚®ä»¶
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- å‰ç«¯é…ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="site">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ¨ å‰ç«¯é…ç½®</h3>
                            </div>
                            <span class="status-badge" id="siteConfigStatus">å·²é…ç½®</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½®ç½‘ç«™åç§°ã€è”ç³»æ–¹å¼ç­‰å‰ç«¯æ˜¾ç¤ºä¿¡æ¯ï¼Œä¿å­˜ååˆ·æ–°é¡µé¢å³å¯ç”Ÿæ•ˆã€‚</p>

                            <div class="settings-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="siteName">ç½‘ç«™åç§°</label>
                                        <input type="text" id="siteName" placeholder="Emby" class="form-input">
                                        <span class="form-hint">æ˜¾ç¤ºåœ¨ä¾§è¾¹æ å’Œé¡µé¢é¡¶éƒ¨</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="siteSubtitle">ç½‘ç«™å‰¯æ ‡é¢˜</label>
                                        <input type="text" id="siteSubtitle" placeholder="ç®¡ç†ç³»ç»Ÿ" class="form-input">
                                        <span class="form-hint">æ˜¾ç¤ºåœ¨ç½‘ç«™åç§°ä¸‹æ–¹</span>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="siteTitle">é¡µé¢æ ‡é¢˜</label>
                                    <input type="text" id="siteTitle" placeholder="Embyç®¡ç†ç³»ç»Ÿ" class="form-input">
                                    <span class="form-hint">æµè§ˆå™¨æ ‡ç­¾é¡µæ˜¾ç¤ºçš„æ ‡é¢˜</span>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="siteLogo">ç½‘ç«™ LOGO</label>
                                        <input type="text" id="siteLogo" placeholder="https://example.com/logo.png"
                                            class="form-input">
                                        <span class="form-hint">LOGO å›¾ç‰‡ URLï¼Œç•™ç©ºåˆ™ä¸æ˜¾ç¤º LOGO</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="shopUrl">å®šä»·/è´­ä¹°é“¾æ¥</label>
                                        <input type="text" id="shopUrl" placeholder="https://shop.example.com"
                                            class="form-input">
                                        <span class="form-hint">é¡¶éƒ¨å¯¼èˆª"å®šä»·"æŒ‰é’®é“¾æ¥ï¼Œç•™ç©ºåˆ™ä¸æ˜¾ç¤º</span>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="telegramGroup">Telegram ç¾¤ç»„é“¾æ¥</label>
                                    <input type="text" id="telegramGroup" placeholder="https://t.me/your_group"
                                        class="form-input">
                                    <span class="form-hint">Telegram ç¾¤ç»„å®Œæ•´é“¾æ¥ï¼Œç•™ç©ºåˆ™ä¸æ˜¾ç¤º Telegram æŒ‰é’®</span>
                                </div>

                                <div class="form-group">
                                    <label for="panelUrl">é¢æ¿ç™»å½•é“¾æ¥</label>
                                    <input type="text" id="panelUrl" placeholder="https://your-domain.com"
                                        class="form-input">
                                    <span class="form-hint">ç”¨æˆ·æ³¨å†ŒæˆåŠŸåæ˜¾ç¤ºçš„é¢æ¿ç™»å½•é“¾æ¥ï¼Œç•™ç©ºåˆ™ä¸æ˜¾ç¤º</span>
                                </div>

                                <div class="form-group">
                                    <label for="supportEmail">æ”¯æŒé‚®ç®±</label>
                                    <input type="email" id="supportEmail" placeholder="support@example.com"
                                        class="form-input">
                                    <span class="form-hint">æŠ€æœ¯æ”¯æŒé¡µé¢æ˜¾ç¤ºçš„è”ç³»é‚®ç®±</span>
                                </div>

                                <div class="form-group">
                                    <label for="registerMode">æ³¨å†Œæ¨¡å¼</label>
                                    <select id="registerMode" class="form-input">
                                        <option value="open">å¼€æ”¾æ³¨å†Œ - ä»»ä½•äººéƒ½å¯ä»¥æ³¨å†Œ</option>
                                        <option value="invite">ä»…é‚€è¯·æ³¨å†Œ - éœ€è¦é‚€è¯·ç æ‰èƒ½æ³¨å†Œ</option>
                                        <option value="closed">å…³é—­æ³¨å†Œ - ç¦æ­¢æ–°ç”¨æˆ·æ³¨å†Œ</option>
                                    </select>
                                    <span class="form-hint">æ§åˆ¶ç½‘ç«™çš„æ³¨å†Œæ–¹å¼</span>
                                </div>

                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="useImageProxy" checked>
                                        <span>å¯ç”¨ TMDB å›¾ç‰‡ä»£ç†</span>
                                    </label>
                                    <span class="form-hint">å¤§é™†ç”¨æˆ·å»ºè®®å¼€å¯ï¼ˆè§£å†³å›¾ç‰‡æ— æ³•åŠ è½½é—®é¢˜ï¼‰ï¼Œæµ·å¤–ç”¨æˆ·å¯å…³é—­ä»¥åŠ é€Ÿå›¾ç‰‡åŠ è½½</span>
                                </div>

                                <div class="form-group">
                                    <label for="welcomeMessage">æ¬¢è¿è¯­</label>
                                    <input type="text" id="welcomeMessage" placeholder="æ¬¢è¿ä½¿ç”¨ Emby ç®¡ç†ç³»ç»Ÿï¼"
                                        class="form-input">
                                    <span class="form-hint">ä½¿ç”¨æ–‡æ¡£é¡µé¢æ˜¾ç¤ºçš„æ¬¢è¿è¯­</span>
                                </div>

                                <div class="form-group">
                                    <label>å¿«é€Ÿé“¾æ¥é…ç½®</label>
                                    <div id="customLinksContainer" class="custom-links-container">
                                        <!-- åŠ¨æ€ç”Ÿæˆçš„é“¾æ¥é…ç½®é¡¹ -->
                                    </div>
                                    <button type="button" class="btn-secondary btn-sm" onclick="addCustomLink()"
                                        style="margin-top: 10px;">
                                        <span>â•</span> æ·»åŠ é“¾æ¥
                                    </button>
                                    <span class="form-hint">é…ç½®æŠ€æœ¯æ”¯æŒé¡µé¢çš„å¿«é€Ÿé“¾æ¥</span>
                                </div>

                                <div class="form-group">
                                    <label for="customCss">è‡ªå®šä¹‰ CSSï¼ˆå¯é€‰ï¼‰</label>
                                    <textarea id="customCss" placeholder="/* è‡ªå®šä¹‰æ ·å¼ */" class="form-input"
                                        rows="4"></textarea>
                                    <span class="form-hint">æ·»åŠ è‡ªå®šä¹‰CSSæ ·å¼ï¼Œä¼šæ³¨å…¥åˆ°é¡µé¢headä¸­</span>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveSiteConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-secondary" onclick="loadSiteConfig()">
                                    <span>ğŸ”„</span> é‡æ–°åŠ è½½
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- æ”¯ä»˜é…ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="business">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ’³ æ”¯ä»˜é…ç½®</h3>
                            </div>
                            <span class="status-badge" id="paymentStatus">æœªé…ç½®</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½®æ˜“æ”¯ä»˜æ¥å£ï¼Œæ”¯æŒæ”¯ä»˜å®ã€å¾®ä¿¡ç­‰å¤šç§æ”¯ä»˜æ–¹å¼ã€‚é…ç½®å®Œæˆåç”¨æˆ·å¯åœ¨çº¿è´­ä¹°è®¢é˜…å¥—é¤ã€‚</p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label for="epayUrl">æ˜“æ”¯ä»˜æ¥å£åœ°å€</label>
                                    <input type="text" id="epayUrl" placeholder="https://pay.example.com"
                                        class="form-input">
                                    <span class="form-hint">æ˜“æ”¯ä»˜æœåŠ¡å•†æä¾›çš„æ¥å£åœ°å€ï¼Œä¸å¸¦æœ€åçš„æ–œæ </span>
                                </div>

                                <div class="form-group">
                                    <label for="epayPid">å•†æˆ·ID (PID)</label>
                                    <input type="text" id="epayPid" placeholder="10001" class="form-input">
                                    <span class="form-hint">æ˜“æ”¯ä»˜åˆ†é…çš„å•†æˆ·å·</span>
                                </div>

                                <div class="form-group">
                                    <label for="epayKey">å•†æˆ·å¯†é’¥ (KEY)</label>
                                    <input type="password" id="epayKey" placeholder="è¯·è¾“å…¥å•†æˆ·å¯†é’¥" class="form-input">
                                    <span class="form-hint">æ˜“æ”¯ä»˜åˆ†é…çš„å•†æˆ·å¯†é’¥ï¼Œç”¨äºç­¾åéªŒè¯</span>
                                </div>

                                <div class="form-group">
                                    <label for="epayNotifyUrl">å¼‚æ­¥é€šçŸ¥åœ°å€ï¼ˆå¯é€‰ï¼‰</label>
                                    <input type="text" id="epayNotifyUrl" placeholder="ç•™ç©ºåˆ™è‡ªåŠ¨ä½¿ç”¨å½“å‰åŸŸå" class="form-input">
                                    <span class="form-hint">æ”¯ä»˜æˆåŠŸåæ˜“æ”¯ä»˜æœåŠ¡å™¨é€šçŸ¥çš„åœ°å€ï¼Œä¸€èˆ¬ç•™ç©ºå³å¯</span>
                                </div>

                                <div class="form-group">
                                    <label for="epayReturnUrl">åŒæ­¥è·³è½¬åœ°å€ï¼ˆå¯é€‰ï¼‰</label>
                                    <input type="text" id="epayReturnUrl" placeholder="ç•™ç©ºåˆ™è‡ªåŠ¨ä½¿ç”¨å½“å‰åŸŸå" class="form-input">
                                    <span class="form-hint">æ”¯ä»˜æˆåŠŸåç”¨æˆ·è·³è½¬çš„é¡µé¢åœ°å€ï¼Œä¸€èˆ¬ç•™ç©ºå³å¯</span>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="savePaymentConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-secondary" onclick="testPaymentConfig()">
                                    <span>ğŸ”§</span> æµ‹è¯•è¿æ¥
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ é…ç½®è¯´æ˜</h4>
                                <ul>
                                    <li>å¡«å†™æ˜“æ”¯ä»˜æœåŠ¡å•†æä¾›çš„æ¥å£åœ°å€ã€å•†æˆ·IDå’Œå•†æˆ·å¯†é’¥åç‚¹å‡»ä¿å­˜</li>
                                    <li>é…ç½®ä¿å­˜å<strong>æ— éœ€é‡å¯æœåŠ¡</strong>ï¼Œç«‹å³ç”Ÿæ•ˆ</li>
                                    <li>å¼‚æ­¥é€šçŸ¥åœ°å€é»˜è®¤ä¸ºï¼š<code>ä½ çš„åŸŸå/api/payment/notify</code>ï¼ˆä¸€èˆ¬ç•™ç©ºå³å¯ï¼‰</li>
                                    <li>åŒæ­¥è·³è½¬åœ°å€é»˜è®¤ä¸ºï¼š<code>ä½ çš„åŸŸå/dashboard#purchase</code>ï¼ˆä¸€èˆ¬ç•™ç©ºå³å¯ï¼‰</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- ç™»å½•å®‰å…¨é€šçŸ¥ - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="business">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ”” ç™»å½•å®‰å…¨é€šçŸ¥</h3>
                            </div>
                            <span class="status-badge" id="loginNotifyStatus">å·²å…³é—­</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨å‘é€é€šçŸ¥ï¼ˆé‚®ä»¶/Telegramï¼‰ï¼Œå¸®åŠ©ç”¨æˆ·å‘ç°å¼‚å¸¸ç™»å½•è¡Œä¸ºã€‚</p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="loginNotifyEnabled">
                                        <span>å¯ç”¨ç™»å½•é€šçŸ¥</span>
                                    </label>
                                    <span class="form-hint">å¼€å¯åï¼Œç”¨æˆ·æ¯æ¬¡ç™»å½•éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼ˆå«IPã€è®¾å¤‡ä¿¡æ¯ï¼‰</span>
                                </div>

                                <div class="form-group">
                                    <label>é€šçŸ¥æ¸ é“</label>
                                    <div class="checkbox-group" style="margin-top: 8px;">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="loginNotifyEmail" checked>
                                            <span>ğŸ“§ é‚®ä»¶é€šçŸ¥ï¼ˆç”¨æˆ·éœ€ç»‘å®šé‚®ç®±ï¼‰</span>
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="loginNotifyTelegram" checked>
                                            <span>ğŸ“± Telegram é€šçŸ¥ï¼ˆç”¨æˆ·éœ€ç»‘å®šTGï¼‰</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveLoginNotifyConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ è¯´æ˜</h4>
                                <ul>
                                    <li>é‚®ä»¶é€šçŸ¥éœ€è¦å…ˆåœ¨ã€Œé‚®ä»¶æœåŠ¡é…ç½®ã€ä¸­å¯ç”¨ SMTP</li>
                                    <li>Telegram é€šçŸ¥éœ€è¦ç”¨æˆ·å·²ç»‘å®š Telegram ä¸” Bot å·²é…ç½®</li>
                                    <li>é€šçŸ¥åœ¨åå°å¼‚æ­¥å‘é€ï¼Œä¸ä¼šå½±å“ç™»å½•é€Ÿåº¦</li>
                                    <li>åŒæ—¶å¯ç”¨æš´åŠ›ç ´è§£é˜²æŠ¤ï¼š5åˆ†é’Ÿå†…è¿ç»­10æ¬¡ç™»å½•å¤±è´¥ï¼Œè´¦å·å°†è¢«é”å®š10åˆ†é’Ÿï¼ˆç”¨æˆ·ç«¯ä¸ç®¡ç†ç«¯å‡é€‚ç”¨ï¼‰</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- è®¢é˜…è¿‡æœŸç®¡ç† - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="business">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ“… è®¢é˜…è¿‡æœŸç®¡ç†</h3>
                            </div>
                            <span class="status-badge" id="subscriptionExpireStatus">å·²é…ç½®</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½®è®¢é˜…è¿‡æœŸåçš„è´¦å·å¤„ç†ç­–ç•¥ï¼ŒåŒ…æ‹¬ç¦ç”¨å’Œåˆ é™¤æ—¶æœºã€‚</p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label>è¿‡æœŸå¤„ç†ç­–ç•¥</label>
                                    <div class="checkbox-group" style="margin-top: 8px;">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="expireAutoDisable" checked>
                                            <span>è®¢é˜…è¿‡æœŸåè‡ªåŠ¨ç¦ç”¨ Emby è´¦å·</span>
                                        </label>
                                    </div>
                                    <span class="form-hint">å¯ç”¨åï¼Œè®¢é˜…è¿‡æœŸçš„ç”¨æˆ·å°†æ— æ³•ç™»å½• Emby</span>
                                </div>

                                <div class="form-group">
                                    <label for="expireDeleteDays">è¿‡æœŸååˆ é™¤ Emby è´¦å·ï¼ˆå¤©ï¼‰</label>
                                    <div class="input-with-hint">
                                        <input type="number" id="expireDeleteDays" placeholder="0" class="form-input"
                                            min="0" max="365" value="0">
                                        <span class="unit-label">å¤©</span>
                                    </div>
                                    <span class="form-hint">è®¾ä¸º 0 è¡¨ç¤ºä¸åˆ é™¤ï¼›è¿‡æœŸè¶…è¿‡è¯¥å¤©æ•°åå°†è‡ªåŠ¨åˆ é™¤ Emby æœåŠ¡å™¨ä¸Šçš„è´¦å·</span>
                                </div>

                                <div class="form-group">
                                    <label>åˆ é™¤é€‰é¡¹</label>
                                    <div class="checkbox-group" style="margin-top: 8px;">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="expireDeleteWebAccount">
                                            <span>åŒæ—¶åˆ é™¤ç½‘ç«™è´¦å·</span>
                                        </label>
                                    </div>
                                    <span class="form-hint">å¯ç”¨åï¼Œåˆ é™¤ Emby è´¦å·æ—¶ä¹Ÿä¼šåˆ é™¤ç½‘ç«™ç”¨æˆ·æ•°æ®ï¼›ä¸å¯ç”¨åˆ™ä»…åˆ é™¤ Emby è´¦å·ï¼Œç”¨æˆ·å¯é‡æ–°ç»‘å®š</span>
                                </div>

                                <hr style="border: none; border-top: 1px dashed #e0e0e0; margin: 20px 0;">

                                <!-- ä¿å·åŠŸèƒ½ -->
                                <div class="form-group">
                                    <label for="retentionMode">ğŸ›¡ï¸ ä¿å·æ¨¡å¼</label>
                                    <select id="retentionMode" class="form-input" onchange="toggleRetentionSettings()">
                                        <option value="off">å…³é—­ä¿å·</option>
                                        <option value="checkin">ç§¯åˆ†ä¿å·ï¼ˆç§¯åˆ†è¶³å¤Ÿè‡ªåŠ¨æ‰£å¸ç»­æœŸï¼‰</option>
                                        <option value="watch">è§‚çœ‹ä¿å·ï¼ˆæœ‰è§‚çœ‹è®°å½•ç»­æœŸï¼‰</option>
                                        <option value="both">åŒä¿ï¼ˆç§¯åˆ†+è§‚çœ‹åŒæ—¶æ»¡è¶³ï¼‰</option>
                                    </select>
                                    <span class="form-hint">å¼€å¯åï¼Œæ»¡è¶³æ¡ä»¶çš„è¿‡æœŸç”¨æˆ·å°†è‡ªåŠ¨ç»­æœŸè€Œä¸è¢«ç¦ç”¨</span>
                                </div>

                                <div id="retentionRenewGroup" class="form-group" style="display:none;">
                                    <label for="retentionRenewDays">ä¿å·ç»­æœŸå¤©æ•°</label>
                                    <div class="input-with-hint">
                                        <input type="number" id="retentionRenewDays" placeholder="30" class="form-input" min="1" max="365" value="30">
                                        <span class="unit-label">å¤©</span>
                                    </div>
                                    <span class="form-hint">æ»¡è¶³ä¿å·æ¡ä»¶åï¼Œè‡ªåŠ¨ç»­æœŸçš„å¤©æ•°</span>
                                </div>

                                <!-- ç§¯åˆ†ä¿å·é…ç½® -->
                                <div id="retentionCheckinGroup" style="display:none; background:#f8f9ff; border-radius:8px; padding:15px; margin-top:10px;">
                                    <h4 style="margin:0 0 10px 0; color:#5b6abf;">ğŸ’° ç§¯åˆ†ä¿å·æ¡ä»¶</h4>
                                    <div class="form-group">
                                        <label for="retentionCheckinCost">ç»­æœŸæ‰£é™¤ç§¯åˆ†</label>
                                        <div class="input-with-hint">
                                            <input type="number" id="retentionCheckinCost" placeholder="10" class="form-input" min="0" value="10">
                                            <span class="unit-label" id="retentionCoinUnit">ç§¯åˆ†</span>
                                        </div>
                                        <span class="form-hint">ç”¨æˆ·ç§¯åˆ† â‰¥ æ­¤å€¼æ—¶è‡ªåŠ¨æ‰£é™¤å¹¶ç»­æœŸï¼ˆ0 è¡¨ç¤ºå…è´¹ç»­æœŸï¼‰</span>
                                    </div>
                                </div>

                                <!-- è§‚çœ‹ä¿å·é…ç½® -->
                                <div id="retentionWatchGroup" style="display:none; background:#f8fff8; border-radius:8px; padding:15px; margin-top:10px;">
                                    <h4 style="margin:0 0 10px 0; color:#2d9d4e;">â–¶ï¸ è§‚çœ‹ä¿å·æ¡ä»¶</h4>
                                    <div class="form-group">
                                        <label for="retentionWatchDays">è§‚çœ‹æ£€æŸ¥å¤©æ•°</label>
                                        <div class="input-with-hint">
                                            <input type="number" id="retentionWatchDays" placeholder="30" class="form-input" min="1" max="365" value="30">
                                            <span class="unit-label">å¤©å†…</span>
                                        </div>
                                        <span class="form-hint">æ£€æŸ¥è¿‡å» N å¤©å†…çš„è§‚çœ‹è®°å½•</span>
                                    </div>
                                    <div class="form-group">
                                        <label for="retentionWatchMinutes">æœ€ä½è§‚çœ‹æ—¶é•¿</label>
                                        <div class="input-with-hint">
                                            <input type="number" id="retentionWatchMinutes" placeholder="30" class="form-input" min="1" value="30">
                                            <span class="unit-label">åˆ†é’Ÿ</span>
                                        </div>
                                        <span class="form-hint">ç´¯è®¡è§‚çœ‹æ—¶é•¿è¾¾åˆ°æ­¤å€¼æ‰æ»¡è¶³æ¡ä»¶</span>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveSubscriptionExpireConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-secondary" onclick="loadSubscriptionExpireConfig()">
                                    <span>ğŸ”„</span> é‡æ–°åŠ è½½
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ é…ç½®è¯´æ˜</h4>
                                <ul>
                                    <li>ç³»ç»Ÿæ¯å°æ—¶è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡è®¢é˜…è¿‡æœŸçŠ¶æ€</li>
                                    <li>è¿‡æœŸç¦ç”¨ï¼šç«‹å³ç¦ç”¨ Emby è´¦å·ï¼Œç”¨æˆ·æ— æ³•æ’­æ”¾</li>
                                    <li>è¿‡æœŸåˆ é™¤ Emby è´¦å·ï¼šä» Emby æœåŠ¡å™¨åˆ é™¤è´¦å·</li>
                                    <li>åŒæ—¶åˆ é™¤ç½‘ç«™è´¦å·ï¼šè¿åŒç½‘ç«™ç”¨æˆ·æ•°æ®ä¸€èµ·åˆ é™¤</li>
                                    <li>å»ºè®®è®¾ç½®åˆ é™¤å¤©æ•°ï¼ˆå¦‚30å¤©ï¼‰ï¼Œç»™ç”¨æˆ·ç»­è´¹çš„ç¼“å†²æ—¶é—´</li>
                                </ul>
                                <h4 style="margin-top:12px;">ğŸ›¡ï¸ ä¿å·è¯´æ˜</h4>
                                <ul>
                                    <li><b>ç­¾åˆ°ä¿å·</b>ï¼šè¿‡å»30å¤©å†…ç­¾åˆ°è¾¾æ ‡ + ç§¯åˆ†è¶³å¤Ÿ â†’ è‡ªåŠ¨æ‰£å¸ç»­æœŸ</li>
                                    <li><b>è§‚çœ‹ä¿å·</b>ï¼šæŒ‡å®šå¤©æ•°å†…æœ‰è¶³å¤Ÿè§‚çœ‹æ—¶é•¿ â†’ è‡ªåŠ¨å…è´¹ç»­æœŸ</li>
                                    <li><b>åŒä¿</b>ï¼šå¿…é¡»åŒæ—¶æ»¡è¶³ç­¾åˆ°å’Œè§‚çœ‹ä¸¤ä¸ªæ¡ä»¶æ‰ç»­æœŸ</li>
                                    <li>ä¿å·ä»…å¯¹åˆšè¿‡æœŸï¼ˆ3å¤©å†…ï¼‰çš„ç”¨æˆ·ç”Ÿæ•ˆï¼Œé•¿æœŸè¿‡æœŸç”¨æˆ·ä¸ä¼šè¢«åå¤ç»­æœŸ</li>
                                    <li>ä¿å·ç»­æœŸä»åŸåˆ°æœŸæ—¥è®¡ç®—ï¼Œä¸ä¼šä¸¢å¤±å¤©æ•°</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- è®¢é˜…åˆ°æœŸæé†’ - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="business">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>â° è®¢é˜…åˆ°æœŸæé†’</h3>
                            </div>
                            <span class="status-badge" id="expireRemindStatus">å·²å…³é—­</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">åœ¨ç”¨æˆ·è®¢é˜…åˆ°æœŸå‰è‡ªåŠ¨å‘é€æé†’é€šçŸ¥ï¼Œä¿ƒè¿›ç»­è´¹ã€‚ç³»ç»Ÿæ¯6å°æ—¶æ£€æŸ¥ä¸€æ¬¡ã€‚</p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="expireRemindEnabled">
                                        <span>å¯ç”¨åˆ°æœŸæé†’</span>
                                    </label>
                                </div>

                                <div class="form-group">
                                    <label for="expireRemindDays">æå‰æé†’å¤©æ•°</label>
                                    <input type="text" id="expireRemindDays" placeholder="3,7" class="form-input" value="3,7">
                                    <span class="form-hint">ç”¨è‹±æ–‡é€—å·åˆ†éš”å¤šä¸ªå¤©æ•°ï¼Œå¦‚ 3,7 è¡¨ç¤ºåˆ°æœŸå‰3å¤©å’Œ7å¤©å„æé†’ä¸€æ¬¡</span>
                                </div>

                                <div class="form-group">
                                    <label>é€šçŸ¥æ¸ é“</label>
                                    <div class="checkbox-group" style="margin-top: 8px;">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="expireRemindEmail" checked>
                                            <span>ğŸ“§ é‚®ä»¶é€šçŸ¥</span>
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="expireRemindTelegram" checked>
                                            <span>ğŸ“± Telegram é€šçŸ¥</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveExpireRemindConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ è¯´æ˜</h4>
                                <ul>
                                    <li>é‚®ä»¶é€šçŸ¥éœ€è¦å…ˆåœ¨ã€Œé‚®ä»¶æœåŠ¡é…ç½®ã€ä¸­å¯ç”¨ SMTP å¹¶ä¸”ç”¨æˆ·ç»‘å®šäº†é‚®ç®±</li>
                                    <li>Telegram é€šçŸ¥éœ€è¦ç”¨æˆ·ç»‘å®šäº† Telegram</li>
                                    <li>æ¯ä¸ªç”¨æˆ·æ¯ä¸ªæé†’æ—¶é—´ç‚¹åªä¼šæ”¶åˆ°ä¸€æ¬¡é€šçŸ¥ï¼Œä¸ä¼šé‡å¤å‘é€</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- é‚€è¯·è¿”åˆ©è®¾ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="business">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ é‚€è¯·è¿”åˆ©è®¾ç½®</h3>
                            </div>
                            <span class="status-badge" id="inviteRewardStatus">å·²å¼€å¯</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½®é‚€è¯·è¿”åˆ©æ¯”ä¾‹ï¼Œè¢«é‚€è¯·äººæ¯æ¬¡è´­ä¹°/å…‘æ¢æ—¶ï¼Œé‚€è¯·äººå°†è·å¾—å¯¹åº”æ¯”ä¾‹çš„å¤©æ•°å¥–åŠ±ã€‚é‚€è¯·å…³ç³»æ°¸ä¹…ç»‘å®šã€‚</p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label>å¯ç”¨é‚€è¯·è¿”åˆ©</label>
                                    <div class="checkbox-group" style="margin-top: 8px;">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="inviteRewardEnabled" checked>
                                            <span>å¼€å¯é‚€è¯·è¿”åˆ©åŠŸèƒ½</span>
                                        </label>
                                    </div>
                                    <span class="form-hint">å…³é—­åï¼Œæ‰€æœ‰è´­ä¹°/å…‘æ¢å°†ä¸å†è§¦å‘é‚€è¯·è¿”åˆ©</span>
                                </div>

                                <div class="form-group">
                                    <label for="inviteRewardPercent">è¿”åˆ©æ¯”ä¾‹ï¼ˆ%ï¼‰</label>
                                    <div class="input-with-hint">
                                        <input type="number" id="inviteRewardPercent" placeholder="10" class="form-input"
                                            min="0" max="100" step="1" value="10">
                                        <span class="unit-label">%</span>
                                    </div>
                                    <span class="form-hint">è¢«é‚€è¯·äººè´­ä¹°/å…‘æ¢å¤©æ•° Ã— è¯¥æ¯”ä¾‹ = é‚€è¯·äººè·å¾—çš„è¿”åˆ©å¤©æ•°ï¼ˆå¦‚è´­ä¹°30å¤© Ã— 10% = 3å¤©ï¼‰</span>
                                </div>

                                <div class="form-group">
                                    <label for="inviteRewardMinDays">æœ€ä½è¿”åˆ©å¤©æ•°</label>
                                    <div class="input-with-hint">
                                        <input type="number" id="inviteRewardMinDays" placeholder="1" class="form-input"
                                            min="0" max="365" value="1">
                                        <span class="unit-label">å¤©</span>
                                    </div>
                                    <span class="form-hint">å³ä½¿æŒ‰æ¯”ä¾‹è®¡ç®—ä¸è¶³è¯¥å¤©æ•°ï¼Œä¹Ÿä¿è¯è¿”åˆ©ä¸ä½äºæ­¤å€¼ï¼›è®¾ä¸º 0 åˆ™ä¸¥æ ¼æŒ‰æ¯”ä¾‹ï¼ˆå¯èƒ½ä¸º0å¤©ï¼‰</span>
                                </div>

                                <div class="form-group">
                                    <label for="inviteRewardMode">é»˜è®¤è¿”åˆ©æ¨¡å¼</label>
                                    <select id="inviteRewardMode" class="form-input">
                                        <option value="recurring">ğŸ”„ å¾ªç¯è¿”åˆ©ï¼ˆæ¯æ¬¡è´­ä¹°éƒ½è¿”åˆ©ï¼‰</option>
                                        <option value="once">1ï¸âƒ£ ä¸€æ¬¡æ€§è¿”åˆ©ï¼ˆä»…é¦–æ¬¡è´­ä¹°è¿”åˆ©ï¼‰</option>
                                    </select>
                                    <span class="form-hint">å…¨å±€é»˜è®¤æ¨¡å¼ï¼Œå¯åœ¨ç”¨æˆ·è¯¦æƒ…ä¸­ä¸ºç‰¹å®šç”¨æˆ·å•ç‹¬è®¾ç½®è¦†ç›–</span>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveInviteRewardConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-secondary" onclick="loadInviteRewardConfig()">
                                    <span>ğŸ”„</span> é‡æ–°åŠ è½½
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ é…ç½®è¯´æ˜</h4>
                                <ul>
                                    <li>é‚€è¯·å…³ç³»åœ¨æ³¨å†Œæ—¶å»ºç«‹ï¼Œæ°¸ä¹…ç»‘å®šï¼Œä¸ä¼šè§£é™¤</li>
                                    <li><b>å¾ªç¯è¿”åˆ©</b>ï¼šè¢«é‚€è¯·äººæ¯æ¬¡è´­ä¹°/å…‘æ¢ï¼Œé‚€è¯·äººéƒ½è·å¾—è¿”åˆ©</li>
                                    <li><b>ä¸€æ¬¡æ€§è¿”åˆ©</b>ï¼šä»…è¢«é‚€è¯·äººé¦–æ¬¡è´­ä¹°/å…‘æ¢æ—¶è¿”åˆ©ä¸€æ¬¡</li>
                                    <li>è¿”åˆ©ä»¥å¤©æ•°å½¢å¼å åŠ åˆ°é‚€è¯·äººçš„è®¢é˜…æ—¶é—´ä¸Š</li>
                                    <li>å¯åœ¨ã€Œç”¨æˆ·è¯¦æƒ…ã€ä¸­ä¸ºç‰¹å®šç”¨æˆ·è®¾ç½®ä¸ªæ€§åŒ–è¿”åˆ©æ¯”ä¾‹å’Œæ¨¡å¼</li>
                                    <li>ä¾‹ï¼šæ¯”ä¾‹10%ï¼Œè¢«é‚€è¯·äººè´­ä¹°90å¤©ï¼Œé‚€è¯·äººè·å¾—9å¤©</li>
                                    <li>è®¾ä¸º 0% ç­‰åŒäºå…³é—­è¿”åˆ©ï¼ˆä½†é‚€è¯·å…³ç³»ä»ä¼šè®°å½•ï¼‰</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- ç­¾åˆ°ç³»ç»Ÿé…ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="business">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ¯ ç­¾åˆ°ç³»ç»Ÿé…ç½®</h3>
                            </div>
                            <span class="status-badge" id="checkinStatus">æœªå¼€å¯</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½®æ¯æ—¥ç­¾åˆ°åŠŸèƒ½ï¼Œç”¨æˆ·ç­¾åˆ°å¯è·å¾—ç§¯åˆ†ï¼Œç§¯åˆ†å¯å…‘æ¢è®¢é˜…å¥—é¤ã€‚</p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <div class="toggle-switch-container">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="checkinEnabled" onchange="toggleCheckinConfig()">
                                            <span class="toggle-slider"></span>
                                        </label>
                                        <div class="toggle-label-text">
                                            <strong>å¯ç”¨ç½‘é¡µç­¾åˆ°åŠŸèƒ½</strong>
                                            <span class="form-hint">å¼€å¯åï¼Œç”¨æˆ·ä»ªè¡¨ç›˜ä¼šæ˜¾ç¤ºç­¾åˆ°å¡ç‰‡</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="toggle-switch-container">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="checkinBotEnabled">
                                            <span class="toggle-slider"></span>
                                        </label>
                                        <div class="toggle-label-text">
                                            <strong>å¯ç”¨BOTç­¾åˆ°åŠŸèƒ½</strong>
                                            <span class="form-hint">å¼€å¯åï¼Œç”¨æˆ·å¯ä»¥åœ¨Telegram BOTå¤„ä½¿ç”¨ /checkin å‘½ä»¤ç­¾åˆ°</span>
                                        </div>
                                    </div>
                                </div>

                                <div id="checkinConfigDetails" style="display: none;">
                                    <div class="form-group">
                                        <label for="coinName">è´§å¸åç§°</label>
                                        <input type="text" id="coinName" placeholder="ç§¯åˆ†" class="form-input"
                                            maxlength="10">
                                        <span class="form-hint">ç§¯åˆ†çš„æ˜¾ç¤ºåç§°ï¼Œä¾‹å¦‚ï¼šç§¯åˆ†ã€é‡‘å¸ã€è±†å­ç­‰</span>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="coinMin">æœ€å°‘è·å¾—</label>
                                            <input type="number" id="coinMin" placeholder="1" class="form-input" min="1"
                                                max="100">
                                            <span class="form-hint">ç­¾åˆ°æœ€å°‘è·å¾—çš„ç§¯åˆ†æ•°</span>
                                        </div>

                                        <div class="form-group">
                                            <label for="coinMax">æœ€å¤šè·å¾—</label>
                                            <input type="number" id="coinMax" placeholder="10" class="form-input"
                                                min="1" max="100">
                                            <span class="form-hint">ç­¾åˆ°æœ€å¤šè·å¾—çš„ç§¯åˆ†æ•°</span>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label>å…‘æ¢å¥—é¤é…ç½®</label>
                                        <div id="exchangePlansContainer" class="exchange-plans-container">
                                            <!-- åŠ¨æ€ç”Ÿæˆçš„å…‘æ¢å¥—é¤é…ç½®é¡¹ -->
                                        </div>
                                        <button type="button" class="btn-secondary btn-sm"
                                            onclick="openPlanSelectModal()" style="margin-top: 10px;">
                                            <span>â•</span> æ·»åŠ å¥—é¤
                                        </button>
                                        <span class="form-hint">é…ç½®ç”¨æˆ·å¯ä»¥ç”¨ç§¯åˆ†å…‘æ¢çš„è®¢é˜…å¥—é¤</span>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveCheckinConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-secondary" onclick="loadCheckinConfig()">
                                    <span>ğŸ”„</span> é‡æ–°åŠ è½½
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ é…ç½®è¯´æ˜</h4>
                                <ul>
                                    <li>ç­¾åˆ°åŠŸèƒ½å…³é—­æ—¶ï¼Œç”¨æˆ·ä»ªè¡¨ç›˜ä¸ä¼šæ˜¾ç¤ºç­¾åˆ°å¡ç‰‡</li>
                                    <li>æ¯ä¸ªç”¨æˆ·æ¯å¤©åªèƒ½ç­¾åˆ°ä¸€æ¬¡ï¼Œç­¾åˆ°è·å¾—çš„ç§¯åˆ†æ•°åœ¨é…ç½®èŒƒå›´å†…éšæœº</li>
                                    <li>è¿ç»­ç­¾åˆ°å¯ä»¥ç´¯è®¡å¤©æ•°ï¼Œæ–­ç­¾åé‡æ–°è®¡ç®—</li>
                                    <li>ç”¨æˆ·å¯ä»¥ä½¿ç”¨ç§¯åˆ†å…‘æ¢é…ç½®çš„è®¢é˜…å¥—é¤ï¼Œå…‘æ¢åè®¢é˜…æ—¶é—´ä¼šè‡ªåŠ¨å»¶é•¿</li>
                                    <li>ç®¡ç†å‘˜å¯ä»¥åœ¨ç”¨æˆ·ç®¡ç†ç•Œé¢æ‰‹åŠ¨èµ é€æˆ–æ‰£é™¤ç”¨æˆ·ç§¯åˆ†</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- æ±‚ç‰‡é™åˆ¶é…ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="business">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ¯ æ±‚ç‰‡é™åˆ¶é…ç½®</h3>
                            </div>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½®ä¸åŒç­‰çº§ç”¨æˆ·çš„æ¯æ—¥æ±‚ç‰‡æ¬¡æ•°é™åˆ¶ã€‚</p>

                            <div class="settings-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="limitLevelA">Açº§ï¼ˆç™½åå•ç”¨æˆ·ï¼‰</label>
                                        <input type="number" id="limitLevelA" placeholder="3" class="form-input" min="0"
                                            max="99">
                                        <span class="form-hint">ç™½åå•ç”¨æˆ·æ¯æ—¥æ±‚ç‰‡æ¬¡æ•°</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="limitLevelB">Bçº§ï¼ˆæ³¨å†Œç”¨æˆ·ï¼‰</label>
                                        <input type="number" id="limitLevelB" placeholder="1" class="form-input" min="0"
                                            max="99">
                                        <span class="form-hint">æ™®é€šæ³¨å†Œç”¨æˆ·æ¯æ—¥æ±‚ç‰‡æ¬¡æ•°</span>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="limitLevelC">Cçº§ï¼ˆå·²ç¦ç”¨ï¼‰</label>
                                        <input type="number" id="limitLevelC" placeholder="0" class="form-input" min="0"
                                            max="99">
                                        <span class="form-hint">è¢«ç¦ç”¨ç”¨æˆ·æ¯æ—¥æ±‚ç‰‡æ¬¡æ•°ï¼ˆé€šå¸¸ä¸º0ï¼‰</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="limitLevelD">Dçº§ï¼ˆæ— è´¦å·ï¼‰</label>
                                        <input type="number" id="limitLevelD" placeholder="0" class="form-input" min="0"
                                            max="99">
                                        <span class="form-hint">æœªç»‘å®šè´¦å·ç”¨æˆ·æ¯æ—¥æ±‚ç‰‡æ¬¡æ•°</span>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveRequestLimitConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ é…ç½®è¯´æ˜</h4>
                                <ul>
                                    <li><strong>Açº§</strong>ï¼šç™½åå•ç”¨æˆ·ï¼Œæ‹¥æœ‰æœ€é«˜æ±‚ç‰‡æƒé™</li>
                                    <li><strong>Bçº§</strong>ï¼šæ™®é€šæ³¨å†Œç”¨æˆ·</li>
                                    <li><strong>Cçº§</strong>ï¼šè¢«ç¦ç”¨çš„ç”¨æˆ·ï¼Œå»ºè®®è®¾ä¸º 0</li>
                                    <li><strong>Dçº§</strong>ï¼šæœªç»‘å®š Emby è´¦å·çš„ç”¨æˆ·ï¼Œå»ºè®®è®¾ä¸º 0</li>
                                    <li>é…ç½®ä¿å­˜å<strong>æ— éœ€é‡å¯æœåŠ¡</strong>ï¼Œç«‹å³ç”Ÿæ•ˆ</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- ç³»ç»Ÿå…¬å‘Š - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="site">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ“¢ ç³»ç»Ÿå…¬å‘Š</h3>
                            </div>
                            <span class="status-badge" id="announcementsStatus">0 æ¡å…¬å‘Š</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">ç®¡ç†ç³»ç»Ÿå…¬å‘Šï¼Œå…¬å‘Šå°†æ˜¾ç¤ºåœ¨ç”¨æˆ·ä»ªè¡¨ç›˜é¦–é¡µã€‚</p>

                            <div class="settings-actions" style="margin-bottom: 16px;">
                                <button class="btn-primary" onclick="openAnnouncementModal()">
                                    <span>â•</span> å‘å¸ƒå…¬å‘Š
                                </button>
                            </div>

                            <div class="announcements-list-compact" id="announcementsListCompact">
                                <div class="loading-placeholder">åŠ è½½ä¸­...</div>
                            </div>
                        </div>
                    </div>

                    <!-- çº¿è·¯ç®¡ç† - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="site">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ”— çº¿è·¯ç®¡ç†</h3>
                            </div>
                            <span class="status-badge" id="linesStatus">0 æ¡çº¿è·¯</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½® Emby æœåŠ¡å™¨è¿æ¥çº¿è·¯ï¼Œæ”¯æŒå¤šçº¿è·¯è´Ÿè½½å’Œç™½åå•ä¸“å±çº¿è·¯ã€‚</p>

                            <div class="settings-actions" style="margin-bottom: 16px;">
                                <button class="btn-primary" onclick="showAddLineModal()">
                                    <span>â•</span> æ·»åŠ çº¿è·¯
                                </button>
                            </div>

                            <div class="lines-stats-mini">
                                <div class="stat-mini">
                                    <span class="stat-mini-value" id="totalLines">0</span>
                                    <span class="stat-mini-label">æ€»çº¿è·¯</span>
                                </div>
                                <div class="stat-mini">
                                    <span class="stat-mini-value" id="activeLines">0</span>
                                    <span class="stat-mini-label">å·²å¯ç”¨</span>
                                </div>
                                <div class="stat-mini">
                                    <span class="stat-mini-value" id="whitelistLines">0</span>
                                    <span class="stat-mini-label">ç™½åå•ä¸“å±</span>
                                </div>
                            </div>

                            <div class="lines-list-compact" id="linesList">
                                <div class="loading-placeholder">
                                    <div class="spinner"></div>
                                    <p>åŠ è½½ä¸­...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MoviePilot é…ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="advanced">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ¬ MoviePilot é…ç½®</h3>
                            </div>
                            <span class="status-badge" id="mpStatus">æœªé…ç½®</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½® MoviePilot è¿æ¥ï¼Œç”¨äºæœç´¢å’Œæ¨é€ä¸‹è½½ä»»åŠ¡ã€‚æ”¯æŒç”¨æˆ·åå¯†ç æˆ– Token è®¤è¯ã€‚</p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label for="mpUrl">MoviePilot åœ°å€</label>
                                    <input type="text" id="mpUrl" placeholder="http://127.0.0.1:3000"
                                        class="form-input">
                                    <span class="form-hint">MoviePilot Web UI åœ°å€ï¼Œä¸å¸¦æœ«å°¾æ–œæ </span>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="mpUsername">ç”¨æˆ·å</label>
                                        <input type="text" id="mpUsername" placeholder="admin" class="form-input">
                                        <span class="form-hint">MoviePilot ç™»å½•ç”¨æˆ·å</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="mpPassword">å¯†ç </label>
                                        <input type="password" id="mpPassword" placeholder="è¯·è¾“å…¥å¯†ç " class="form-input">
                                        <span class="form-hint">MoviePilot ç™»å½•å¯†ç </span>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="mpToken">API Tokenï¼ˆå¯é€‰ï¼‰</label>
                                    <input type="text" id="mpToken" placeholder="ç•™ç©ºåˆ™ä½¿ç”¨ç”¨æˆ·åå¯†ç ç™»å½•" class="form-input">
                                    <span class="form-hint">å¦‚å·²æœ‰ Token å¯ç›´æ¥å¡«å†™ï¼Œä¼˜å…ˆçº§é«˜äºç”¨æˆ·åå¯†ç </span>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveMoviePilotConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-secondary" onclick="testMoviePilotConfig()">
                                    <span>ğŸ”§</span> æµ‹è¯•è¿æ¥
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ é…ç½®è¯´æ˜</h4>
                                <ul>
                                    <li>MoviePilot ç”¨äºæœç´¢ PT ç«™ç‚¹çš„ç§å­èµ„æº</li>
                                    <li>å¯ä»¥ä½¿ç”¨<strong>ç”¨æˆ·å+å¯†ç </strong>æˆ–ç›´æ¥æä¾› <strong>API Token</strong></li>
                                    <li>é…ç½®ä¿å­˜å<strong>æ— éœ€é‡å¯æœåŠ¡</strong>ï¼Œç«‹å³ç”Ÿæ•ˆ</li>
                                    <li>ç¡®ä¿ MoviePilot å·²æ­£ç¡®é…ç½® PT ç«™ç‚¹ç´¢å¼•å™¨</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- qBittorrent é…ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="advanced">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ“¥ qBittorrent é…ç½®</h3>
                            </div>
                            <span class="status-badge" id="qbStatus">æœªé…ç½®</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½® qBittorrent ä¸‹è½½å®¢æˆ·ç«¯ï¼Œç”¨äºè‡ªåŠ¨ä¸‹è½½ç§å­æ–‡ä»¶ã€‚</p>

                            <div class="settings-form">
                                <div class="form-group">
                                    <label for="qbUrl">qBittorrent åœ°å€</label>
                                    <input type="text" id="qbUrl" placeholder="http://127.0.0.1:8080"
                                        class="form-input">
                                    <span class="form-hint">qBittorrent Web UI åœ°å€ï¼Œä¸å¸¦æœ«å°¾æ–œæ </span>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="qbUsername">ç”¨æˆ·å</label>
                                        <input type="text" id="qbUsername" placeholder="admin" class="form-input">
                                        <span class="form-hint">qBittorrent Web UI ç”¨æˆ·å</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="qbPassword">å¯†ç </label>
                                        <input type="password" id="qbPassword" placeholder="è¯·è¾“å…¥å¯†ç " class="form-input">
                                        <span class="form-hint">qBittorrent Web UI å¯†ç </span>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="qbCategory">ä¸‹è½½åˆ†ç±»</label>
                                        <input type="text" id="qbCategory" placeholder="emby-request"
                                            class="form-input">
                                        <span class="form-hint">ä¸‹è½½ä»»åŠ¡çš„åˆ†ç±»æ ‡ç­¾ï¼Œä¾¿äºç®¡ç†</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="qbSavePath">ä¿å­˜è·¯å¾„ï¼ˆå¯é€‰ï¼‰</label>
                                        <input type="text" id="qbSavePath" placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤è·¯å¾„" class="form-input">
                                        <span class="form-hint">ä¸‹è½½æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œç•™ç©ºä½¿ç”¨ qB é»˜è®¤è®¾ç½®</span>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveQbittorrentConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-secondary" onclick="testQbittorrentConfig()">
                                    <span>ğŸ”§</span> æµ‹è¯•è¿æ¥
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ é…ç½®è¯´æ˜</h4>
                                <ul>
                                    <li>qBittorrent ç”¨äºè‡ªåŠ¨ä¸‹è½½æœç´¢åˆ°çš„ç§å­</li>
                                    <li>éœ€è¦å¼€å¯ qBittorrent çš„ <strong>Web UI</strong> åŠŸèƒ½</li>
                                    <li>å»ºè®®è®¾ç½®ä¸“é—¨çš„åˆ†ç±»ï¼Œä¾¿äºç®¡ç†æ±‚ç‰‡ä¸‹è½½ä»»åŠ¡</li>
                                    <li>é…ç½®ä¿å­˜å<strong>æ— éœ€é‡å¯æœåŠ¡</strong>ï¼Œç«‹å³ç”Ÿæ•ˆ</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- æœç´¢è®¾ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="advanced">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ” æœç´¢è®¾ç½®</h3>
                            </div>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½® PT ç«™ç‚¹æœç´¢ç­–ç•¥å’Œä¸‹è½½ç›‘æ§å‚æ•°ã€‚</p>

                            <div class="settings-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="searchStrategy">æœç´¢ç­–ç•¥</label>
                                        <select id="searchStrategy" class="form-input">
                                            <option value="all">å…¨éƒ¨æœç´¢ - æœç´¢æ‰€æœ‰ç«™ç‚¹å¹¶èšåˆç»“æœ</option>
                                            <option value="first">ä¼˜å…ˆåŒ¹é… - æ‰¾åˆ°ç»“æœååœæ­¢æœç´¢</option>
                                        </select>
                                        <span class="form-hint">æ¨èä½¿ç”¨ã€Œå…¨éƒ¨æœç´¢ã€è·å–æ›´å…¨é¢çš„ç»“æœ</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="pollInterval">ä¸‹è½½çŠ¶æ€è½®è¯¢é—´éš”ï¼ˆç§’ï¼‰</label>
                                        <input type="number" id="pollInterval" placeholder="10" class="form-input"
                                            min="5" max="60">
                                        <span class="form-hint">æ£€æŸ¥ä¸‹è½½è¿›åº¦çš„æ—¶é—´é—´éš”ï¼Œå»ºè®® 10-30 ç§’</span>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-actions">
                                <button class="btn-primary" onclick="saveSearchConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                            </div>

                            <div class="settings-tips">
                                <h4>ğŸ“Œ é…ç½®è¯´æ˜</h4>
                                <ul>
                                    <li>æœç´¢ç­–ç•¥å½±å“ PT ç«™ç‚¹çš„èµ„æºæœç´¢æ–¹å¼</li>
                                    <li>è½®è¯¢é—´éš”è¶ŠçŸ­ä¸‹è½½çŠ¶æ€æ›´æ–°è¶ŠåŠæ—¶ï¼Œä½†ä¼šå¢åŠ æœåŠ¡å™¨è´Ÿæ‹…</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- å…¥åº“é€šçŸ¥è®¾ç½® - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="advanced">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ”” å…¥åº“é€šçŸ¥è®¾ç½®</h3>
                            </div>
                            <span class="status-badge configured" id="libraryNotificationStatus">å·²é…ç½®</span>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">é…ç½®åª’ä½“å…¥åº“æ—¶å‘é€åˆ° Telegram çš„é€šçŸ¥å†…å®¹å’Œæ ·å¼ã€‚</p>

                            <!-- Tab åˆ‡æ¢ -->
                            <div class="notification-tabs"
                                style="margin-bottom: 20px; border-bottom: 2px solid var(--border-color);">
                                <button class="tab-button active" onclick="switchNotificationTab('request')">
                                    <span>ğŸ“¬</span> æ±‚ç‰‡é€šçŸ¥
                                </button>
                                <button class="tab-button" onclick="switchNotificationTab('general')">
                                    <span>ğŸ“¢</span> é€šç”¨å…¥åº“é€šçŸ¥
                                </button>
                            </div>

                            <!-- æ±‚ç‰‡é€šçŸ¥é…ç½® -->
                            <div id="requestNotificationTab" class="notification-tab-content" style="display: block;">
                                <h4 style="margin-bottom: 15px; color: var(--text-primary);">ğŸ“¬ æ±‚ç‰‡å…¥åº“é€šçŸ¥ï¼ˆ@ç”¨æˆ·æé†’ï¼‰</h4>
                                <p class="settings-desc" style="margin-bottom: 15px;">å½“æ±‚ç‰‡è¯·æ±‚çš„åª’ä½“å…¥åº“æ—¶ï¼Œè‡ªåŠ¨å‘é€é€šçŸ¥å¹¶@æ±‚ç‰‡ç”¨æˆ·ã€‚</p>

                                <div class="settings-form">
                                    <div class="form-group">
                                        <label>æ¨é€ç›®æ ‡</label>
                                        <div style="display: flex; gap: 20px; margin-top: 8px;">
                                            <label class="radio-label">
                                                <input type="radio" name="requestSendTo" value="group" checked>
                                                <span>æ¨é€è‡³ç¾¤ç»„</span>
                                            </label>
                                            <label class="radio-label">
                                                <input type="radio" name="requestSendTo" value="personal">
                                                <span>æ¨é€è‡³ä¸ªäºº</span>
                                            </label>
                                        </div>
                                        <span class="form-hint">ç¾¤ç»„ï¼šå‘é€åˆ°é€šçŸ¥ç¾¤ç»„ï¼›ä¸ªäººï¼šå‘é€ç»™æ±‚ç‰‡ç”¨æˆ·ï¼ˆéœ€ç”¨æˆ·ç»‘å®š Telegramï¼‰</span>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="requestShowOverview" checked>
                                            <span>æ˜¾ç¤ºå½±ç‰‡ç®€ä»‹</span>
                                        </label>
                                        <span class="form-hint">é€šçŸ¥ä¸­åŒ…å«å½±ç‰‡ç®€ä»‹ä¿¡æ¯</span>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="requestShowPoster" checked>
                                            <span>æ˜¾ç¤ºå½±ç‰‡æµ·æŠ¥</span>
                                        </label>
                                        <span class="form-hint">é€šçŸ¥ä¸­é™„å¸¦å½±ç‰‡æµ·æŠ¥å›¾ç‰‡</span>
                                    </div>
                                </div>
                            </div>

                            <!-- é€šç”¨å…¥åº“é€šçŸ¥é…ç½® -->
                            <div id="generalNotificationTab" class="notification-tab-content" style="display: none;">
                                <h4 style="margin-bottom: 15px; color: var(--text-primary);">ğŸ“¢ é€šç”¨å…¥åº“é€šçŸ¥ï¼ˆæ‰€æœ‰åª’ä½“å…¥åº“ï¼‰</h4>
                                <p class="settings-desc" style="margin-bottom: 15px;">ä»»ä½•åª’ä½“å…¥åº“æ—¶éƒ½å‘é€é€šçŸ¥ï¼Œä¸é™äºæ±‚ç‰‡è¯·æ±‚ã€‚</p>

                                <div class="settings-form">
                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="generalLibraryEnabled">
                                            <span>å¯ç”¨é€šç”¨å…¥åº“é€šçŸ¥</span>
                                        </label>
                                        <span class="form-hint">å¼€å¯åï¼Œæ‰€æœ‰åª’ä½“å…¥åº“éƒ½ä¼šå‘é€é€šçŸ¥ï¼ˆåŒ…æ‹¬éæ±‚ç‰‡çš„åª’ä½“ï¼‰</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="generalLibraryChatId">é€šçŸ¥ç›®æ ‡ Chat ID</label>
                                        <input type="text" id="generalLibraryChatId" placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤é€šçŸ¥ç¾¤ç»„"
                                            class="form-input">
                                        <span class="form-hint">æŒ‡å®šå‘é€é€šçŸ¥çš„ç¾¤ç»„æˆ–é¢‘é“ IDï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤é€šçŸ¥ç¾¤ç»„</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="generalLibraryBotToken">ä¸“ç”¨ Bot Tokenï¼ˆå¯é€‰ï¼‰</label>
                                        <input type="text" id="generalLibraryBotToken" placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤æœºå™¨äºº"
                                            class="form-input">
                                        <span class="form-hint">âš ï¸ å»ºè®®å…¥åº“é€šçŸ¥ä½¿ç”¨ä¸“ç”¨æœºå™¨äººï¼Œé¿å…æ¶ˆæ¯é‡å¤§æ—¶è§¦å‘Telegramé™æµ</span>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="generalShowPoster" checked>
                                            <span>æ˜¾ç¤ºå½±ç‰‡æµ·æŠ¥</span>
                                        </label>
                                        <span class="form-hint">é€šçŸ¥ä¸­é™„å¸¦å½±ç‰‡æµ·æŠ¥å›¾ç‰‡</span>
                                    </div>

                                    <div class="settings-tips" style="margin-top: 20px;">
                                        <h4>ğŸ“Œ é€šçŸ¥æ ¼å¼è¯´æ˜</h4>
                                        <p>å…¥åº“é€šçŸ¥ä½¿ç”¨ç®€æ´çš„å†…ç½®æ¨¡æ¿ï¼Œè‡ªåŠ¨æ˜¾ç¤ºä»¥ä¸‹ä¿¡æ¯ï¼š</p>
                                        <ul>
                                            <li>ğŸ“º æ ‡é¢˜ã€å¹´ä»½ã€å­£é›†ä¿¡æ¯</li>
                                            <li>ğŸ“š åª’ä½“ç±»å‹ï¼ˆç”µå½±/å‰§é›†/åŠ¨æ¼«ï¼‰</li>
                                            <li>â­ï¸ TMDBè¯„åˆ†</li>
                                            <li>ğŸ¬ TMDB ID</li>
                                            <li>ğŸ•’ å…¥åº“æ—¶é—´</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-actions" style="margin-top: 20px;">
                                <button class="btn-primary" onclick="saveLibraryNotificationConfig()">
                                    <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-secondary" onclick="loadSystemConfig()">
                                    <span>ğŸ”„</span> é‡æ–°åŠ è½½
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- æ“ä½œæ—¥å¿— - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="advanced">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ“ æ“ä½œæ—¥å¿—</h3>
                            </div>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <!-- ç­›é€‰æ  -->
                            <div class="activity-logs-filters">
                                <div class="filter-group">
                                    <input type="text" id="logUserSearch" class="filter-input" placeholder="ğŸ” æœç´¢ç”¨æˆ·å..."
                                        onkeyup="searchActivityLogs()" autocomplete="off" autocorrect="off"
                                        autocapitalize="off" spellcheck="false" data-form-type="other">
                                </div>
                                <div class="filter-group">
                                    <select id="logActionFilter" class="filter-select" onchange="loadAllActivityLogs()">
                                        <option value="">ğŸ“‹ å…¨éƒ¨æ“ä½œ</option>
                                        <option value="login">ğŸ” ç™»å½•</option>
                                        <option value="logout">ğŸšª ç™»å‡º</option>
                                        <option value="register">ğŸ“ æ³¨å†Œ</option>
                                        <option value="request_movie">ğŸ¬ æ±‚ç‰‡</option>
                                        <option value="redeem_code">ğŸŸï¸ å…‘æ¢ç </option>
                                        <option value="create_order">ğŸ›’ åˆ›å»ºè®¢å•</option>
                                        <option value="payment_success">ğŸ’³ æ”¯ä»˜æˆåŠŸ</option>
                                        <option value="password_change">ğŸ”‘ ä¿®æ”¹å¯†ç </option>
                                        <option value="account_banned">â›” å°ç¦</option>
                                        <option value="account_unbanned">âœ… è§£å°</option>
                                        <option value="level_change">ğŸ“Š ç­‰çº§å˜æ›´</option>
                                        <option value="view_lines">ğŸ”— æŸ¥çœ‹çº¿è·¯</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <select id="logStatusFilter" class="filter-select" onchange="loadAllActivityLogs()">
                                        <option value="">ğŸ”˜ å…¨éƒ¨çŠ¶æ€</option>
                                        <option value="success">âœ… æˆåŠŸ</option>
                                        <option value="failed">âŒ å¤±è´¥</option>
                                    </select>
                                </div>
                                <button class="btn-refresh" onclick="loadAllActivityLogs(1)">
                                    ğŸ”„ åˆ·æ–°
                                </button>
                            </div>

                            <!-- æ—¥å¿—åˆ—è¡¨ -->
                            <div class="activity-logs-list" id="activityLogsList">
                                <div class="loading-cell">åŠ è½½ä¸­...</div>
                            </div>

                            <!-- åˆ†é¡µ -->
                            <div class="pagination" id="activityLogsPagination"></div>
                        </div>
                    </div>

                    <!-- ç³»ç»Ÿä¿¡æ¯ - å¯æŠ˜å  -->
                    <div class="settings-card collapsible collapsed" data-settings-group="advanced">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ“Š ç³»ç»Ÿä¿¡æ¯</h3>
                            </div>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <div class="system-info-grid">
                                <div class="info-item">
                                    <span class="info-label">ç³»ç»Ÿç‰ˆæœ¬</span>
                                    <span class="info-value">v1.0.0</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">è¿è¡Œç¯å¢ƒ</span>
                                    <span class="info-value">Python Flask</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">æ•°æ®åº“</span>
                                    <span class="info-value">MySQL</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== è¿›é˜¶è®¾ç½® - ç®¡ç†å‘˜ç®¡ç† ==================== -->
                    <div class="settings-card collapsible collapsed" data-settings-group="advanced" id="adminManagementCard" style="display:none;">
                        <div class="settings-card-header" onclick="toggleSettingsCard(this)">
                            <div class="header-left">
                                <span class="collapse-icon">â–¶</span>
                                <h3>ğŸ‘¥ ç®¡ç†å‘˜ç®¡ç†</h3>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); showAddAdminModal()" style="font-size:12px;">â• æ·»åŠ ç®¡ç†å‘˜</button>
                        </div>
                        <div class="settings-card-body collapsible-content">
                            <p class="settings-desc">ç®¡ç†åå°ç®¡ç†å‘˜è´¦å·ï¼Œåˆ†é…ä¸åŒçš„æ“ä½œæƒé™ã€‚ä»…è¶…çº§ç®¡ç†å‘˜å¯æ“ä½œã€‚</p>
                            
                            <div id="adminListContainer">
                                <div class="loading-placeholder">åŠ è½½ä¸­...</div>
                            </div>
                        </div>
                    </div>

                </section>

                <!-- å®¡è®¡æ—¥å¿—éƒ¨åˆ† -->
                <section id="section-audit" class="admin-section">
                    <div class="section-header">
                        <h2>ğŸ“ ç®¡ç†å‘˜å®¡è®¡æ—¥å¿—</h2>
                        <div style="display:flex; gap:8px; align-items:center;">
                            <button class="btn-secondary btn-sm" onclick="cleanupAuditLogs()" title="æ¸…ç†æ—§æ—¥å¿—">
                                ğŸ—‘ï¸ æ¸…ç†æ—¥å¿—
                            </button>
                            <button class="btn-primary btn-sm" onclick="loadAuditLogs(1)">
                                ğŸ”„ åˆ·æ–°
                            </button>
                        </div>
                    </div>

                    <!-- ç­›é€‰æ  -->
                    <div class="filter-bar" style="display:flex; gap:12px; margin-bottom:16px; flex-wrap:wrap; align-items:center;">
                        <select id="auditFilterAdmin" class="form-input" style="width:auto; min-width:140px;" onchange="loadAuditLogs(1)">
                            <option value="">å…¨éƒ¨ç®¡ç†å‘˜</option>
                        </select>
                        <select id="auditFilterAction" class="form-input" style="width:auto; min-width:160px;" onchange="loadAuditLogs(1)">
                            <option value="">å…¨éƒ¨æ“ä½œç±»å‹</option>
                        </select>
                        <input type="text" id="auditFilterKeyword" class="form-input" style="width:auto; min-width:200px;" 
                               placeholder="æœç´¢æ“ä½œè¯¦æƒ…..." onkeypress="if(event.key==='Enter')loadAuditLogs(1)">
                        <button class="btn-secondary btn-sm" onclick="document.getElementById('auditFilterAdmin').value='';document.getElementById('auditFilterAction').value='';document.getElementById('auditFilterKeyword').value='';loadAuditLogs(1);">
                            æ¸…é™¤ç­›é€‰
                        </button>
                    </div>

                    <!-- æ—¥å¿—åˆ—è¡¨ -->
                    <div class="card">
                        <div id="auditLogsContainer">
                            <div class="loading-placeholder">åŠ è½½ä¸­...</div>
                        </div>
                        <div id="auditLogsPagination" class="pagination-bar" style="padding:12px 16px; text-align:center;"></div>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <!-- ç®¡ç†å‘˜ç¼–è¾‘å¼¹çª— -->
    <div class="modal" id="adminModal">
        <div class="modal-content" style="max-width:520px;">
            <h3 id="adminModalTitle">æ·»åŠ ç®¡ç†å‘˜</h3>
            <div class="settings-form" style="margin-bottom:16px;">
                <div class="form-group">
                    <label>ç”¨æˆ·å</label>
                    <input type="text" id="adminFormUsername" class="form-input" placeholder="è‡³å°‘2ä¸ªå­—ç¬¦" autocomplete="off">
                </div>
                <div class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" id="adminFormPassword" class="form-input" placeholder="è‡³å°‘6ä¸ªå­—ç¬¦ï¼ˆç¼–è¾‘æ—¶ç•™ç©ºä¸ä¿®æ”¹ï¼‰" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label>æƒé™é…ç½®</label>
                    <div class="admin-perm-grid" id="adminPermGrid">
                        <!-- æƒé™å¤é€‰æ¡†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div style="margin-top:8px;">
                        <button class="btn btn-sm" onclick="toggleAllPerms(true)" style="font-size:11px;padding:2px 8px;">å…¨é€‰</button>
                        <button class="btn btn-sm" onclick="toggleAllPerms(false)" style="font-size:11px;padding:2px 8px;">å…¨ä¸é€‰</button>
                    </div>
                </div>
            </div>
            <input type="hidden" id="adminFormId" value="">
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeAdminModal()">å–æ¶ˆ</button>
                <button class="btn-confirm" onclick="saveAdmin()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- åŠ è½½åŠ¨ç”»é®ç½© -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p id="loadingText">å¤„ç†ä¸­...</p>
        </div>
    </div>

    <div class="modal" id="noteModal">
        <div class="modal-content">
            <h3 id="noteModalTitle">æ·»åŠ å¤‡æ³¨</h3>
            <textarea id="adminNote" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"></textarea>
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn-confirm" onclick="confirmUpdate()">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
    <div class="confirm-overlay" id="deleteConfirmOverlay" onclick="closeDeleteConfirm()">
        <div class="confirm-dialog delete-confirm-dialog" onclick="event.stopPropagation()">
            <div class="icon">ğŸ—‘ï¸</div>
            <h3>ç¡®è®¤åˆ é™¤</h3>
            <div class="delete-info">
                <div class="delete-warning">âš ï¸ æ­¤æ“ä½œä¸å¯æ¢å¤ï¼</div>
                <div class="delete-count">å³å°†åˆ é™¤ <strong id="deleteCount">0</strong> æ¡è®°å½•</div>
                <p class="delete-hint">åˆ é™¤åå°†åŒæ—¶ç§»é™¤å…³è”çš„ä¸‹è½½ä»»åŠ¡</p>
            </div>
            <div class="buttons">
                <button class="btn-cancel" onclick="closeDeleteConfirm()">å–æ¶ˆ</button>
                <button class="btn-delete" onclick="confirmBatchDelete()">ç¡®è®¤åˆ é™¤</button>
            </div>
        </div>
    </div>

    <div class="modal" id="ptModal">
        <div class="modal-content pt-modal">
            <div class="pt-modal-inner">
                <div class="pt-modal-header">
                    <h3>MoviePilot æœç´¢</h3>
                    <button class="pt-close-btn" onclick="closePtModal()">âœ•</button>
                </div>
                <div class="pt-search-bar">
                    <input type="text" id="ptKeyword" placeholder="è¾“å…¥å…³é”®å­—æœç´¢ç§å­..." autocomplete="off" autocorrect="off"
                        autocapitalize="off" spellcheck="false" data-form-type="other" />
                    <button class="pt-search-btn" onclick="searchPtTorrents()">æœç´¢</button>
                </div>
                <div class="pt-toolbar">
                    <div class="pt-summary" id="ptSummary">è¾“å…¥å…³é”®å­—åå¯è·å–å€™é€‰ç§å­</div>
                    <div class="pt-filter-buttons">
                        <div class="pt-sort-group">
                            <span>æ’åº:</span>
                            <button class="pt-chip active" data-sort="seeders"
                                onclick="setPtSort('seeders', this)">åšç§æœ€å¤š</button>
                            <button class="pt-chip" data-sort="size" onclick="setPtSort('size', this)">ä½“ç§¯æœ€å°</button>
                            <button class="pt-chip" data-sort="created" onclick="setPtSort('created', this)">æœ€æ–°</button>
                        </div>
                        <div class="pt-filter-group">
                            <span>ç­›é€‰:</span>
                            <button class="pt-chip" data-filter="free"
                                onclick="togglePtFreeFilter(this)">ä»…çœ‹ä¿ƒé”€/å…è´¹</button>
                        </div>
                    </div>
                </div>
                <div class="pt-results" id="ptResults">
                    <p class="pt-placeholder">è¾“å…¥å…³é”®å­—åå¼€å§‹æœç´¢</p>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘é»‘åå•è§„åˆ™å¼¹çª— -->
    <div class="modal" id="blacklistModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="blacklistModalTitle">æ·»åŠ é»‘åå•è§„åˆ™</h3>
                <button class="modal-close" onclick="closeBlacklistModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="blacklistForm" onsubmit="saveBlacklistRule(event)">
                    <input type="hidden" id="blacklistRuleId">

                    <div class="form-group">
                        <label for="blacklistRuleName">è§„åˆ™åç§° *</label>
                        <input type="text" id="blacklistRuleName" required placeholder="ä¾‹å¦‚ï¼šç¦æ­¢Infuseæ’­æ”¾">
                    </div>

                    <div class="form-group">
                        <label for="blacklistClientPattern">å®¢æˆ·ç«¯åŒ¹é…æ¨¡å¼</label>
                        <input type="text" id="blacklistClientPattern"
                            placeholder="ä¾‹å¦‚ï¼š*Infuse* æˆ– Emby Webï¼ˆæ”¯æŒé€šé…ç¬¦ * å’Œ ?ï¼‰">
                        <small>ç•™ç©ºè¡¨ç¤ºä¸é™åˆ¶å®¢æˆ·ç«¯</small>
                    </div>

                    <div class="form-group">
                        <label for="blacklistDevicePattern">è®¾å¤‡åç§°åŒ¹é…æ¨¡å¼</label>
                        <input type="text" id="blacklistDevicePattern" placeholder="ä¾‹å¦‚ï¼š*iPhone* æˆ– iPadï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰">
                        <small>ç•™ç©ºè¡¨ç¤ºä¸é™åˆ¶è®¾å¤‡åç§°</small>
                    </div>

                    <div class="form-group">
                        <label for="blacklistAction">å¤„ç†æ–¹å¼ *</label>
                        <select id="blacklistAction" required>
                            <option value="stop_only">ä»…åœæ­¢æ’­æ”¾ï¼ˆç¦ç”¨è®¾å¤‡ï¼‰</option>
                            <option value="stop_and_ban">åœæ­¢æ’­æ”¾å¹¶ç¦ç”¨è´¦å·</option>
                        </select>
                        <small>âš ï¸ åœæ­¢+ç¦å·ä¼šè‡ªåŠ¨ç¦ç”¨æ£€æµ‹åˆ°çš„ç”¨æˆ·è´¦å·ï¼Œè¯·è°¨æ…ä½¿ç”¨</small>
                    </div>

                    <div class="form-group">
                        <label for="blacklistDescription">è§„åˆ™æè¿°</label>
                        <textarea id="blacklistDescription" rows="3" placeholder="è¯´æ˜æ­¤è§„åˆ™çš„ç”¨é€”"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="blacklistEnabled" checked>
                            <span>å¯ç”¨æ­¤è§„åˆ™</span>
                        </label>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeBlacklistModal()">å–æ¶ˆ</button>
                        <button type="submit" class="btn-primary">ä¿å­˜</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- å·¥å•è¯¦æƒ…/å›å¤å¼¹çª— - æ¨ªç‰ˆå¸ƒå±€ -->
    <div class="modal" id="ticketDetailModal">
        <div class="modal-content ticket-detail-modal">
            <div class="modal-header">
                <h3>ğŸ« å·¥å•è¯¦æƒ… <span id="ticketDetailNo"></span></h3>
                <button class="modal-close" onclick="closeTicketDetailModal()">âœ•</button>
            </div>
            <div class="ticket-detail-layout">
                <!-- å·¦ä¾§ï¼šå·¥å•ä¿¡æ¯ -->
                <div class="ticket-detail-left">
                    <div class="ticket-info-compact">
                        <div class="info-row">
                            <span class="info-label">ç”¨æˆ·</span>
                            <span class="info-value" id="ticketDetailUser"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ç±»åˆ«</span>
                            <span class="info-value" id="ticketDetailCategory"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ä¼˜å…ˆçº§</span>
                            <span class="info-value" id="ticketDetailPriority"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">çŠ¶æ€</span>
                            <span class="info-value" id="ticketDetailStatus"></span>
                        </div>
                    </div>

                    <div class="ticket-content-section">
                        <div class="content-block">
                            <label>ğŸ“Œ ä¸»é¢˜</label>
                            <p id="ticketDetailSubject"></p>
                        </div>
                        <div class="content-block">
                            <label>ğŸ“ é—®é¢˜æè¿°</label>
                            <p id="ticketDetailDescription"></p>
                        </div>
                    </div>

                    <div class="ticket-status-info">
                        <div class="status-note">
                            <span class="note-icon">â„¹ï¸</span>
                            <span class="note-text">çŠ¶æ€è‡ªåŠ¨ç®¡ç†ï¼šå›å¤â†’å¤„ç†ä¸­ï¼Œç”¨æˆ·å›å¤â†’å¾…å¤„ç†ï¼Œ3å¤©æ— å›å¤â†’å…³é—­</span>
                        </div>
                        <button class="btn-close-ticket" onclick="closeCurrentTicket()">å…³é—­å·¥å•</button>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šå¯¹è¯å’Œå›å¤ -->
                <div class="ticket-detail-right">
                    <div class="ticket-chat-section">
                        <label>ğŸ’¬ å¯¹è¯è®°å½•</label>
                        <div id="ticketMessages" class="ticket-messages-list"></div>
                    </div>

                    <div class="ticket-reply-section">
                        <label>âœ‰ï¸ å›å¤å·¥å•</label>
                        <textarea id="ticketReplyInput" placeholder="è¯·è¾“å…¥æ‚¨çš„å›å¤å†…å®¹..." rows="3"></textarea>
                        <button class="ticket-send-btn" onclick="submitTicketReply()">
                            <span class="btn-icon">âœ‰ï¸</span>
                            <span class="btn-text">å‘é€å›å¤</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç”Ÿæˆå…‘æ¢ç å¼¹çª— -->
    <div class="modal-overlay" id="generateRedeemOverlay" onclick="if(event.target===this)hideGenerateRedeemDialog()">
        <div class="modal-content" style="max-width:520px;">
            <div class="modal-header">
                <h3>ğŸ« ç”Ÿæˆå…‘æ¢ç </h3>
                <button class="modal-close" onclick="hideGenerateRedeemDialog()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- æ¨¡å¼åˆ‡æ¢ -->
                <div class="form-group">
                    <label>ç”Ÿæˆæ¨¡å¼</label>
                    <div class="redeem-mode-tabs">
                        <button class="redeem-mode-tab active" data-mode="custom" onclick="switchRedeemMode('custom', this)">â±ï¸ è‡ªå®šä¹‰å¤©æ•°</button>
                        <button class="redeem-mode-tab" data-mode="plan" onclick="switchRedeemMode('plan', this)">ğŸ“¦ å¥—é¤å…‘æ¢ç </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="redeemCodeType">å…‘æ¢ç±»å‹</label>
                    <select id="redeemCodeType">
                        <option value="new">æ–°è´­ï¼ˆå¼€é€šè´¦å·ï¼‰</option>
                        <option value="renew">ç»­è´¹ï¼ˆå»¶é•¿è®¢é˜…ï¼‰</option>
                    </select>
                    <span class="form-hint">æ–°è´­ï¼šä»…é™æœªå¼€é€šè´¦å· | ç»­è´¹ï¼šä»…é™å·²æœ‰è´¦å·</span>
                </div>

                <!-- è‡ªå®šä¹‰å¤©æ•°æ¨¡å¼ -->
                <div id="redeemCustomMode">
                    <div class="form-group">
                        <label for="redeemCustomDays">è®¢é˜…å¤©æ•°</label>
                        <input type="number" id="redeemCustomDays" min="1" max="3650" value="30" class="form-input">
                        <span class="form-hint">ç”¨æˆ·å…‘æ¢åè·å¾—çš„è®¢é˜…å¤©æ•°ï¼ˆ1-3650å¤©ï¼‰</span>
                    </div>
                    <div class="form-group">
                        <label for="redeemCustomPlan">å…³è”å¥—é¤ï¼ˆå¯é€‰ï¼‰</label>
                        <select id="redeemCustomPlan">
                            <option value="custom">ä¸å…³è”å¥—é¤ï¼ˆçº¯æ—¶é•¿ï¼‰</option>
                            {% for plan in plans %}
                            <option value="{{ plan.id }}">{{ plan.name }}ï¼ˆ{{ plan.duration_days|default(plan.duration * 30) }}å¤©ï¼‰</option>
                            {% endfor %}
                        </select>
                        <span class="form-hint">å…³è”å¥—é¤åï¼Œå…‘æ¢è®°å½•ä¸­ä¼šæ˜¾ç¤ºå¥—é¤åç§°</span>
                    </div>
                </div>

                <!-- å¥—é¤å…‘æ¢ç æ¨¡å¼ -->
                <div id="redeemPlanMode" style="display:none;">
                    <div class="form-group">
                        <label for="redeemPlanType">é€‰æ‹©å¥—é¤</label>
                        <select id="redeemPlanType" onchange="onRedeemPlanChange()">
                            <option value="">è¯·é€‰æ‹©å¥—é¤</option>
                            {% for plan in plans %}
                            <option value="{{ plan.id }}" data-duration-days="{{ plan.duration_days|default(plan.duration * 30) }}" data-price="{{ plan.price }}">{{ plan.name }} - {{ plan.duration_days|default(plan.duration * 30) }}å¤© / Â¥{{ plan.price }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group" id="redeemPlanInfo" style="display:none;">
                        <div class="redeem-plan-summary">
                            <span>ğŸ“‹ å¥—é¤æ—¶é•¿ï¼š<strong id="redeemPlanDuration">-</strong></span>
                            <span>ğŸ’° å¥—é¤ä»·æ ¼ï¼š<strong id="redeemPlanPrice">-</strong></span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="redeemExpiresDays">å…‘æ¢ç æœ‰æ•ˆæœŸï¼ˆå¯é€‰ï¼‰</label>
                    <select id="redeemExpiresDays">
                        <option value="">æ°¸ä¸è¿‡æœŸ</option>
                        <option value="7">7å¤©å†…æœ‰æ•ˆ</option>
                        <option value="30">30å¤©å†…æœ‰æ•ˆ</option>
                        <option value="90">90å¤©å†…æœ‰æ•ˆ</option>
                        <option value="180">180å¤©å†…æœ‰æ•ˆ</option>
                        <option value="365">365å¤©å†…æœ‰æ•ˆ</option>
                    </select>
                    <span class="form-hint">å…‘æ¢ç æœ¬èº«çš„è¿‡æœŸæ—¶é—´ï¼Œè¶…è¿‡åç”¨æˆ·æ— æ³•ä½¿ç”¨</span>
                </div>

                <div class="form-group">
                    <label for="redeemCount">ç”Ÿæˆæ•°é‡</label>
                    <input type="number" id="redeemCount" min="1" max="100" value="1" class="form-input">
                    <span class="form-hint">å•æ¬¡æœ€å¤šç”Ÿæˆ100ä¸ª</span>
                </div>

                <div class="form-group">
                    <label for="redeemRemark">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" id="redeemRemark" class="form-input" placeholder="å¦‚ï¼šé€ç»™VIPç”¨æˆ·">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideGenerateRedeemDialog()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="generateRedeemCodes()">ç”Ÿæˆå…‘æ¢ç </button>
            </div>
        </div>
    </div>

    <!-- åˆ é™¤å…‘æ¢ç ç¡®è®¤å¼¹çª— -->
    <div class="confirm-overlay" id="deleteRedeemOverlay" onclick="hideDeleteRedeemConfirm()">
        <div class="confirm-dialog delete-confirm-dialog" onclick="event.stopPropagation()">
            <div class="icon">ğŸ—‘ï¸</div>
            <h3>ç¡®è®¤åˆ é™¤å…‘æ¢ç </h3>
            <div class="delete-info">
                <div class="delete-warning">âš ï¸ æ­¤æ“ä½œä¸å¯æ¢å¤ï¼</div>
                <div class="delete-count">å³å°†åˆ é™¤ <strong id="deleteRedeemCount">0</strong> ä¸ªå…‘æ¢ç </div>
                <p class="delete-hint">åˆ é™¤åå…‘æ¢ç å°†æ— æ³•ä½¿ç”¨</p>
            </div>
            <div class="buttons">
                <button class="btn-cancel" onclick="hideDeleteRedeemConfirm()">å–æ¶ˆ</button>
                <button class="btn-delete" onclick="confirmDeleteRedeemCodes()">ç¡®è®¤åˆ é™¤</button>
            </div>
        </div>
    </div>

    <!-- å…¬å‘Šç¼–è¾‘å¼¹çª— -->
    <div class="modal-overlay" id="announcementModalOverlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="announcementModalTitle">ğŸ“¢ å‘å¸ƒå…¬å‘Š</h3>
                <button class="modal-close" onclick="closeAnnouncementModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="announcementId">
                <div class="form-group">
                    <label for="announcementTitle">å…¬å‘Šæ ‡é¢˜ <span class="required">*</span></label>
                    <input type="text" id="announcementTitle" placeholder="è¯·è¾“å…¥å…¬å‘Šæ ‡é¢˜" maxlength="200">
                </div>
                <div class="form-group">
                    <label for="announcementContent">å…¬å‘Šå†…å®¹ <span class="required">*</span></label>
                    <textarea id="announcementContent" rows="5" placeholder="è¯·è¾“å…¥å…¬å‘Šå†…å®¹ï¼Œæ”¯æŒç®€å•HTML"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="announcementType">å…¬å‘Šç±»å‹</label>
                        <select id="announcementType">
                            <option value="info">ğŸ“˜ é€šçŸ¥</option>
                            <option value="warning">âš ï¸ è­¦å‘Š</option>
                            <option value="success">âœ… æˆåŠŸ</option>
                            <option value="error">âŒ é”™è¯¯</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="announcementPinned">
                            <span>ç½®é¡¶æ˜¾ç¤º</span>
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="announcementStartTime">å¼€å§‹æ—¶é—´ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="datetime-local" id="announcementStartTime">
                    </div>
                    <div class="form-group">
                        <label for="announcementEndTime">ç»“æŸæ—¶é—´ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="datetime-local" id="announcementEndTime">
                    </div>
                </div>
                <div class="form-hint">ä¸è®¾ç½®æ—¶é—´åˆ™ç«‹å³ç”Ÿæ•ˆä¸”æ°¸ä¹…æœ‰æ•ˆ</div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAnnouncementModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveAnnouncement()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- é€šç”¨æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="genericModalOverlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="genericModalTitle">æ ‡é¢˜</h3>
                <button class="modal-close" onclick="closeGenericModal()">&times;</button>
            </div>
            <div class="modal-body" id="genericModalBody">
                <!-- åŠ¨æ€å†…å®¹ -->
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·è¯¦æƒ…å¼¹çª— -->
    <div class="modal" id="userDetailModal" style="display: none;">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 id="userDetailTitle">ç”¨æˆ·è¯¦æƒ…</h3>
                <button class="modal-close" onclick="closeUserDetailModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchUserDetailTab('info')">ğŸ“‹ åŸºæœ¬ä¿¡æ¯</button>
                    <button class="tab-btn" onclick="switchUserDetailTab('activity')">ğŸ“ æ“ä½œè®°å½•</button>
                    <button class="tab-btn" onclick="switchUserDetailTab('subscriptions')">ğŸ’ è®¢é˜…è®°å½•</button>
                    <button class="tab-btn" onclick="switchUserDetailTab('devices')">ğŸ“± è®¾å¤‡åˆ—è¡¨</button>
                    <button class="tab-btn" onclick="switchUserDetailTab('requests')">ğŸ¬ æ±‚ç‰‡è®°å½•</button>
                    <button class="tab-btn" onclick="switchUserDetailTab('invite_reward')">ğŸ é‚€è¯·è¿”åˆ©</button>
                </div>

                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <div class="tab-content active" id="tab-info">
                    <div class="user-info-grid" id="userInfoContent">
                        <div class="info-loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>

                <!-- æ“ä½œè®°å½• -->
                <div class="tab-content" id="tab-activity">
                    <div class="activity-filter">
                        <select id="activityTypeFilter" onchange="loadUserActivityLogs()">
                            <option value="">å…¨éƒ¨æ“ä½œ</option>
                            <option value="login">ç™»å½•</option>
                            <option value="logout">ç™»å‡º</option>
                            <option value="request_movie">æ±‚ç‰‡</option>
                            <option value="payment_success">æ”¯ä»˜</option>
                            <option value="redeem_code">å…‘æ¢ç </option>
                            <option value="password_change">ä¿®æ”¹å¯†ç </option>
                            <option value="view_lines">æŸ¥çœ‹çº¿è·¯</option>
                        </select>
                    </div>
                    <div class="activity-list" id="activityLogContent">
                        <div class="info-loading">åŠ è½½ä¸­...</div>
                    </div>
                    <div class="pagination" id="activityPagination"></div>
                </div>

                <!-- è®¢é˜…è®°å½• -->
                <div class="tab-content" id="tab-subscriptions">
                    <div class="subscriptions-list" id="subscriptionsContent">
                        <div class="info-loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>

                <!-- è®¾å¤‡åˆ—è¡¨ -->
                <div class="tab-content" id="tab-devices">
                    <div class="devices-list" id="devicesContent">
                        <div class="info-loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>

                <!-- æ±‚ç‰‡è®°å½• -->
                <div class="tab-content" id="tab-requests">
                    <div class="requests-list" id="requestsContent">
                        <div class="info-loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>

                <!-- é‚€è¯·è¿”åˆ© -->
                <div class="tab-content" id="tab-invite_reward">
                    <div id="inviteRewardContent">
                        <div class="info-loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¥—é¤é€‰æ‹©æ¨¡æ€å¼¹çª— -->
    <div id="planSelectModal" class="modal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h3>é€‰æ‹©å…‘æ¢å¥—é¤</h3>
                <span class="modal-close" onclick="closePlanSelectModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>å¯ç”¨å¥—é¤åˆ—è¡¨</label>
                    <div id="availablePlansList" class="plans-list">
                        <!-- åŠ¨æ€åŠ è½½å¥—é¤åˆ—è¡¨ -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="planCoins">æ‰€éœ€ç§¯åˆ†</label>
                    <input type="number" id="planCoins" placeholder="è¯·è¾“å…¥æ‰€éœ€ç§¯åˆ†" class="form-input" min="1">
                    <span class="form-hint">ç”¨æˆ·å…‘æ¢è¯¥å¥—é¤éœ€è¦æ¶ˆè€—çš„ç§¯åˆ†æ•°é‡</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closePlanSelectModal()">å–æ¶ˆ</button>
                <button class="btn-primary" onclick="confirmAddPlan()">ç¡®è®¤æ·»åŠ </button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/common.js') }}?v=22"></script>
    <script>
        // ç®¡ç†å‘˜æƒé™æ•°æ®ï¼ˆç”±åç«¯æ³¨å…¥ï¼‰
        window.ADMIN_INFO = {{ admin_info | default({'is_super': true, 'permissions': [], 'username': 'ç®¡ç†å‘˜'}) | tojson }};
        window.PERMISSION_GROUPS = {{ permission_groups | default({}) | tojson }};
    </script>
    <script src="{{ url_for('static', filename='js/admin.js') }}?v=34"></script>
    <script src="{{ url_for('static', filename='js/admin-checkin.js') }}?v=7"></script>

</body>

</html>